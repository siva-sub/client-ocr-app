import{c as ce,g as Ie,a as Ye}from"./pdfjs-CRNIONdy.js";import{H as se,b as ie,F as G}from"./onnxruntime-CqRzMC93.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var Me={exports:{}};/*! store2 - v2.14.4 - 2024-12-26
* Copyright (c) 2024 Nathan Bubna; Licensed MIT */(function(c){(function(e,t){var s={version:"2.14.4",areas:{},apis:{},nsdelim:".",inherit:function(n,r){for(var a in n)r.hasOwnProperty(a)||Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(n,a));return r},stringify:function(n,r){return n===void 0||typeof n=="function"?n+"":JSON.stringify(n,r||s.replace)},parse:function(n,r){try{return JSON.parse(n,r||s.revive)}catch{return n}},fn:function(n,r){s.storeAPI[n]=r;for(var a in s.apis)s.apis[a][n]=r},get:function(n,r){return n.getItem(r)},set:function(n,r,a){n.setItem(r,a)},remove:function(n,r){n.removeItem(r)},key:function(n,r){return n.key(r)},length:function(n){return n.length},clear:function(n){n.clear()},Store:function(n,r,a){var o=s.inherit(s.storeAPI,function(d,l,p){return arguments.length===0?o.getAll():typeof l=="function"?o.transact(d,l,p):l!==void 0?o.set(d,l,p):typeof d=="string"||typeof d=="number"?o.get(d):typeof d=="function"?o.each(d):d?o.setAll(d,l):o.clear()});o._id=n;try{var h="__store2_test";r.setItem(h,"ok"),o._area=r,r.removeItem(h)}catch{o._area=s.storage("fake")}return o._ns=a||"",s.areas[n]||(s.areas[n]=o._area),s.apis[o._ns+o._id]||(s.apis[o._ns+o._id]=o),o},storeAPI:{area:function(n,r){var a=this[n];return(!a||!a.area)&&(a=s.Store(n,r,this._ns),this[n]||(this[n]=a)),a},namespace:function(n,r,a){if(a=a||this._delim||s.nsdelim,!n)return this._ns?this._ns.substring(0,this._ns.length-a.length):"";var o=n,h=this[o];if((!h||!h.namespace)&&(h=s.Store(this._id,this._area,this._ns+o+a),h._delim=a,this[o]||(this[o]=h),!r))for(var d in s.areas)h.area(d,s.areas[d]);return h},isFake:function(n){return n?(this._real=this._area,this._area=s.storage("fake")):n===!1&&(this._area=this._real||this._area),this._area.name==="fake"},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(n){return this._area.has?this._area.has(this._in(n)):this._in(n)in this._area},size:function(){return this.keys().length},each:function(n,r){for(var a=0,o=s.length(this._area);a<o;a++){var h=this._out(s.key(this._area,a));if(h!==void 0&&n.call(this,h,this.get(h),r)===!1)break;o>s.length(this._area)&&(o--,a--)}return r||this},keys:function(n){return this.each(function(r,a,o){o.push(r)},n||[])},get:function(n,r){var a=s.get(this._area,this._in(n)),o;return typeof r=="function"&&(o=r,r=null),a!==null?s.parse(a,o):r??a},getAll:function(n){return this.each(function(r,a,o){o[r]=a},n||{})},transact:function(n,r,a){var o=this.get(n,a),h=r(o);return this.set(n,h===void 0?o:h),this},set:function(n,r,a){var o=this.get(n),h;return o!=null&&a===!1?r:(typeof a=="function"&&(h=a,a=void 0),s.set(this._area,this._in(n),s.stringify(r,h),a)||o)},setAll:function(n,r){var a,o;for(var h in n)o=n[h],this.set(h,o,r)!==o&&(a=!0);return a},add:function(n,r,a){var o=this.get(n);if(o instanceof Array)r=o.concat(r);else if(o!==null){var h=typeof o;if(h===typeof r&&h==="object"){for(var d in r)o[d]=r[d];r=o}else r=o+r}return s.set(this._area,this._in(n),s.stringify(r,a)),r},remove:function(n,r){var a=this.get(n,r);return s.remove(this._area,this._in(n)),a},clear:function(){return this._ns?this.each(function(n){s.remove(this._area,this._in(n))},1):s.clear(this._area),this},clearAll:function(){var n=this._area;for(var r in s.areas)s.areas.hasOwnProperty(r)&&(this._area=s.areas[r],this.clear());return this._area=n,this},_in:function(n){return typeof n!="string"&&(n=s.stringify(n)),this._ns?this._ns+n:n},_out:function(n){return this._ns?n&&n.indexOf(this._ns)===0?n.substring(this._ns.length):void 0:n}},storage:function(n){return s.inherit(s.storageAPI,{items:{},name:n})},storageAPI:{length:0,has:function(n){return this.items.hasOwnProperty(n)},key:function(n){var r=0;for(var a in this.items)if(this.has(a)&&n===r++)return a},setItem:function(n,r){this.has(n)||this.length++,this.items[n]=r},removeItem:function(n){this.has(n)&&(delete this.items[n],this.length--)},getItem:function(n){return this.has(n)?this.items[n]:null},clear:function(){for(var n in this.items)this.removeItem(n)}}},i=s.Store("local",function(){try{return localStorage}catch{}}());i.local=i,i._=s,i.area("session",function(){try{return sessionStorage}catch{}}()),i.area("page",s.storage("page")),typeof t=="function"&&t.amd!==void 0?t("store2",[],function(){return i}):c.exports?c.exports=i:(e.store&&(s.conflict=e.store),e.store=i)})(ce,ce&&ce.define)})(Me);var qe=Me.exports;const Je=Ie(qe);class Ze{constructor(e={}){this.namespace=e.namespace||"ocr-cache",this.maxCacheSize=e.maxCacheSize||50*1024*1024,this.maxAge=e.maxAge||7*24*60*60*1e3,this.store=Je.namespace(this.namespace),this.store.get("metadata")||this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}}),this.cleanupOldEntries()}generateCacheKey(e,t,s){const n=`${typeof e=="string"?e:JSON.stringify(e)}-${t}-${s}`;let r=0;for(let a=0;a<n.length;a++){const o=n.charCodeAt(a);r=(r<<5)-r+o,r=r&r}return`ocr-${Math.abs(r).toString(36)}`}get(e,t,s){const i=this.generateCacheKey(e,t,s),n=this.store.get(i);return n?Date.now()-n.timestamp>this.maxAge?(this.remove(i),null):(n.lastAccessed=Date.now(),this.store.set(i,n),n.data):null}set(e,t,s,i){const n=this.generateCacheKey(e,t,s),r=JSON.stringify(i),a=new Blob([r]).size;this.ensureCacheSpace(a);const o={timestamp:Date.now(),lastAccessed:Date.now(),engineType:t,modelVersion:s,size:a,data:i},h=this.store.get("metadata");return h.totalSize+=a,h.entries[n]={size:a,timestamp:o.timestamp},this.store.set("metadata",h),this.store.set(n,o),n}remove(e){if(this.store.get(e)){const s=this.store.get("metadata");s.entries[e]&&(s.totalSize-=s.entries[e].size,delete s.entries[e],this.store.set("metadata",s)),this.store.remove(e)}}clear(){this.store.keys().forEach(t=>{t!=="metadata"&&this.store.remove(t)}),this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}})}getStats(){const e=this.store.get("metadata"),t=Object.keys(e.entries).length;return{totalSize:e.totalSize,maxSize:this.maxCacheSize,usagePercent:e.totalSize/this.maxCacheSize*100,entries:t,oldestEntry:this.getOldestEntry(),newestEntry:this.getNewestEntry()}}cleanupOldEntries(){const e=Date.now(),t=this.store.get("metadata"),s=[];Object.entries(t.entries).forEach(([i,n])=>{e-n.timestamp>this.maxAge&&s.push(i)}),s.forEach(i=>this.remove(i))}ensureCacheSpace(e){const t=this.store.get("metadata");if(t.totalSize+e<=this.maxCacheSize)return;const s=Object.entries(t.entries).sort((n,r)=>n[1].timestamp-r[1].timestamp);let i=t.totalSize;for(const[n]of s){if(i+e<=this.maxCacheSize)break;const r=this.store.get(n);r&&(i-=r.size,this.remove(n))}}getOldestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([s,i])=>{(!t||i.timestamp<t.timestamp)&&(t={key:s,...i})}),t}getNewestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([s,i])=>{(!t||i.timestamp>t.timestamp)&&(t={key:s,...i})}),t}export(){const e={metadata:this.store.get("metadata"),entries:{}};return this.store.keys().forEach(t=>{t!=="metadata"&&(e.entries[t]=this.store.get(t))}),e}import(e){if(!e||!e.metadata)throw new Error("Invalid cache data format");this.clear(),this.store.set("metadata",e.metadata),Object.entries(e.entries).forEach(([t,s])=>{this.store.set(t,s)})}}const D=new Ze;class me{static async resizeImage(e,t,s){const i=document.createElement("canvas"),n=i.getContext("2d"),r=new Image,a=new Blob([e],{type:"image/png"}),o=URL.createObjectURL(a);return new Promise((h,d)=>{r.onload=()=>{i.width=t,i.height=s,n.drawImage(r,0,0,t,s);const l=n.getImageData(0,0,t,s);URL.revokeObjectURL(o),h(l)},r.onerror=d,r.src=o})}static canvasToImageData(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}static normalizeImageData(e,t=[.485,.456,.406],s=[.229,.224,.225]){const i=e.data,n=new Float32Array(i.length);for(let r=0;r<i.length;r+=4)n[r]=(i[r]/255-t[0])/s[0],n[r+1]=(i[r+1]/255-t[1])/s[1],n[r+2]=(i[r+2]/255-t[2])/s[2],n[r+3]=i[r+3]/255;return n}static hwcToChw(e,t,s){const n=new Float32Array(3*s*t),r=e.data||e;let a=0;for(let o=0;o<3;o++)for(let h=0;h<s;h++)for(let d=0;d<t;d++)n[a++]=r[(h*t+d)*4+o];return n}}class ge{constructor(e={}){this.limitSideLen=e.det_limit_side_len||960,this.limitType=e.det_limit_type||"min",this.mean=e.mean||[.485,.456,.406],this.std=e.std||[.229,.224,.225],this.scale=e.scale||1/255}async preprocess(e){const t=e.width,s=e.height,{targetWidth:i,targetHeight:n}=this.calculateResizeDimensions(t,s),r=document.createElement("canvas");r.width=i,r.height=n;const a=r.getContext("2d");a.drawImage(e,0,0,i,n);const o=a.getImageData(0,0,i,n),h=this.normalizeImage(o);return{tensor:me.hwcToChw(h,i,n),originalShape:[s,t],resizedShape:[n,i],ratio:[n/s,i/t]}}calculateResizeDimensions(e,t){let s=1;this.limitType==="max"?Math.max(t,e)>this.limitSideLen&&(s=this.limitSideLen/Math.max(t,e)):this.limitType==="min"&&Math.min(t,e)<this.limitSideLen&&(s=this.limitSideLen/Math.min(t,e));let i=Math.round(t*s),n=Math.round(e*s);return i=Math.max(Math.round(i/32)*32,32),n=Math.max(Math.round(n/32)*32,32),{targetWidth:n,targetHeight:i}}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let i=0;for(let n=0;n<t.length;n+=4)s[i++]=(t[n]*this.scale-this.mean[0])/this.std[0],s[i++]=(t[n+1]*this.scale-this.mean[1])/this.std[1],s[i++]=(t[n+2]*this.scale-this.mean[2])/this.std[2];return s}}class Xe{constructor(e={}){this.imageShape=e.cls_image_shape||[3,48,192]}async preprocess(e){const[t,s,i]=this.imageShape,n=e.width,r=e.height,a=n/r;let o=Math.ceil(s*a);o>i&&(o=i);const h=document.createElement("canvas");h.width=o,h.height=s,h.getContext("2d").drawImage(e,0,0,o,s);const l=document.createElement("canvas");l.width=i,l.height=s;const p=l.getContext("2d");p.fillStyle="black",p.fillRect(0,0,i,s),p.drawImage(h,0,0);const w=p.getImageData(0,0,i,s),v=this.normalizeImage(w);return me.hwcToChw(v,i,s)}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let i=0;for(let n=0;n<t.length;n+=4)s[i++]=(t[n]/255-.5)/.5,s[i++]=(t[n+1]/255-.5)/.5,s[i++]=(t[n+2]/255-.5)/.5;return s}}class be{constructor(e={}){this.imageShape=e.rec_image_shape||[3,48,320],this.recAlgorithm=e.rec_algorithm||"SVTR_LCNet"}async preprocess(e,t=null){const[s,i,n]=this.imageShape,r=e.width,a=e.height;t||(t=r/a);let o=Math.round(i*t);this.recAlgorithm==="NRTR"||this.recAlgorithm==="ViTSTR"?o=n:o=Math.min(o,n);const h=r/a;let d=Math.ceil(i*h);d>o&&(d=o);const l=document.createElement("canvas");l.width=d,l.height=i,l.getContext("2d").drawImage(e,0,0,d,i);const w=document.createElement("canvas");w.width=o,w.height=i;const v=w.getContext("2d");v.fillStyle="black",v.fillRect(0,0,o,i),v.drawImage(l,0,0);const x=v.getImageData(0,0,o,i),L=this.normalizeImage(x);return{tensor:me.hwcToChw(L,o,i),shape:[1,s,i,o]}}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let i=0;for(let n=0;n<t.length;n+=4)s[i++]=(t[n]/255-.5)/.5,s[i++]=(t[n+1]/255-.5)/.5,s[i++]=(t[n+2]/255-.5)/.5;return s}}class Ve{static extractRegion(e,t){const s=this.sortPoints(t),i=Math.max(this.distance(s[0],s[1]),this.distance(s[3],s[2])),n=Math.max(this.distance(s[0],s[3]),this.distance(s[1],s[2])),r=document.createElement("canvas");r.width=Math.round(i),r.height=Math.round(n);const a=r.getContext("2d"),o=s,h=[[0,0],[i,0],[i,n],[0,n]];a.save();const d=document.createElement("canvas");d.width=e.width,d.height=e.height,d.getContext("2d").drawImage(e,0,0),a.beginPath(),a.moveTo(0,0),a.lineTo(i,0),a.lineTo(i,n),a.lineTo(0,n),a.closePath(),a.clip();const p=this.getPerspectiveTransform(o,h,i,n);if(a.setTransform(p.a,p.b,p.c,p.d,p.e,p.f),a.drawImage(e,0,0),a.restore(),n>i*1.5){const w=document.createElement("canvas");w.width=r.height,w.height=r.width;const v=w.getContext("2d");return v.translate(w.width/2,w.height/2),v.rotate(Math.PI/2),v.drawImage(r,-r.width/2,-r.height/2),w}return r}static sortPoints(e){const t=e.reduce((a,o)=>[a[0]+o[0]/e.length,a[1]+o[1]/e.length],[0,0]),s=e.slice().sort((a,o)=>{const h=Math.atan2(a[1]-t[1],a[0]-t[0]),d=Math.atan2(o[1]-t[1],o[0]-t[0]);return h-d});let i=0,n=s[0][0]+s[0][1];for(let a=1;a<s.length;a++){const o=s[a][0]+s[a][1];o<n&&(n=o,i=a)}const r=[];for(let a=0;a<s.length;a++)r.push(s[(i+a)%s.length]);return r}static distance(e,t){const s=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(s*s+i*i)}static getPerspectiveTransform(e,t,s,i){const n=s/(e[1][0]-e[0][0]),r=i/(e[3][1]-e[0][1]);return{a:n,b:0,c:0,d:r,e:-e[0][0]*n,f:-e[0][1]*r}}}class Qe{constructor(e={}){this.mean=e.mean||[.485,.456,.406],this.std=e.std||[.229,.224,.225],this.cls_image_shape=e.cls_image_shape||[3,48,192]}async preprocess(e){const[t,s,i]=this.cls_image_shape,n=document.createElement("canvas");n.width=i,n.height=s;const r=n.getContext("2d");r.drawImage(e,0,0,i,s);const o=r.getImageData(0,0,i,s).data,h=new Float32Array(t*s*i);for(let d=0;d<s;d++)for(let l=0;l<i;l++){const p=(d*i+l)*4;h[0*s*i+d*i+l]=(o[p]/255-this.mean[0])/this.std[0],h[1*s*i+d*i+l]=(o[p+1]/255-this.mean[1])/this.std[1],h[2*s*i+d*i+l]=(o[p+2]/255-this.mean[2])/this.std[2]}return{tensor:new se("float32",h,[1,t,s,i]),originalSize:[e.height,e.width]}}}class Ae{constructor(e={}){this.thresh=e.thresh||.3,this.boxThresh=e.box_thresh||.6,this.maxCandidates=e.max_candidates||1e3,this.unclipRatio=e.unclip_ratio||1.5,this.minSize=e.min_size||3,this.scoreMode=e.score_mode||"fast"}process(e,t){const s=e[0],i=t[0],n=this.threshold(s),r=this.findContours(n),a=[],o=[];for(const h of r){if(h.length<4)continue;const d=this.getMinAreaRect(h);if(!d)continue;const l=this.boxScore(s,d);if(l<this.boxThresh)continue;const p=this.unclip(d);if(!p)continue;const w=this.rescaleBox(p,i);this.validateBox(w)&&(a.push(w),o.push(l))}return{boxes:a,scores:o}}threshold(e){const t=e.length,s=e[0].length,i=[];for(let n=0;n<t;n++){i[n]=[];for(let r=0;r<s;r++)i[n][r]=e[n][r]>this.thresh?1:0}return i}findContours(e){const t=e.length,s=e[0].length,i=Array(t).fill(null).map(()=>Array(s).fill(!1)),n=[];for(let r=0;r<t;r++)for(let a=0;a<s;a++)if(e[r][a]===1&&!i[r][a]){const o=this.traceContour(e,i,r,a);o.length>=4&&n.push(o)}return n}traceContour(e,t,s,i){const n=e.length,r=e[0].length,a=[],o=[[s,i]],h=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(;o.length>0;){const[d,l]=o.shift();if(t[d][l])continue;t[d][l]=!0;let p=!1;for(const[w,v]of h){const x=d+w,L=l+v;if(x<0||x>=n||L<0||L>=r||e[x][L]===0){p=!0;break}}p&&a.push([l,d]);for(const[w,v]of h){const x=d+w,L=l+v;x>=0&&x<n&&L>=0&&L<r&&e[x][L]===1&&!t[x][L]&&o.push([x,L])}}return a}getMinAreaRect(e){if(e.length<4)return null;const t=this.convexHull(e);if(t.length<4)return null;let s=1/0,i=null;for(let n=0;n<t.length;n++){const r=t[n],a=t[(n+1)%t.length],o=[a[0]-r[0],a[1]-r[1]],h=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(h===0)continue;o[0]/=h,o[1]/=h;let d=1/0,l=-1/0,p=1/0,w=-1/0;for(const I of t){const O=(I[0]-r[0])*o[0]+(I[1]-r[1])*o[1],M=(I[0]-r[0])*-o[1]+(I[1]-r[1])*o[0];d=Math.min(d,O),l=Math.max(l,O),p=Math.min(p,M),w=Math.max(w,M)}const v=l-d,x=w-p,L=v*x;if(L<s){s=L;const I=[r[0]+d*o[0]+p*-o[1],r[1]+d*o[1]+p*o[0]],O=[r[0]+l*o[0]+p*-o[1],r[1]+l*o[1]+p*o[0]],M=[r[0]+l*o[0]+w*-o[1],r[1]+l*o[1]+w*o[0]],A=[r[0]+d*o[0]+w*-o[1],r[1]+d*o[1]+w*o[0]];i=[I,O,M,A]}}return i}convexHull(e){if(e.length<3)return e;let t=0;for(let r=1;r<e.length;r++)(e[r][1]<e[t][1]||e[r][1]===e[t][1]&&e[r][0]<e[t][0])&&(t=r);const s=e.slice(),i=s.splice(t,1)[0];s.sort((r,a)=>{const o=Math.atan2(r[1]-i[1],r[0]-i[0]),h=Math.atan2(a[1]-i[1],a[0]-i[0]);if(o!==h)return o-h;const d=(r[0]-i[0])*(r[0]-i[0])+(r[1]-i[1])*(r[1]-i[1]),l=(a[0]-i[0])*(a[0]-i[0])+(a[1]-i[1])*(a[1]-i[1]);return d-l});const n=[i];for(const r of s){for(;n.length>=2;){const a=n[n.length-2],o=n[n.length-1];if((o[0]-a[0])*(r[1]-a[1])-(o[1]-a[1])*(r[0]-a[0])<=0)n.pop();else break}n.push(r)}return n}boxScore(e,t){const s=Math.min(...t.map(h=>h[0])),i=Math.max(...t.map(h=>h[0])),n=Math.min(...t.map(h=>h[1])),r=Math.max(...t.map(h=>h[1]));let a=0,o=0;for(let h=Math.floor(n);h<=Math.ceil(r);h++)for(let d=Math.floor(s);d<=Math.ceil(i);d++)h>=0&&h<e.length&&d>=0&&d<e[0].length&&this.pointInPolygon([d,h],t)&&(a+=e[h][d],o++);return o>0?a/o:0}pointInPolygon(e,t){let s=!1;const i=e[0],n=e[1];for(let r=0,a=t.length-1;r<t.length;a=r++){const o=t[r][0],h=t[r][1],d=t[a][0],l=t[a][1];h>n!=l>n&&i<(d-o)*(n-h)/(l-h)+o&&(s=!s)}return s}unclip(e){let t=0;for(let r=0;r<e.length;r++){const a=(r+1)%e.length,o=e[a][0]-e[r][0],h=e[a][1]-e[r][1];t+=Math.sqrt(o*o+h*h)}let s=0;for(let r=0;r<e.length;r++){const a=(r+1)%e.length;s+=e[r][0]*e[a][1]-e[a][0]*e[r][1]}s=Math.abs(s)/2;const i=s*this.unclipRatio/t,n=[];for(let r=0;r<e.length;r++){const a=e[(r-1+e.length)%e.length],o=e[r],h=e[(r+1)%e.length],d=[a[0]-o[0],a[1]-o[1]],l=[h[0]-o[0],h[1]-o[1]],p=Math.sqrt(d[0]*d[0]+d[1]*d[1]),w=Math.sqrt(l[0]*l[0]+l[1]*l[1]);p>0&&(d[0]/=p,d[1]/=p),w>0&&(l[0]/=w,l[1]/=w);const v=[d[0]+l[0],d[1]+l[1]],x=Math.sqrt(v[0]*v[0]+v[1]*v[1]);x>0?(v[0]/=x,v[1]/=x,n.push([o[0]-v[0]*i,o[1]-v[1]*i])):n.push(o)}return n}rescaleBox(e,t){const[s,i,n,r]=t;return e.map(a=>[a[0]/r,a[1]/n])}validateBox(e){const t=Math.max(this.distance(e[0],e[1]),this.distance(e[2],e[3])),s=Math.max(this.distance(e[0],e[3]),this.distance(e[1],e[2]));return t>=this.minSize&&s>=this.minSize}distance(e,t){const s=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(s*s+i*i)}}class ke{constructor(e={}){this.labelList=e.label_list||["0","180"],this.clsThresh=e.cls_thresh||.9}process(e){const t=[],s=e[0];for(let i=0;i<s.length;i++){const n=s[i],r=n.indexOf(Math.max(...n)),a=n[r],o=this.labelList[r];t.push({label:o,score:a,shouldRotate:o==="180"&&a>this.clsThresh})}return t}}class ze{constructor(e){this.characterDict=e,this.blankIdx=e.length}decode(e,t="greedy"){if(t==="greedy")return this.greedyDecode(e);if(t==="beam_search")return this.beamSearchDecode(e);throw new Error(`Unknown decode method: ${t}`)}greedyDecode(e){const t=[];for(const s of e){const i=[];let n=-1;for(let o=0;o<s.length;o++){const h=s[o].indexOf(Math.max(...s[o]));h!==this.blankIdx&&h!==n&&i.push(h),n=h}const r=i.map(o=>this.characterDict[o]).join(""),a=this.calculateConfidence(s,i);t.push({text:r,confidence:a})}return t}beamSearchDecode(e,t=5){const s=[];for(const i of e){const r=this.beamSearch(i,t)[0];s.push({text:r.text,confidence:r.score})}return s}beamSearch(e,t){let s=[{text:"",score:1,lastIdx:-1}];for(let i=0;i<e.length;i++){const n=[];for(const r of s){const a=e[i],o=this.getTopK(a,t);for(const[h,d]of o)h===this.blankIdx?n.push({text:r.text,score:r.score*d,lastIdx:h}):h!==r.lastIdx?n.push({text:r.text+this.characterDict[h],score:r.score*d,lastIdx:h}):n.push({text:r.text,score:r.score*d,lastIdx:h})}n.sort((r,a)=>a.score-r.score),s=n.slice(0,t)}return s}getTopK(e,t){const s=e.map((i,n)=>[n,i]);return s.sort((i,n)=>n[1]-i[1]),s.slice(0,t)}calculateConfidence(e,t){if(t.length===0)return 0;let s=0,i=0;for(const n of t)for(;i<e.length;){if(e[i].indexOf(Math.max(...e[i]))===n){s+=e[i][n],i++;break}i++}return s/t.length}}function et(c){if(!c||c.length===0)return[];const e=c.map((t,s)=>{const i=t.reduce((r,a)=>r+a[0],0)/t.length,n=t.reduce((r,a)=>r+a[1],0)/t.length;return{box:t,index:s,centerX:i,centerY:n}});return e.sort((t,s)=>Math.abs(t.centerY-s.centerY)<10?t.centerX-s.centerX:t.centerY-s.centerY),e.map(t=>t.box)}const tt=window.location.hostname.includes("github.io"),ue=tt?"/client-ocr-app":"",nt=`${ue}/assets/`;ie.wasm.wasmPaths=nt;ie.wasm.numThreads=1;class pe{constructor(e={}){this.modelName=e.modelName||"PP-OCRv5",this.useAngleCls=e.useAngleCls!==!1,this.useCache=e.useCache!==!1;const t=`${ue}/models/`;this.modelPaths={"PP-OCRv5":{det:t+"PP-OCRv5/det/det.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5/rec/rec.onnx",dict:t+"PP-OCRv5/ppocrv5_dict.txt"},"PP-OCRv5_mobile":{det:t+"PP-OCRv5_mobile_det_infer.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5_mobile_rec_infer.onnx",dict:t+"ppocrv5_dict.txt"},"PP-OCRv4":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"PP-OCRv4/rec/rec.onnx",dict:t+"PP-OCRv4/ppocr_keys_v1.txt"},"PP-OCRv4_mobile":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"en_PP-OCRv4_mobile_rec_infer.onnx",dict:t+"en_dict.txt"},"ch_ppocr_server_v2.0":{det:t+"ch_ppocr_server_v2.0/det/det.onnx",cls:t+"ch_ppocr_server_v2.0/cls/cls.onnx",rec:null,dict:t+"ch_ppocr_server_v2.0/ppocr_keys_v1.txt"}},this.detParams={det_limit_side_len:e.detLimitSideLen||960,det_limit_type:e.detLimitType||"min",det_db_thresh:e.detDbThresh||.3,det_db_box_thresh:e.detDbBoxThresh||.6,det_db_unclip_ratio:e.detDbUnclipRatio||1.7,det_db_score_mode:e.detDbScoreMode||"fast"},this.clsParams={cls_image_shape:[3,48,192],cls_thresh:e.clsThresh||.9,label_list:["0","180"]},this.recParams={rec_image_shape:[3,48,320],rec_algorithm:"SVTR_LCNet"},this.detPreprocessor=new ge(this.detParams),this.clsPreprocessor=new Xe(this.clsParams),this.recPreprocessor=new be(this.recParams),this.detPostprocessor=new Ae({thresh:this.detParams.det_db_thresh,box_thresh:this.detParams.det_db_box_thresh,unclip_ratio:this.detParams.det_db_unclip_ratio,score_mode:this.detParams.det_db_score_mode}),this.clsPostprocessor=new ke(this.clsParams),this.detSession=null,this.clsSession=null,this.recSession=null,this.characterDict=null,this.ctcDecoder=null,this.initialized=!1}async initialize(e=null){if(!this.initialized)try{const t=this.modelPaths[this.modelName];if(!t)throw new Error(`Unknown model: ${this.modelName}`);if(e==null||e("Loading character dictionary..."),await this.loadCharacterDict(t.dict),e==null||e("Loading detection model..."),this.detSession=await G.create(t.det,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),this.useAngleCls&&(e==null||e("Loading angle classification model..."),this.clsSession=await G.create(t.cls,{executionProviders:["wasm"],graphOptimizationLevel:"all"})),t.rec)e==null||e("Loading recognition model..."),this.recSession=await G.create(t.rec,{executionProviders:["wasm"],graphOptimizationLevel:"all"});else if(this.modelName==="ch_ppocr_server_v2.0"){const s=`${ue}/models/PP-OCRv4/rec/rec.onnx`;e==null||e("Loading recognition model (fallback)..."),this.recSession=await G.create(s,{executionProviders:["wasm"],graphOptimizationLevel:"all"})}this.initialized=!0,e==null||e("Initialization complete!")}catch(t){throw console.error("Failed to initialize PP-OCRv5 ONNX engine:",t),t}}async loadCharacterDict(e){try{const s=await(await fetch(e)).text();this.characterDict=s.split(`
`).filter(i=>i.length>0),this.ctcDecoder=new ze(this.characterDict)}catch(t){throw console.error("Failed to load character dictionary:",t),t}}async process(e,t=null){if(this.initialized||await this.initialize(t),this.useCache){const h=await this.checkCache(e);if(h)return t==null||t("Using cached result"),h}const s=await this.inputToCanvas(e);t==null||t("Detecting text regions...");const i=await this.detectText(s);if(!i||i.boxes.length===0)return{text:"",boxes:[],lines:[]};const n=et(i.boxes),r=[];for(let h=0;h<n.length;h++){t==null||t(`Processing region ${h+1}/${n.length}...`);const d=n[h],l=Ve.extractRegion(s,d);let p=0;if(this.useAngleCls&&this.clsSession&&(await this.classifyAngle(l)).shouldRotate){const x=this.rotateCanvas(l,180);l.width=x.width,l.height=x.height,l.getContext("2d").drawImage(x,0,0),p=180}const w=await this.recognizeText(l);r.push({box:d,text:w.text,confidence:w.confidence,angle:p})}const o={text:r.map(h=>h.text).join(`
`),boxes:n,lines:r,modelName:this.modelName};return this.useCache&&await this.cacheResult(e,o),o}async detectText(e){const t=await this.detPreprocessor.preprocess(e),i={x:new se("float32",t.tensor,[1,3,t.resizedShape[0],t.resizedShape[1]])},n=await this.detSession.run(i),r=n.sigmoid_0||n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],a=r.data,[,,o,h]=r.dims,d=[];for(let p=0;p<o;p++){d[p]=[];for(let w=0;w<h;w++)d[p][w]=a[p*h+w]}return this.detPostprocessor.process([d],[t.originalShape.concat(t.ratio)])}async classifyAngle(e){const t=await this.clsPreprocessor.preprocess(e),i={x:new se("float32",t,[1,...this.clsParams.cls_image_shape])},n=await this.clsSession.run(i),r=n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],a=Array.from(r.data);return this.clsPostprocessor.process([a])[0]}async recognizeText(e){if(!this.recSession)return{text:"",confidence:0};const t=e.width/e.height,s=await this.recPreprocessor.preprocess(e,t),n={x:new se("float32",s.tensor,s.shape)},r=await this.recSession.run(n),a=r.save_infer_model_scale_0_tmp_1||Object.values(r)[0],[,o,h]=a.dims,d=a.data,l=[];for(let w=0;w<o;w++){const v=[];for(let x=0;x<h;x++)v.push(d[w*h+x]);l.push(v)}return this.ctcDecoder.decode([l],"greedy")[0]}async inputToCanvas(e){if(e instanceof HTMLCanvasElement)return e;const t=document.createElement("canvas"),s=t.getContext("2d");if(e instanceof File||e instanceof Blob){const i=new Image,n=URL.createObjectURL(e);return new Promise((r,a)=>{i.onload=()=>{t.width=i.width,t.height=i.height,s.drawImage(i,0,0),URL.revokeObjectURL(n),r(t)},i.onerror=a,i.src=n})}else if(typeof e=="string"){const i=new Image;return i.crossOrigin="anonymous",new Promise((n,r)=>{i.onload=()=>{t.width=i.width,t.height=i.height,s.drawImage(i,0,0),n(t)},i.onerror=r,i.src=e})}throw new Error("Unsupported input type")}rotateCanvas(e,t){const s=t*Math.PI/180,i=document.createElement("canvas"),n=i.getContext("2d");return t===180?(i.width=e.width,i.height=e.height,n.translate(e.width,e.height),n.rotate(s),n.drawImage(e,0,0)):t===90||t===-270?(i.width=e.height,i.height=e.width,n.translate(e.height,0),n.rotate(s),n.drawImage(e,0,0)):(t===-90||t===270)&&(i.width=e.height,i.height=e.width,n.translate(0,e.width),n.rotate(s),n.drawImage(e,0,0)),i}async checkCache(e){if(!this.useCache)return null;const t=await this.generateCacheKey(e);return D.get(t,"ppocr-v5-onnx",this.modelName)}async cacheResult(e,t){if(!this.useCache)return;const s=await this.generateCacheKey(e);D.set(s,"ppocr-v5-onnx",this.modelName,t)}async generateCacheKey(e){return e instanceof File?await this.fileToBase64(e):typeof e=="string"?e:e instanceof HTMLCanvasElement?e.toDataURL():JSON.stringify(e)}async fileToBase64(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=n=>t(n.target.result),i.onerror=s,i.readAsDataURL(e)})}getCacheStats(){return D.getStats()}clearCache(){D.clear()}}new pe;class De{static getPresets(){return{high_accuracy:{detLimitSideLen:1920,detDbThresh:.2,detDbBoxThresh:.5,detDbUnclipRatio:2,dropScore:.3,useAngleCls:!0},fast_processing:{detLimitSideLen:640,detDbThresh:.4,detDbBoxThresh:.7,detDbUnclipRatio:1.5,dropScore:.6,useAngleCls:!1},balanced:{detLimitSideLen:960,detDbThresh:.3,detDbBoxThresh:.6,detDbUnclipRatio:1.7,dropScore:.5,useAngleCls:!0},handwritten:{detLimitSideLen:1280,detDbThresh:.15,detDbBoxThresh:.4,detDbUnclipRatio:2.5,dropScore:.3,useAngleCls:!0},low_quality:{detLimitSideLen:1440,detDbThresh:.1,detDbBoxThresh:.3,detDbUnclipRatio:3,dropScore:.2,useAngleCls:!0}}}static mergeWithPreset(e,t={}){const s=this.getPresets();return{...s[e]||s.balanced,...t}}}var st={exports:{}};(function(c){var e=function(t){var s=Object.prototype,i=s.hasOwnProperty,n=Object.defineProperty||function(m,u,g){m[u]=g.value},r,a=typeof Symbol=="function"?Symbol:{},o=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function l(m,u,g){return Object.defineProperty(m,u,{value:g,enumerable:!0,configurable:!0,writable:!0}),m[u]}try{l({},"")}catch{l=function(u,g,y){return u[g]=y}}function p(m,u,g,y){var f=u&&u.prototype instanceof M?u:M,_=Object.create(f.prototype),P=new X(y||[]);return n(_,"_invoke",{value:oe(m,g,P)}),_}t.wrap=p;function w(m,u,g){try{return{type:"normal",arg:m.call(u,g)}}catch(y){return{type:"throw",arg:y}}}var v="suspendedStart",x="suspendedYield",L="executing",I="completed",O={};function M(){}function A(){}function T(){}var H={};l(H,o,function(){return this});var N=Object.getPrototypeOf,K=N&&N(N(V([])));K&&K!==s&&i.call(K,o)&&(H=K);var B=T.prototype=M.prototype=Object.create(H);A.prototype=T,n(B,"constructor",{value:T,configurable:!0}),n(T,"constructor",{value:A,configurable:!0}),A.displayName=l(T,d,"GeneratorFunction");function k(m){["next","throw","return"].forEach(function(u){l(m,u,function(g){return this._invoke(u,g)})})}t.isGeneratorFunction=function(m){var u=typeof m=="function"&&m.constructor;return u?u===A||(u.displayName||u.name)==="GeneratorFunction":!1},t.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,T):(m.__proto__=T,l(m,d,"GeneratorFunction")),m.prototype=Object.create(B),m},t.awrap=function(m){return{__await:m}};function Y(m,u){function g(_,P,S,E){var R=w(m[_],m,P);if(R.type==="throw")E(R.arg);else{var j=R.arg,C=j.value;return C&&typeof C=="object"&&i.call(C,"__await")?u.resolve(C.__await).then(function($){g("next",$,S,E)},function($){g("throw",$,S,E)}):u.resolve(C).then(function($){j.value=$,S(j)},function($){return g("throw",$,S,E)})}}var y;function f(_,P){function S(){return new u(function(E,R){g(_,P,E,R)})}return y=y?y.then(S,S):S()}n(this,"_invoke",{value:f})}k(Y.prototype),l(Y.prototype,h,function(){return this}),t.AsyncIterator=Y,t.async=function(m,u,g,y,f){f===void 0&&(f=Promise);var _=new Y(p(m,u,g,y),f);return t.isGeneratorFunction(u)?_:_.next().then(function(P){return P.done?P.value:_.next()})};function oe(m,u,g){var y=v;return function(_,P){if(y===L)throw new Error("Generator is already running");if(y===I){if(_==="throw")throw P;return ee()}for(g.method=_,g.arg=P;;){var S=g.delegate;if(S){var E=Z(S,g);if(E){if(E===O)continue;return E}}if(g.method==="next")g.sent=g._sent=g.arg;else if(g.method==="throw"){if(y===v)throw y=I,g.arg;g.dispatchException(g.arg)}else g.method==="return"&&g.abrupt("return",g.arg);y=L;var R=w(m,u,g);if(R.type==="normal"){if(y=g.done?I:x,R.arg===O)continue;return{value:R.arg,done:g.done}}else R.type==="throw"&&(y=I,g.method="throw",g.arg=R.arg)}}}function Z(m,u){var g=u.method,y=m.iterator[g];if(y===r)return u.delegate=null,g==="throw"&&m.iterator.return&&(u.method="return",u.arg=r,Z(m,u),u.method==="throw")||g!=="return"&&(u.method="throw",u.arg=new TypeError("The iterator does not provide a '"+g+"' method")),O;var f=w(y,m.iterator,u.arg);if(f.type==="throw")return u.method="throw",u.arg=f.arg,u.delegate=null,O;var _=f.arg;if(!_)return u.method="throw",u.arg=new TypeError("iterator result is not an object"),u.delegate=null,O;if(_.done)u[m.resultName]=_.value,u.next=m.nextLoc,u.method!=="return"&&(u.method="next",u.arg=r);else return _;return u.delegate=null,O}k(B),l(B,d,"Generator"),l(B,o,function(){return this}),l(B,"toString",function(){return"[object Generator]"});function ae(m){var u={tryLoc:m[0]};1 in m&&(u.catchLoc=m[1]),2 in m&&(u.finallyLoc=m[2],u.afterLoc=m[3]),this.tryEntries.push(u)}function U(m){var u=m.completion||{};u.type="normal",delete u.arg,m.completion=u}function X(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(ae,this),this.reset(!0)}t.keys=function(m){var u=Object(m),g=[];for(var y in u)g.push(y);return g.reverse(),function f(){for(;g.length;){var _=g.pop();if(_ in u)return f.value=_,f.done=!1,f}return f.done=!0,f}};function V(m){if(m){var u=m[o];if(u)return u.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var g=-1,y=function f(){for(;++g<m.length;)if(i.call(m,g))return f.value=m[g],f.done=!1,f;return f.value=r,f.done=!0,f};return y.next=y}}return{next:ee}}t.values=V;function ee(){return{value:r,done:!0}}return X.prototype={constructor:X,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(U),!m)for(var u in this)u.charAt(0)==="t"&&i.call(this,u)&&!isNaN(+u.slice(1))&&(this[u]=r)},stop:function(){this.done=!0;var m=this.tryEntries[0],u=m.completion;if(u.type==="throw")throw u.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var u=this;function g(E,R){return _.type="throw",_.arg=m,u.next=E,R&&(u.method="next",u.arg=r),!!R}for(var y=this.tryEntries.length-1;y>=0;--y){var f=this.tryEntries[y],_=f.completion;if(f.tryLoc==="root")return g("end");if(f.tryLoc<=this.prev){var P=i.call(f,"catchLoc"),S=i.call(f,"finallyLoc");if(P&&S){if(this.prev<f.catchLoc)return g(f.catchLoc,!0);if(this.prev<f.finallyLoc)return g(f.finallyLoc)}else if(P){if(this.prev<f.catchLoc)return g(f.catchLoc,!0)}else if(S){if(this.prev<f.finallyLoc)return g(f.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(m,u){for(var g=this.tryEntries.length-1;g>=0;--g){var y=this.tryEntries[g];if(y.tryLoc<=this.prev&&i.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var f=y;break}}f&&(m==="break"||m==="continue")&&f.tryLoc<=u&&u<=f.finallyLoc&&(f=null);var _=f?f.completion:{};return _.type=m,_.arg=u,f?(this.method="next",this.next=f.finallyLoc,O):this.complete(_)},complete:function(m,u){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&u&&(this.next=u),O},finish:function(m){for(var u=this.tryEntries.length-1;u>=0;--u){var g=this.tryEntries[u];if(g.finallyLoc===m)return this.complete(g.completion,g.afterLoc),U(g),O}},catch:function(m){for(var u=this.tryEntries.length-1;u>=0;--u){var g=this.tryEntries[u];if(g.tryLoc===m){var y=g.completion;if(y.type==="throw"){var f=y.arg;U(g)}return f}}throw new Error("illegal catch attempt")},delegateYield:function(m,u,g){return this.delegate={iterator:V(m),resultName:u,nextLoc:g},this.method==="next"&&(this.arg=r),O}},t}(c.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(st);var _e=(c,e)=>`${c}-${e}-${Math.random().toString(16).slice(3,8)}`;const it=_e;let ve=0;var Ce=({id:c,action:e,payload:t={}})=>{let s=c;return typeof s>"u"&&(s=it("Job",ve),ve+=1),{id:s,action:e,payload:t}},J={};let we=!1;J.logging=we;J.setLogging=c=>{we=c};J.log=(...c)=>we?console.log.apply(void 0,c):null;const rt=Ce,{log:te}=J,ot=_e;let ye=0;var at=()=>{const c=ot("Scheduler",ye),e={},t={};let s=[];ye+=1;const i=()=>s.length,n=()=>Object.keys(e).length,r=()=>{if(s.length!==0){const l=Object.keys(e);for(let p=0;p<l.length;p+=1)if(typeof t[l[p]]>"u"){s[0](e[l[p]]);break}}},a=(l,p)=>new Promise((w,v)=>{const x=rt({action:l,payload:p});s.push(async L=>{s.shift(),t[L.id]=x;try{w(await L[l].apply(void 0,[...p,x.id]))}catch(I){v(I)}finally{delete t[L.id],r()}}),te(`[${c}]: Add ${x.id} to JobQueue`),te(`[${c}]: JobQueue length=${s.length}`),r()});return{addWorker:l=>(e[l.id]=l,te(`[${c}]: Add ${l.id}`),te(`[${c}]: Number of workers=${n()}`),r(),l.id),addJob:async(l,...p)=>{if(n()===0)throw Error(`[${c}]: You need to have at least one worker before adding jobs`);return a(l,p)},terminate:async()=>{Object.keys(e).forEach(async l=>{await e[l].terminate()}),s=[]},getQueueLen:i,getNumWorkers:n}};function ct(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var ht=ct;const dt=ht;var lt=c=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":dt()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof Ye=="function"&&(e.type="node"),typeof c>"u"?e:e[c]};const ut=lt("type")==="browser",ft=ut?c=>new URL(c,window.location.href).href:c=>c;var mt=c=>{const e={...c};return["corePath","workerPath","langPath"].forEach(t=>{c[t]&&(e[t]=ft(e[t]))}),e},gt=c=>{const e=[],t=[],s=[],i=[],n=[];return c.blocks&&c.blocks.forEach(r=>{r.paragraphs.forEach(a=>{a.lines.forEach(o=>{o.words.forEach(h=>{h.symbols.forEach(d=>{n.push({...d,page:c,block:r,paragraph:a,line:o,word:h})}),i.push({...h,page:c,block:r,paragraph:a,line:o})}),s.push({...o,page:c,block:r,paragraph:a})}),t.push({...a,page:c,block:r})}),e.push({...r,page:c})}),{...c,blocks:e,paragraphs:t,lines:s,words:i,symbols:n}},$e={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const pt="5.1.1",_t={version:pt};var wt={workerBlobURL:!0,logger:()=>{}};const vt=_t.version,yt=wt;var xt={...yt,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${vt}/dist/worker.min.js`},Pt=({workerPath:c,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const s=new Blob([`importScripts("${c}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(s))}else t=new Worker(c);return t},Lt=c=>{c.terminate()},St=(c,e)=>{c.onmessage=({data:t})=>{e(t)}},Et=async(c,e)=>{c.postMessage(e)};const he=c=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{e(s.result)},s.onerror=({target:{error:{code:i}}})=>{t(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(c)}),fe=async c=>{let e=c;if(typeof c>"u")return"undefined";if(typeof c=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(c)?e=atob(c.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(c)).arrayBuffer();else if(typeof HTMLElement<"u"&&c instanceof HTMLElement)c.tagName==="IMG"&&(e=await fe(c.src)),c.tagName==="VIDEO"&&(e=await fe(c.poster)),c.tagName==="CANVAS"&&await new Promise(t=>{c.toBlob(async s=>{e=await he(s),t()})});else if(typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas){const t=await c.convertToBlob();e=await he(t)}else(c instanceof File||c instanceof Blob)&&(e=await he(c));return new Uint8Array(e)};var Ot=fe;const Rt=xt,Tt=Pt,It=Lt,Mt=St,bt=Et,At=Ot;var zt={defaultOptions:Rt,spawnWorker:Tt,terminateWorker:It,onMessage:Mt,send:bt,loadImage:At};const Dt=mt,Ct=gt,z=Ce,{log:xe}=J,$t=_e,F=$e,{defaultOptions:Nt,spawnWorker:Bt,terminateWorker:jt,onMessage:Ut,loadImage:Pe,send:Ft}=zt;let Le=0;var Ne=async(c="eng",e=F.LSTM_ONLY,t={},s={})=>{const i=$t("Worker",Le),{logger:n,errorHandler:r,...a}=Dt({...Nt,...t}),o={},h={},d=typeof c=="string"?c.split("+"):c;let l=e,p=s;const w=[F.DEFAULT,F.LSTM_ONLY].includes(e)&&!a.legacyCore;let v,x;const L=new Promise((f,_)=>{x=f,v=_}),I=f=>{v(f.message)};let O=Bt(a);O.onerror=I,Le+=1;const M=(f,_)=>{o[f]=_},A=(f,_)=>{h[f]=_},T=({id:f,action:_,payload:P})=>new Promise((S,E)=>{xe(`[${i}]: Start ${f}, action=${_}`);const R=`${_}-${f}`;M(R,S),A(R,E),Ft(O,{workerId:i,jobId:f,action:_,payload:P})}),H=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),N=f=>T(z({id:f,action:"load",payload:{options:{lstmOnly:w,corePath:a.corePath,logging:a.logging}}})),K=(f,_,P)=>T(z({id:P,action:"FS",payload:{method:"writeFile",args:[f,_]}})),B=(f,_)=>T(z({id:_,action:"FS",payload:{method:"readFile",args:[f,{encoding:"utf8"}]}})),k=(f,_)=>T(z({id:_,action:"FS",payload:{method:"unlink",args:[f]}})),Y=(f,_,P)=>T(z({id:P,action:"FS",payload:{method:f,args:_}})),oe=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),Z=(f,_)=>T(z({id:_,action:"loadLanguage",payload:{langs:f,options:{langPath:a.langPath,dataPath:a.dataPath,cachePath:a.cachePath,cacheMethod:a.cacheMethod,gzip:a.gzip,lstmOnly:[F.DEFAULT,F.LSTM_ONLY].includes(l)&&!a.legacyLang}}})),ae=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),U=(f,_,P,S)=>T(z({id:S,action:"initialize",payload:{langs:f,oem:_,config:P}})),X=(f="eng",_,P,S)=>{if(w&&[F.TESSERACT_ONLY,F.TESSERACT_LSTM_COMBINED].includes(_))throw Error("Legacy model requested but code missing.");const E=_||l;l=E;const R=P||p;p=R;const C=(typeof f=="string"?f.split("+"):f).filter($=>!d.includes($));return d.push(...C),C.length>0?Z(C,S).then(()=>U(f,E,R,S)):U(f,E,R,S)},V=(f={},_)=>T(z({id:_,action:"setParameters",payload:{params:f}})),ee=async(f,_={},P={blocks:!0,text:!0,hocr:!0,tsv:!0},S)=>T(z({id:S,action:"recognize",payload:{image:await Pe(f),options:_,output:P}})),m=(f="Tesseract OCR Result",_=!1,P)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),T(z({id:P,action:"getPDF",payload:{title:f,textonly:_}}))),u=async(f,_)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return T(z({id:_,action:"detect",payload:{image:await Pe(f)}}))},g=async()=>(O!==null&&(jt(O),O=null),Promise.resolve());Ut(O,({workerId:f,jobId:_,status:P,action:S,data:E})=>{const R=`${S}-${_}`;if(P==="resolve"){xe(`[${f}]: Complete ${_}`);let j=E;S==="recognize"?j=Ct(E):S==="getPDF"&&(j=Array.from({...E,length:Object.keys(E).length})),o[R]({jobId:_,data:j})}else if(P==="reject")if(h[R](E),S==="load"&&v(E),r)r(E);else throw Error(E);else P==="progress"&&n({...E,userJobId:_})});const y={id:i,worker:O,setResolve:M,setReject:A,load:H,writeText:K,readText:B,removeFile:k,FS:Y,loadLanguage:oe,initialize:ae,reinitialize:X,setParameters:V,recognize:ee,getPDF:m,detect:u,terminate:g};return N().then(()=>Z(c)).then(()=>U(c,e,s)).then(()=>x(y)).catch(()=>{}),L};const Be=Ne,Gt=async(c,e,t)=>{const s=await Be(e,1,t);return s.recognize(c).finally(async()=>{await s.terminate()})},Wt=async(c,e)=>{const t=await Be("osd",0,e);return t.detect(c).finally(async()=>{await t.terminate()})};var Ht={recognize:Gt,detect:Wt},Kt={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},Yt={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const qt=at,Jt=Ne,Zt=Ht,Xt=Kt,Vt=$e,Qt=Yt,{setLogging:kt}=J;var en={languages:Xt,OEM:Vt,PSM:Qt,createScheduler:qt,createWorker:Jt,setLogging:kt,...Zt};const tn=Ie(en),je=window.location.hostname.includes("github.io"),nn=je?"/client-ocr-app":"",sn=`${nn}/assets/`;ie.wasm.wasmPaths=sn;ie.wasm.numThreads=navigator.hardwareConcurrency||4;class Ue{constructor(e={}){this.config={modelPath:e.modelPath||"models/PP-OCRv5",useAngleCls:e.useAngleCls!==!1,useGPU:e.useGPU||!1,detLimitSideLen:e.detLimitSideLen||960,detDbThresh:e.detDbThresh||.3,detDbBoxThresh:e.detDbBoxThresh||.6,detDbUnclipRatio:e.detDbUnclipRatio||1.7,dropScore:e.dropScore||.5,...e},this.detSession=null,this.clsSession=null,this.recSession=null,this.detPreprocessor=new ge({det_limit_side_len:this.config.detLimitSideLen,det_limit_type:"min"}),this.recPreprocessor=new be,this.clsPreprocessor=new Qe,this.dbPostProcess=new Ae({thresh:this.config.detDbThresh,box_thresh:this.config.detDbBoxThresh,max_candidates:1e3,unclip_ratio:this.config.detDbUnclipRatio}),this.dictionary=null,this.dictPath=null,this.initialized=!1,this.selectedModels={det:null,cls:null,rec:null,dict:null}}async initialize(e){if(!this.initialized)try{const t=je?`/client-ocr-app${this.config.modelPath}`:this.config.modelPath,s=this.config.modelPath.startsWith("/")?this.config.modelPath.substring(1):this.config.modelPath;this.selectedModels={det:`${s}/det/det.onnx`,cls:this.config.useAngleCls?`${s}/cls/cls.onnx`:"disabled",rec:`${s}/rec/rec.onnx`,dict:`${s}/ppocrv5_dict.txt`},e==null||e({phase:"model_selection",models:this.selectedModels,message:`Loading models: DET=${this.selectedModels.det}, CLS=${this.selectedModels.cls}, REC=${this.selectedModels.rec}`});const i={executionProviders:this.config.useGPU?["webgl","wasm"]:["wasm"],graphOptimizationLevel:"all",enableCpuMemArena:!0,enableMemPattern:!0,executionMode:"sequential"};e==null||e({phase:"loading",message:"Loading detection model..."});const n=`${t}/det/det.onnx`;if(this.detSession=await G.create(n,i),e==null||e({phase:"loaded",message:"Detection model loaded",model:"det"}),this.config.useAngleCls){e==null||e({phase:"loading",message:"Loading angle classification model..."});const a=`${t}/cls/cls.onnx`;this.clsSession=await G.create(a,i),e==null||e({phase:"loaded",message:"Classification model loaded",model:"cls"})}e==null||e({phase:"loading",message:"Loading recognition model..."});const r=`${t}/rec/rec.onnx`;this.recSession=await G.create(r,i),e==null||e({phase:"loaded",message:"Recognition model loaded",model:"rec"}),e==null||e({phase:"loading",message:"Loading dictionary..."}),this.dictPath=`${t}/ppocrv5_dict.txt`,await this.loadDictionary(this.dictPath),e==null||e({phase:"loaded",message:"Dictionary loaded",dict:this.dictPath}),this.initialized=!0,e==null||e({phase:"ready",message:"OnnxOCR engine initialized successfully",models:this.selectedModels})}catch(t){throw console.error("Failed to initialize OnnxOCR:",t),e==null||e({phase:"error",message:t.message}),t}}async loadDictionary(e){try{const s=await(await fetch(e)).text();this.dictionary=s.trim().split(`
`),this.dictionary.unshift("blank")}catch(t){throw console.error("Failed to load dictionary:",t),t}}async detect(e,t){if(!this.initialized)throw new Error("OnnxOCR engine not initialized");const s=await this.generateCacheKey(e),i=D.get(s,"onnxocr",this.config.modelPath);if(i)return t==null||t({phase:"cache_hit",message:"Using cached results"}),i;try{t==null||t({phase:"preprocessing",message:"Preprocessing image..."});const n=await this.detPreprocessor.preprocess(e);t==null||t({phase:"detection",message:"Detecting text regions..."});const r=await this.detSession.run({x:n.tensor}),a=await this.dbPostProcess.process(r.sigmoid_0||r.output,n.originalSize,n.resizedSize,n.ratio);if(a.length===0){const d={text:"",boxes:[],lines:[]};return D.set(s,"onnxocr",this.config.modelPath,d),d}t==null||t({phase:"detection_complete",message:`Found ${a.length} text regions`});const o=[];for(let d=0;d<a.length;d++){t==null||t({phase:"recognition",message:`Processing region ${d+1}/${a.length}...`,progress:d/a.length*100});const l=a[d],p=await this.cropImageToBox(e,l.points);let w=0;if(this.config.useAngleCls&&this.clsSession){const A=await this.clsPreprocessor.preprocess(p),T=await this.clsSession.run({x:A.tensor}),N=(T.softmax_0||T.output).data;w=N[1]>N[0]?180:0,w===180&&p.getContext("2d").rotate(Math.PI)}const v=await this.recPreprocessor.preprocess(p),x=await this.recSession.run({x:v.tensor}),L=x.softmax_0||x.output,I=new ze(this.dictionary),[O,M]=I.decode(L.data,L.dims);M>=this.config.dropScore&&o.push({text:O.trim(),confidence:M,box:l.points,angle:w})}o.sort((d,l)=>{const p=Math.min(...d.box.map(v=>v[1])),w=Math.min(...l.box.map(v=>v[1]));if(Math.abs(p-w)<10){const v=Math.min(...d.box.map(L=>L[0])),x=Math.min(...l.box.map(L=>L[0]));return v-x}return p-w});const h={text:o.map(d=>d.text).join(`
`),boxes:o.map(d=>d.box),lines:o,modelInfo:this.selectedModels};return D.set(s,"onnxocr",this.config.modelPath,h),t==null||t({phase:"complete",message:"OCR processing complete",resultCount:o.length}),h}catch(n){throw console.error("OCR processing error:",n),t==null||t({phase:"error",message:n.message}),n}}async cropImageToBox(e,t){const s=document.createElement("canvas"),i=s.getContext("2d"),n=t.map(w=>w[0]),r=t.map(w=>w[1]),a=Math.min(...n),o=Math.max(...n),h=Math.min(...r),d=Math.max(...r),l=o-a,p=d-h;return s.width=l,s.height=p,i.drawImage(e,a,h,l,p,0,0,l,p),s}async generateCacheKey(e){const t=document.createElement("canvas"),s=t.getContext("2d"),i=64;return t.width=i,t.height=i,s.drawImage(e,0,0,i,i),t.toDataURL("image/jpeg",.5)}async process(e,t){const s=await this.fileToImage(e);return await this.detect(s,t)}async fileToImage(e){return new Promise((t,s)=>{const i=new Image,n=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(n),t(i)},i.onerror=()=>{URL.revokeObjectURL(n),s(new Error("Failed to load image"))},i.src=n})}getSelectedModels(){return this.selectedModels}}new Ue;class rn{constructor(){this.engine=null,this.initialized=!1,this.CONFIG={},this.config={}}async initialize(e){if(!this.initialized)try{this.engine=new Ue({modelPath:"models/PP-OCRv5",useAngleCls:!0,useGPU:!1}),await this.engine.initialize(e),this.initialized=!0,e==null||e({status:"ready",message:"PaddleOCR initialized successfully!"})}catch(t){throw console.error("Failed to initialize PaddleOCR:",t),t}}async init(){return this.initialize()}async detect(e){if(!this.initialized||!this.engine)throw new Error("PaddleOCR not initialized");return await this.engine.detect(e)}async process(e,t){if(!this.initialized||!this.engine)throw new Error("PaddleOCR not initialized");return await this.engine.process(e,t)}applyConfig(e){this.engine&&(Object.assign(this.engine.config,e),this.CONFIG={...this.CONFIG,...e},this.config={...this.config,...e})}getSelectedModels(){return this.engine?this.engine.getSelectedModels():null}}const Se={GENERAL_TEXT:{detection:{det_limit_side_len:1536,det_db_thresh:.25,det_db_box_thresh:.45,det_db_unclip_ratio:1.7,det_db_min_size:3,det_db_max_candidates:2e3,grid_size:16,min_area_thresh:20},recognition:{rec_batch_num:24,drop_score:.4,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:1.5,sharpen_amount:1,denoise:!0}},INFOGRAPHIC_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.12,det_db_box_thresh:.35,det_db_unclip_ratio:2,det_db_min_size:2,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:10},recognition:{rec_batch_num:32,drop_score:.3,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.8,sharpen_amount:1.3,enhance_colors:!0,segment_regions:!0}},DOCUMENT_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.08,det_db_box_thresh:.25,det_db_unclip_ratio:1.5,det_db_min_size:2,det_db_max_candidates:5e3,grid_size:4,min_area_thresh:5},recognition:{rec_batch_num:32,drop_score:.25,rec_image_height:64,rec_image_width:640},preprocessing:{enhance_contrast:!0,contrast_factor:2,sharpen_amount:1.5,remove_background:!0,deskew:!0,fix_orientation:!0}},RECEIPT_OPTIMIZED:{detection:{det_limit_side_len:1920,det_db_thresh:.05,det_db_box_thresh:.2,det_db_unclip_ratio:1.3,det_db_min_size:1,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:3},recognition:{rec_batch_num:24,drop_score:.2,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:2.5,sharpen_amount:1.8,enhance_thermal:!0,fix_faded_text:!0,binary_threshold:!0}},PDF_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.15,det_db_box_thresh:.3,det_db_unclip_ratio:1.6,det_db_min_size:3,det_db_max_candidates:3500,grid_size:12,min_area_thresh:15},recognition:{rec_batch_num:32,drop_score:.35,rec_image_height:48,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.6,sharpen_amount:1.2,normalize_lighting:!0,remove_watermarks:!0}},ID_CARD_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.06,det_db_box_thresh:.15,det_db_unclip_ratio:1.2,det_db_min_size:1,det_db_max_candidates:3e3,grid_size:4,min_area_thresh:2},recognition:{rec_batch_num:16,drop_score:.15,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:2.2,sharpen_amount:1.6,remove_tint:!0,enhance_security_features:!1,detect_fields:!0}}},on={balanced:"GENERAL_TEXT",high_accuracy:"DOCUMENT_OPTIMIZED",fast_processing:"GENERAL_TEXT",handwritten:"DOCUMENT_OPTIMIZED",low_quality:"RECEIPT_OPTIMIZED"};function an(c,e){const t=on[e]||e,s=Se[t];if(!s){console.error(`Unknown config type: ${e}`);const i=Se.GENERAL_TEXT;i&&c&&Ee(c,i);return}Ee(c,s),console.log(`Applied optimal ${e} (mapped to ${t}) configuration`)}function Ee(c,e){e.detection&&Object.entries(e.detection).forEach(([t,s])=>{c.CONFIG&&(c.CONFIG[t]=s),c.config&&(c.config[t]=s),c.applyConfig&&c.applyConfig({[t]:s})}),e.recognition&&Object.entries(e.recognition).forEach(([t,s])=>{c.CONFIG&&(c.CONFIG[t]=s),c.config&&(c.config[t]=s),c.applyConfig&&c.applyConfig({[t]:s})}),e.preprocessing&&c.preprocessingOptions&&Object.entries(e.preprocessing).forEach(([t,s])=>{c.preprocessingOptions.hasOwnProperty(t)&&(c.preprocessingOptions[t]=s)})}let de=null,ne=null;async function cn(){return de||(de=await tn.createWorker("eng",1,{logger:c=>console.log("Tesseract:",c),workerPath:"https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/worker.min.js",langPath:"https://tessdata.projectnaptha.com/4.0.0",corePath:"https://cdn.jsdelivr.net/npm/tesseract.js-core@5/tesseract-core.wasm.js"})),de}async function hn(){return ne||(ne=new rn,await ne.init()),ne}async function dn(c,e){const s=await(await cn()).recognize(c);return{text:s.data.text,boxes:s.data.words.map(i=>({text:i.text,bbox:i.bbox}))}}async function ln(c,e,t){const s=await hn();e.preset&&e.preset!=="custom"&&an(s,e.preset);const i=await un(c);let n=i;e.preprocessing==="improved"&&(n=(await new ge().preprocess(i)).canvas||i);const r=await s.detect(n);return{text:r.text||"",boxes:r.boxes||[]}}async function un(c){return new Promise((e,t)=>{const s=new Image,i=URL.createObjectURL(c);s.onload=()=>{const n=document.createElement("canvas");n.width=s.width,n.height=s.height,n.getContext("2d").drawImage(s,0,0),URL.revokeObjectURL(i),e(n)},s.onerror=t,s.src=i})}window.OCREngine={processWithTesseract:dn,processWithPaddleOCR:ln,PPOCRv5OnnxEngine:pe,ocrCache:D,AdvancedOCROptions:De};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(c=>{console.log("Service Worker registered:",c),c.addEventListener("updatefound",()=>{const e=c.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&re("New version available! Reload to update.","info")})})}).catch(c=>console.error("Service Worker registration failed:",c))});const W=document.getElementById("dropzone"),Fe=document.getElementById("fileInput"),le=document.getElementById("fileList"),fn=document.getElementById("processBtn"),Oe=document.getElementById("progressSection"),mn=document.getElementById("progressBar"),gn=document.getElementById("progressLabel"),Ge=document.getElementById("resultsContainer"),We=document.getElementById("resultsList");let b=[],Q=null;document.querySelectorAll(".tab").forEach(c=>{c.addEventListener("click",()=>{const e=c.dataset.tab;document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active")),c.classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.toggle("hidden",t.dataset.content!==e)})})});W.addEventListener("click",()=>Fe.click());W.addEventListener("dragover",c=>{c.preventDefault(),W.classList.add("active")});W.addEventListener("dragleave",()=>{W.classList.remove("active")});W.addEventListener("drop",c=>{c.preventDefault(),W.classList.remove("active"),He(c.dataTransfer.files)});Fe.addEventListener("change",c=>{He(c.target.files)});function He(c){b=Array.from(c),Ke()}function Ke(){if(b.length===0){le.classList.add("hidden");return}le.classList.remove("hidden"),le.innerHTML=b.map((c,e)=>`
                <div class="file-item">
                    <div class="file-info">
                        <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <div>
                            <div class="file-name">${c.name}</div>
                            <div class="file-size">${pn(c.size)}</div>
                        </div>
                    </div>
                    <button class="button button-subtle" onclick="removeFile(${e})">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            `).join("")}window.removeFile=function(c){b.splice(c,1),Ke()};function pn(c){if(c===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(c)/Math.log(e));return parseFloat((c/Math.pow(e,s)).toFixed(2))+" "+t[s]}fn.addEventListener("click",async()=>{if(b.length===0){re("Please select files to process","error");return}const c=document.getElementById("engineSelect").value,e=document.getElementById("modelSelect").value,t=document.getElementById("presetSelect").value,s=document.getElementById("angleClassification").checked,i=document.getElementById("cacheResults").checked;Oe.classList.remove("hidden"),Ge.style.display="none",We.innerHTML="";const n=[];for(let r=0;r<b.length;r++){const a=b[r];q(r/b.length*100,`Processing ${a.name}...`);try{let o=null;if(i){const h=await Te(a);o=D.get(h,c,e)}if(!o){if(c==="tesseract")o=await window.OCREngine.processWithTesseract(a,h=>{q(r/b.length*100,h)});else if(c==="paddleocr"){const h={preset:t,preprocessing:"improved",modelVersion:e};o=await window.OCREngine.processWithPaddleOCR(a,h,d=>{q(r/b.length*100,d),d.phase==="model_selection"&&d.models&&Re(d.models)})}else if(c==="ppocr-v5"){const h=t!=="custom"?De.mergeWithPreset(t,{modelName:e,useAngleCls:s,useCache:i}):{modelName:e,useAngleCls:s,useCache:i};(!Q||Q.modelName!==e)&&(Q=new pe(h),await Q.initialize(d=>{q(r/b.length*100,d),d.phase==="model_selection"&&d.models&&Re(d.models)})),o=await Q.process(a,d=>{q(r/b.length*100,d)})}if(i&&o){const h=await Te(a);D.set(h,c,e,o)}}n.push({filename:a.name,text:(o==null?void 0:o.text)||"No text detected",boxes:(o==null?void 0:o.boxes)||[]})}catch(o){console.error("Error processing file:",o),n.push({filename:a.name,text:`Error: ${o.message}`,boxes:[]})}}q(100,"Processing complete!"),_n(n),setTimeout(()=>{Oe.classList.add("hidden")},1e3)});function q(c,e){mn.style.width=c+"%",gn.textContent=e}function _n(c){Ge.style.display="block",We.innerHTML=c.map((e,t)=>`
                <div class="result-item">
                    <div class="result-header">
                        <span class="result-filename">${e.filename}</span>
                        <button class="button button-subtle" onclick="copyText(${t})">
                            Copy Text
                        </button>
                    </div>
                    <div class="result-text">${e.text}</div>
                </div>
            `).join(""),window.results=c}window.copyText=function(c){const e=window.results[c].text;navigator.clipboard.writeText(e).then(()=>{re("Text copied to clipboard","success")})};function Re(c){c&&(document.getElementById("modelInfoSection").style.display="block",document.getElementById("selectedDET").textContent=c.det||"-",document.getElementById("selectedCLS").textContent=c.cls||"-",document.getElementById("selectedREC").textContent=c.rec||"-",document.getElementById("selectedDICT").textContent=c.dict||"-")}function re(c,e="success"){const t=document.createElement("div");t.className=`notification notification-${e}`,t.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${e==="success"?'<polyline points="20 6 9 17 4 12"/>':'<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>'}
                </svg>
                <span>${c}</span>
            `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}async function Te(c){return new Promise((e,t)=>{const s=new FileReader;s.onload=i=>e(i.target.result),s.onerror=t,s.readAsDataURL(c)})}document.getElementById("downloadAllBtn").addEventListener("click",()=>{if(!window.results||window.results.length===0)return;const c=window.results.map(i=>`=== ${i.filename} ===

${i.text}

`).join(`
`),e=new Blob([c],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="ocr-results.txt",s.click(),URL.revokeObjectURL(t)});re("Smart OCR ready!","success");
//# sourceMappingURL=index-BwEy6sdy.js.map
