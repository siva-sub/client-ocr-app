import{b as me,F as he,H as ue}from"./onnxruntime-CqRzMC93.js";import{p as J,c as Ue,g as je}from"./pdfjs-BhC3vFUT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();J.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";me.wasm.wasmPaths="/client-ocr-app/assets/";me.wasm.numThreads=1;const we="/client-ocr-app/models/",O={det_limit_side_len:960,det_db_thresh:.1,det_db_box_thresh:.3,det_db_unclip_ratio:2,det_db_min_size:3,det_db_max_candidates:1e3,rec_image_height:48,rec_image_width:320,rec_batch_num:6,drop_score:.1,det_mean:[.485,.456,.406],det_std:[.229,.224,.225],rec_mean:.5,rec_std:.5,min_area_thresh:5,vertical_gap_threshold:.5};class ke{constructor(){this.detectionSession=null,this.recognitionSession=null,this.charDict=[],this.initialized=!1,this.canvas=null,this.ctx=null,this.modelConfig={detection:"PP-OCRv5_mobile_det_infer.onnx",recognition:"PP-OCRv5_mobile_rec_infer.onnx",dictionary:"ppocr_keys_v1.txt"}}setModelConfig(e){e.detection&&(this.modelConfig.detection=e.detection),e.recognition&&(this.modelConfig.recognition=e.recognition),e.dictionary&&(this.modelConfig.dictionary=e.dictionary),this.initialized=!1}async initialize(e){try{this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),e==null||e({status:"loading",message:"Loading dictionary...",progress:10}),await this.loadDictionary();const n=this.modelConfig.detection.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${n}...`,progress:30}),this.detectionSession&&await this.detectionSession.release(),this.detectionSession=await he.create(we+this.modelConfig.detection,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Detection model loaded:",this.detectionSession.inputNames,this.detectionSession.outputNames);const t=this.modelConfig.recognition.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${t}...`,progress:70}),this.recognitionSession&&await this.recognitionSession.release(),this.recognitionSession=await he.create(we+this.modelConfig.recognition,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Recognition model loaded:",this.recognitionSession.inputNames,this.recognitionSession.outputNames),this.initialized=!0,e==null||e({status:"ready",message:"PP-OCR ready!",progress:100})}catch(n){throw console.error("Failed to initialize PP-OCR models:",n),n}}async loadDictionary(){try{const n=await(await fetch(we+this.modelConfig.dictionary)).text();this.charDict=n.split(`
`).filter(t=>t.trim()),this.charDict.unshift(" "),console.log(`Loaded dictionary ${this.modelConfig.dictionary} with ${this.charDict.length} characters`)}catch(e){console.error("Failed to load dictionary:",e),this.charDict=[" "];for(let n=32;n<127;n++)this.charDict.push(String.fromCharCode(n))}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(e.type==="application/pdf")return await this.processPDF(e);const n=await this.blobToImage(e),t=await this.detectText(n),o=await this.recognizeText(n,t);return this.mergeTextLines(o)}async detectText(e){if(!this.detectionSession)throw new Error("Detection model not loaded");const{resizedImage:n,ratio:t}=await this.resizeForDetection(e),o=await this.preprocessForDetection(n),r={[this.detectionSession.inputNames[0]]:o},c=await this.detectionSession.run(r),d=await this.postprocessDetection(c[this.detectionSession.outputNames[0]],n.width,n.height,t);return this.sortBoxes(d)}async resizeForDetection(e){const n=O.det_limit_side_len;let t=e.width,o=e.height,r=1;Math.max(o,t)>n&&(r=o>t?n/o:n/t),t=Math.round(t*r),o=Math.round(o*r);const c=Math.round(t/32)*32,d=Math.round(o/32)*32;await this.preprocessImage(e,c,d);const i=new Image;return new Promise(l=>{this.canvas.toBlob(m=>{const a=URL.createObjectURL(m);i.onload=()=>{URL.revokeObjectURL(a),l({resizedImage:i,ratio:r})},i.src=a})})}async preprocessImage(e,n,t){this.canvas.width=n,this.canvas.height=t,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,n,t),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high";const o=Math.min(n/e.width,t/e.height),r=e.width*o,c=e.height*o,d=(n-r)/2,i=(t-c)/2;this.ctx.drawImage(e,d,i,r,c);const l=this.ctx.getImageData(0,0,n,t),m=l.data;for(let a=0;a<m.length;a+=4){let w=(.299*m[a]+.587*m[a+1]+.114*m[a+2]-128)*1.5+128;w=Math.max(0,Math.min(255,w)),w>200?w=255:w<50&&(w=0),m[a]=w,m[a+1]=w,m[a+2]=w}return this.ctx.putImageData(l,0,0),this.canvas}async preprocessForDetection(e){this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const t=this.ctx.getImageData(0,0,e.width,e.height).data,o=e.width*e.height,r=new Float32Array(3*o);for(let c=0;c<o;c++){const d=c*4;r[c]=(t[d]/255-O.det_mean[0])/O.det_std[0],r[o+c]=(t[d+1]/255-O.det_mean[1])/O.det_std[1],r[2*o+c]=(t[d+2]/255-O.det_mean[2])/O.det_std[2]}return new ue("float32",r,[1,3,e.height,e.width])}async postprocessDetection(e,n,t,o){const[r,c,d,i]=e.dims,l=e.data,m=new Float32Array(d*i);for(let v=0;v<d*i;v++)m[v]=1/(1+Math.exp(-l[v]));const a=new Uint8Array(d*i);for(let v=0;v<d*i;v++)a[v]=m[v]>O.det_db_thresh?255:0;const f=[],w=new Set;let x=0;for(let v=0;v<d&&x<O.det_db_max_candidates;v++)for(let _=0;_<i&&x<O.det_db_max_candidates;_++){const I=v*i+_;if(a[I]===255&&!w.has(I)){const L=this.findConnectedComponent(a,i,d,_,v,w,m);L&&L.score>=O.det_db_box_thresh&&(L.points=L.points.map(A=>[Math.round(A[0]/o),Math.round(A[1]/o)]),this.calculatePolygonArea(L.points)>O.min_area_thresh&&(f.push(L),x++))}}return f}findConnectedComponent(e,n,t,o,r,c,d){const i=[[o,r]],l=[];let m=0,a=0;const f=5e4,w=r*n+o;if(c.has(w)||e[w]!==255)return null;for(;i.length>0&&l.length<f;){const[T,N]=i.pop(),F=N*n+T;if(!c.has(F)&&(c.add(F),e[F]===255)){l.push([T,N]),m+=d[F],a++;for(let D=-1;D<=1;D++)for(let Y=-1;Y<=1;Y++){if(Y===0&&D===0)continue;const B=T+Y,q=N+D;if(B>=0&&B<n&&q>=0&&q<t){const K=q*n+B;!c.has(K)&&e[K]===255&&i.push([B,q])}}}}if(l.length<O.det_db_min_size)return null;const x=l.map(T=>T[0]),v=l.map(T=>T[1]);let _=Math.min(...x),I=Math.max(...x),L=Math.min(...v),$=Math.max(...v);const A=O.det_db_unclip_ratio,M=Math.max(I-_,$-L)*(A-1)/2;return _=Math.max(0,_-M),I=Math.min(n-1,I+M),L=Math.max(0,L-M),$=Math.min(t-1,$+M),{points:[[_,L],[I,L],[I,$],[_,$]],score:m/a}}calculatePolygonArea(e){let n=0;const t=e.length;for(let o=0;o<t;o++){const r=(o+1)%t;n+=e[o][0]*e[r][1],n-=e[r][0]*e[o][1]}return Math.abs(n)/2}sortBoxes(e){if(e.length===0)return e;e.sort((n,t)=>{const o=n.points[0][1],r=t.points[0][1];return o-r});for(let n=e.length-1;n>0;n--)for(let t=n-1;t>=0&&(Math.abs(e[t+1].points[0][1]-e[t].points[0][1])<10&&e[t+1].points[0][0]<e[t].points[0][0]);t--){const o=e[t];e[t]=e[t+1],e[t+1]=o}return e}async recognizeText(e,n){if(!this.recognitionSession)throw new Error("Recognition model not loaded");const t=[],o=O.rec_batch_num;for(let r=0;r<n.length;r+=o){const c=n.slice(r,Math.min(r+o,n.length)),d=await this.processBatch(e,c);t.push(...d)}return t}async processBatch(e,n){const t=[],o=[],r=[];for(const d of n){const i=await this.getRotateCropImage(e,d),l=i.width/i.height;o.push(i),r.push(l)}const c=Array.from({length:n.length},(d,i)=>i).sort((d,i)=>r[d]-r[i]);for(const d of c){const i=o[d],l=n[d],m=await this.preprocessForRecognition(i),a={[this.recognitionSession.inputNames[0]]:m},f=await this.recognitionSession.run(a),w=await this.decodeRecognition(f[this.recognitionSession.outputNames[0]]);w.score>=O.drop_score&&t.push({text:w.text,confidence:w.score,box:l.points})}return t}async getRotateCropImage(e,n){const t=n.points;Math.sqrt(Math.pow(t[0][0]-t[1][0],2)+Math.pow(t[0][1]-t[1][1],2)),Math.sqrt(Math.pow(t[2][0]-t[3][0],2)+Math.pow(t[2][1]-t[3][1],2)),Math.sqrt(Math.pow(t[0][0]-t[3][0],2)+Math.pow(t[0][1]-t[3][1],2)),Math.sqrt(Math.pow(t[1][0]-t[2][0],2)+Math.pow(t[1][1]-t[2][1],2));const o=Math.min(...t.map(a=>a[0])),r=Math.max(...t.map(a=>a[0])),c=Math.min(...t.map(a=>a[1])),d=Math.max(...t.map(a=>a[1])),i=r-o,l=d-c;if(this.canvas.width=i,this.canvas.height=l,this.ctx.drawImage(e,o,c,i,l,0,0,i,l),l*1/i>=1.5){const a=document.createElement("canvas"),f=a.getContext("2d",{willReadFrequently:!0});a.width=l,a.height=i,f.translate(l/2,i/2),f.rotate(Math.PI/2),f.drawImage(this.canvas,-i/2,-l/2),this.canvas.width=l,this.canvas.height=i,this.ctx.drawImage(a,0,0)}const m=new Image;return new Promise(a=>{this.canvas.toBlob(f=>{const w=URL.createObjectURL(f);m.onload=()=>{URL.revokeObjectURL(w),a(m)},m.src=w})})}async preprocessForRecognition(e){const t=O.rec_image_height,o=O.rec_image_width,r=e.height,d=e.width/r;let i;Math.ceil(t*d)>o?i=o:i=Math.ceil(t*d),this.canvas.width=i,this.canvas.height=t,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,i,t),this.ctx.drawImage(e,0,0,i,t);const m=this.ctx.getImageData(0,0,i,t).data,a=new Float32Array(3*t*o);for(let f=0;f<3;f++)for(let w=0;w<t;w++)for(let x=0;x<i;x++){const v=(w*i+x)*4+f,_=f*t*o+w*o+x;a[_]=(m[v]/255-O.rec_mean)/O.rec_std}return new ue("float32",a,[1,3,t,o])}async decodeRecognition(e){const[n,t,o]=e.dims,r=e.data,c=[],d=[];for(let a=0;a<t;a++){let f=0,w=r[a*o];for(let x=1;x<o;x++){const v=r[a*o+x];v>w&&(w=v,f=x)}c.push(f),d.push(w)}const i=[],l=[];let m=-1;for(let a=0;a<c.length;a++){const f=c[a];f!==0&&f!==m&&f<this.charDict.length&&(i.push(this.charDict[f]),l.push(d[a])),m=f}return{text:i.join(""),score:l.length>0?l.reduce((a,f)=>a+f)/l.length:0}}mergeTextLines(e){if(e.length===0)return e;let n=this.filterResults(e);if(n.length===0)return n;n=this.postProcessEnglishText(n);const t=n.map(i=>{const l=i.box.map(m=>m[1]);return Math.max(...l)-Math.min(...l)}),o=t.reduce((i,l)=>i+l)/t.length,r=[];let c=[n[0]];for(let i=1;i<n.length;i++){const l=n[i],m=n[i-1],a=Math.min(...m.box.map(v=>v[1])),f=Math.min(...l.box.map(v=>v[1])),w=Math.abs(f-a),x=o*O.vertical_gap_threshold;w<=x?c.push(l):(r.push(c),c=[l])}c.length>0&&r.push(c);const d=[];for(const i of r){i.sort((x,v)=>{const _=Math.min(...x.box.map(L=>L[0])),I=Math.min(...v.box.map(L=>L[0]));return _-I});const l=i.map(x=>x.text).join(" "),m=i.reduce((x,v)=>x+v.confidence,0)/i.length,a=i.flatMap(x=>x.box),f=a.map(x=>x[0]),w=a.map(x=>x[1]);d.push({text:l,confidence:m,box:[[Math.min(...f),Math.min(...w)],[Math.max(...f),Math.min(...w)],[Math.max(...f),Math.max(...w)],[Math.min(...f),Math.max(...w)]]})}return d}filterResults(e){const n=O.drop_score;return e.filter(t=>t.confidence<n?!1:/[a-zA-Z0-9]/.test(t.text)&&t.text.trim().length>0)}async processPDF(e){const n=await e.arrayBuffer(),t=await J.getDocument({data:n}).promise,o=t.numPages,r=[];for(let c=1;c<=o;c++){const d=await t.getPage(c),i=d.getViewport({scale:2}),l=document.createElement("canvas"),m=l.getContext("2d");l.width=i.width,l.height=i.height,await d.render({canvasContext:m,viewport:i}).promise;const a=await new Promise(w=>l.toBlob(w)),f=await this.process(a);r.push({page:c,results:f})}return r}async blobToImage(e){return new Promise((n,t)=>{const o=new Image,r=URL.createObjectURL(e);o.onload=()=>{URL.revokeObjectURL(r),n(o)},o.onerror=()=>{URL.revokeObjectURL(r),t(new Error("Failed to load image"))},o.src=r})}postProcessEnglishText(e){return e.map(n=>{let t=n.text;t=t.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([a-zA-Z])(\d)/g,"$1 $2").replace(/(\d)([a-zA-Z])/g,"$1 $2").replace(/\s+/g," ").replace(/([.,!?;:])([a-zA-Z])/g,"$1 $2").trim();const o={tne:"the",tnat:"that",wnen:"when",wnere:"where",witn:"with","l'":"I'"," l ":" I ","^l ":"I "};for(const[r,c]of Object.entries(o)){const d=new RegExp(r,"gi");t=t.replace(d,c)}return{...n,text:t}})}}const fe=new ke;J.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";me.wasm.wasmPaths="/client-ocr-app/assets/";me.wasm.numThreads=1;const ye="/client-ocr-app/models/",U={det_limit_side_len:960,det_db_thresh:.1,det_db_box_thresh:.3,det_db_unclip_ratio:2,drop_score:.1,mean:[.485,.456,.406],std:[.229,.224,.225]};class He{constructor(){this.detectionSession=null,this.recognitionSession=null,this.charDict=[],this.initialized=!1,this.canvas=null,this.ctx=null,this.modelConfig={detection:"PP-OCRv5_mobile_det_infer.onnx",recognition:"en_PP-OCRv4_mobile_rec_infer.onnx",dictionary:"en_dict.txt"}}setModelConfig(e){e.detection&&(this.modelConfig.detection=e.detection),e.recognition&&(this.modelConfig.recognition=e.recognition),e.dictionary&&(this.modelConfig.dictionary=e.dictionary),this.initialized=!1}async initialize(e){this.initialized=!1;try{this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),e==null||e({status:"loading",message:"Loading dictionary...",progress:10}),await this.loadDictionary();const n=this.modelConfig.detection.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${n}...`,progress:30}),this.detectionSession&&await this.detectionSession.release(),this.detectionSession=await he.create(ye+this.modelConfig.detection,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Detection model loaded:",this.detectionSession.inputNames,this.detectionSession.outputNames);const t=this.modelConfig.recognition.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${t}...`,progress:70}),this.recognitionSession&&await this.recognitionSession.release(),this.recognitionSession=await he.create(ye+this.modelConfig.recognition,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Recognition model loaded:",this.recognitionSession.inputNames,this.recognitionSession.outputNames),this.initialized=!0,e==null||e({status:"ready",message:"PP-OCR models loaded successfully!",progress:100})}catch(n){throw console.error("Failed to initialize PP-OCR models:",n),n}}async loadDictionary(){try{const n=await(await fetch(ye+this.modelConfig.dictionary)).text();this.charDict=n.split(`
`).filter(t=>t.trim()),this.charDict.unshift(" "),console.log(`Loaded dictionary ${this.modelConfig.dictionary} with ${this.charDict.length} characters`)}catch(e){console.error("Failed to load dictionary:",e),this.charDict=[" "];for(let n=32;n<127;n++)this.charDict.push(String.fromCharCode(n))}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(e.type==="application/pdf")return await this.processPDF(e);const n=await this.blobToImage(e),t=await this.detectText(n);return await this.recognizeText(n,t)}async detectText(e){if(!this.detectionSession)throw new Error("Detection model not loaded");const{resizedImage:n,ratio:t}=await this.resizeForDetection(e),o=await this.preprocessForDetection(n),r={[this.detectionSession.inputNames[0]]:o},d=(await this.detectionSession.run(r))[this.detectionSession.outputNames[0]];return await this.postprocessDetection(d,n.width,n.height,t)}async resizeForDetection(e){const n=U.det_limit_side_len;let t=e.width,o=e.height,r=1;Math.max(o,t)>n&&(r=n/Math.max(o,t));const c=Math.ceil(t*r),d=Math.ceil(o*r),i=Math.ceil(c/32)*32,l=Math.ceil(d/32)*32;this.canvas.width=i,this.canvas.height=l,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,i,l),this.ctx.drawImage(e,0,0,c,d);const m=new Image;return new Promise(a=>{this.canvas.toBlob(f=>{const w=URL.createObjectURL(f);m.onload=()=>{URL.revokeObjectURL(w),a({resizedImage:m,ratio:r})},m.src=w})})}async preprocessForDetection(e){this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const t=this.ctx.getImageData(0,0,e.width,e.height).data,o=e.width*e.height,r=new Float32Array(3*o);for(let c=0;c<o;c++){const d=c*4;r[c]=(t[d]/255-U.mean[0])/U.std[0],r[o+c]=(t[d+1]/255-U.mean[1])/U.std[1],r[2*o+c]=(t[d+2]/255-U.mean[2])/U.std[2]}return new ue("float32",r,[1,3,e.height,e.width])}async postprocessDetection(e,n,t,o){const[r,c,d,i]=e.dims,l=e.data,m=new Float32Array(d*i);for(let v=0;v<d*i;v++)m[v]=1/(1+Math.exp(-l[v]));const a=new Uint8Array(d*i),f=U.det_db_thresh;for(let v=0;v<d*i;v++)a[v]=m[v]>f?1:0;const w=[],x=new Set;for(let v=0;v<d;v++)for(let _=0;_<i;_++){const I=v*i+_;if(a[I]===1&&!x.has(I)&&m[I]>U.det_db_box_thresh){const L=this.expandBox(a,m,_,v,i,d,x);if(L){const $={points:L.points.map(A=>[Math.round(A[0]*n/i/o),Math.round(A[1]*t/d/o)]),score:L.score};w.push($)}}}return this.sortBoxes(w)}expandBox(e,n,t,o,r,c,d){let i=t,l=t,m=o,a=o,f=0,w=0;const x=[[t,o]];for(d.add(o*r+t);x.length>0;){const[I,L]=x.shift();f+=n[L*r+I],w++;for(let $=-1;$<=1;$++)for(let A=-1;A<=1;A++){const M=I+A,T=L+$,N=T*r+M;M>=0&&M<r&&T>=0&&T<c&&e[N]===1&&!d.has(N)&&(d.add(N),x.push([M,T]),i=Math.min(i,M),l=Math.max(l,M),m=Math.min(m,T),a=Math.max(a,T))}}if(l-i<3||a-m<3)return null;const v=U.det_db_unclip_ratio,_=Math.max(l-i,a-m)*(v-1)/2;return i=Math.max(0,i-_),l=Math.min(r-1,l+_),m=Math.max(0,m-_),a=Math.min(c-1,a+_),{points:[[i,m],[l,m],[l,a],[i,a]],score:f/w}}sortBoxes(e){return e.sort((n,t)=>{const o=Math.min(...n.points.map(c=>c[1])),r=Math.min(...t.points.map(c=>c[1]));if(Math.abs(o-r)<10){const c=Math.min(...n.points.map(i=>i[0])),d=Math.min(...t.points.map(i=>i[0]));return c-d}return o-r})}async recognizeText(e,n){if(!this.recognitionSession)throw new Error("Recognition model not loaded");const t=[];for(const o of n){const r=await this.cropToBox(e,o),c=await this.preprocessForRecognition(r),d={[this.recognitionSession.inputNames[0]]:c},i=await this.recognitionSession.run(d),l=await this.decodeRecognition(i[this.recognitionSession.outputNames[0]]);l.score>=U.drop_score&&t.push({text:l.text,confidence:l.score,box:o.points})}return t}async cropToBox(e,n){const t=n.points,o=Math.min(...t.map(a=>a[0])),r=Math.max(...t.map(a=>a[0])),c=Math.min(...t.map(a=>a[1])),d=Math.max(...t.map(a=>a[1])),i=r-o,l=d-c;this.canvas.width=i,this.canvas.height=l,this.ctx.drawImage(e,o,c,i,l,0,0,i,l);const m=new Image;return new Promise(a=>{this.canvas.toBlob(f=>{const w=URL.createObjectURL(f);m.onload=()=>{URL.revokeObjectURL(w),a(m)},m.src=w})})}async preprocessForRecognition(e){const t=e.width/e.height;let o=Math.round(48*t);o=Math.max(o,48),this.canvas.width=o,this.canvas.height=48,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,o,48),this.ctx.drawImage(e,0,0,o,48);const c=this.ctx.getImageData(0,0,o,48).data,d=o*48,i=new Float32Array(3*d);for(let l=0;l<d;l++){const m=l*4;i[l]=(c[m]/255-.5)/.5,i[d+l]=(c[m+1]/255-.5)/.5,i[2*d+l]=(c[m+2]/255-.5)/.5}return new ue("float32",i,[1,3,48,o])}async decodeRecognition(e){const[n,t,o]=e.dims,r=e.data,c=[],d=[];for(let a=0;a<t;a++){let f=0,w=r[a*o];for(let x=1;x<o;x++){const v=r[a*o+x];v>w&&(w=v,f=x)}c.push(f),d.push(w)}const i=[],l=[];let m=-1;for(let a=0;a<c.length;a++){const f=c[a];f!==0&&f!==m&&f<this.charDict.length&&(i.push(this.charDict[f]),l.push(d[a])),m=f}return{text:i.join(""),score:l.length>0?l.reduce((a,f)=>a+f)/l.length:0}}async processPDF(e){const n=await e.arrayBuffer(),t=await J.getDocument({data:n}).promise,o=t.numPages,r=[];for(let c=1;c<=o;c++){const d=await t.getPage(c),i=d.getViewport({scale:2}),l=document.createElement("canvas"),m=l.getContext("2d");l.width=i.width,l.height=i.height,await d.render({canvasContext:m,viewport:i}).promise;const a=await new Promise(v=>l.toBlob(v,"image/png")),f=await this.blobToImage(a),w=await this.detectText(f),x=await this.recognizeText(f,w);r.push({page:c,results:x})}return r}async blobToImage(e){return new Promise((n,t)=>{const o=new Image;o.onload=()=>n(o),o.onerror=t,o.src=URL.createObjectURL(e)})}}const se=new He;var Ye={exports:{}};(function(s){var e=function(n){var t=Object.prototype,o=t.hasOwnProperty,r=Object.defineProperty||function(p,h,g){p[h]=g.value},c,d=typeof Symbol=="function"?Symbol:{},i=d.iterator||"@@iterator",l=d.asyncIterator||"@@asyncIterator",m=d.toStringTag||"@@toStringTag";function a(p,h,g){return Object.defineProperty(p,h,{value:g,enumerable:!0,configurable:!0,writable:!0}),p[h]}try{a({},"")}catch{a=function(h,g,E){return h[g]=E}}function f(p,h,g,E){var u=h&&h.prototype instanceof $?h:$,y=Object.create(u.prototype),S=new oe(E||[]);return r(y,"_invoke",{value:q(p,g,S)}),y}n.wrap=f;function w(p,h,g){try{return{type:"normal",arg:p.call(h,g)}}catch(E){return{type:"throw",arg:E}}}var x="suspendedStart",v="suspendedYield",_="executing",I="completed",L={};function $(){}function A(){}function M(){}var T={};a(T,i,function(){return this});var N=Object.getPrototypeOf,F=N&&N(N(ie([])));F&&F!==t&&o.call(F,i)&&(T=F);var D=M.prototype=$.prototype=Object.create(T);A.prototype=M,r(D,"constructor",{value:M,configurable:!0}),r(M,"constructor",{value:A,configurable:!0}),A.displayName=a(M,m,"GeneratorFunction");function Y(p){["next","throw","return"].forEach(function(h){a(p,h,function(g){return this._invoke(h,g)})})}n.isGeneratorFunction=function(p){var h=typeof p=="function"&&p.constructor;return h?h===A||(h.displayName||h.name)==="GeneratorFunction":!1},n.mark=function(p){return Object.setPrototypeOf?Object.setPrototypeOf(p,M):(p.__proto__=M,a(p,m,"GeneratorFunction")),p.prototype=Object.create(D),p},n.awrap=function(p){return{__await:p}};function B(p,h){function g(y,S,R,b){var P=w(p[y],p,S);if(P.type==="throw")b(P.arg);else{var X=P.arg,G=X.value;return G&&typeof G=="object"&&o.call(G,"__await")?h.resolve(G.__await).then(function(W){g("next",W,R,b)},function(W){g("throw",W,R,b)}):h.resolve(G).then(function(W){X.value=W,R(X)},function(W){return g("throw",W,R,b)})}}var E;function u(y,S){function R(){return new h(function(b,P){g(y,S,b,P)})}return E=E?E.then(R,R):R()}r(this,"_invoke",{value:u})}Y(B.prototype),a(B.prototype,l,function(){return this}),n.AsyncIterator=B,n.async=function(p,h,g,E,u){u===void 0&&(u=Promise);var y=new B(f(p,h,g,E),u);return n.isGeneratorFunction(h)?y:y.next().then(function(S){return S.done?S.value:y.next()})};function q(p,h,g){var E=x;return function(y,S){if(E===_)throw new Error("Generator is already running");if(E===I){if(y==="throw")throw S;return ce()}for(g.method=y,g.arg=S;;){var R=g.delegate;if(R){var b=K(R,g);if(b){if(b===L)continue;return b}}if(g.method==="next")g.sent=g._sent=g.arg;else if(g.method==="throw"){if(E===x)throw E=I,g.arg;g.dispatchException(g.arg)}else g.method==="return"&&g.abrupt("return",g.arg);E=_;var P=w(p,h,g);if(P.type==="normal"){if(E=g.done?I:v,P.arg===L)continue;return{value:P.arg,done:g.done}}else P.type==="throw"&&(E=I,g.method="throw",g.arg=P.arg)}}}function K(p,h){var g=h.method,E=p.iterator[g];if(E===c)return h.delegate=null,g==="throw"&&p.iterator.return&&(h.method="return",h.arg=c,K(p,h),h.method==="throw")||g!=="return"&&(h.method="throw",h.arg=new TypeError("The iterator does not provide a '"+g+"' method")),L;var u=w(E,p.iterator,h.arg);if(u.type==="throw")return h.method="throw",h.arg=u.arg,h.delegate=null,L;var y=u.arg;if(!y)return h.method="throw",h.arg=new TypeError("iterator result is not an object"),h.delegate=null,L;if(y.done)h[p.resultName]=y.value,h.next=p.nextLoc,h.method!=="return"&&(h.method="next",h.arg=c);else return y;return h.delegate=null,L}Y(D),a(D,m,"Generator"),a(D,i,function(){return this}),a(D,"toString",function(){return"[object Generator]"});function ge(p){var h={tryLoc:p[0]};1 in p&&(h.catchLoc=p[1]),2 in p&&(h.finallyLoc=p[2],h.afterLoc=p[3]),this.tryEntries.push(h)}function Z(p){var h=p.completion||{};h.type="normal",delete h.arg,p.completion=h}function oe(p){this.tryEntries=[{tryLoc:"root"}],p.forEach(ge,this),this.reset(!0)}n.keys=function(p){var h=Object(p),g=[];for(var E in h)g.push(E);return g.reverse(),function u(){for(;g.length;){var y=g.pop();if(y in h)return u.value=y,u.done=!1,u}return u.done=!0,u}};function ie(p){if(p){var h=p[i];if(h)return h.call(p);if(typeof p.next=="function")return p;if(!isNaN(p.length)){var g=-1,E=function u(){for(;++g<p.length;)if(o.call(p,g))return u.value=p[g],u.done=!1,u;return u.value=c,u.done=!0,u};return E.next=E}}return{next:ce}}n.values=ie;function ce(){return{value:c,done:!0}}return oe.prototype={constructor:oe,reset:function(p){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(Z),!p)for(var h in this)h.charAt(0)==="t"&&o.call(this,h)&&!isNaN(+h.slice(1))&&(this[h]=c)},stop:function(){this.done=!0;var p=this.tryEntries[0],h=p.completion;if(h.type==="throw")throw h.arg;return this.rval},dispatchException:function(p){if(this.done)throw p;var h=this;function g(b,P){return y.type="throw",y.arg=p,h.next=b,P&&(h.method="next",h.arg=c),!!P}for(var E=this.tryEntries.length-1;E>=0;--E){var u=this.tryEntries[E],y=u.completion;if(u.tryLoc==="root")return g("end");if(u.tryLoc<=this.prev){var S=o.call(u,"catchLoc"),R=o.call(u,"finallyLoc");if(S&&R){if(this.prev<u.catchLoc)return g(u.catchLoc,!0);if(this.prev<u.finallyLoc)return g(u.finallyLoc)}else if(S){if(this.prev<u.catchLoc)return g(u.catchLoc,!0)}else if(R){if(this.prev<u.finallyLoc)return g(u.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(p,h){for(var g=this.tryEntries.length-1;g>=0;--g){var E=this.tryEntries[g];if(E.tryLoc<=this.prev&&o.call(E,"finallyLoc")&&this.prev<E.finallyLoc){var u=E;break}}u&&(p==="break"||p==="continue")&&u.tryLoc<=h&&h<=u.finallyLoc&&(u=null);var y=u?u.completion:{};return y.type=p,y.arg=h,u?(this.method="next",this.next=u.finallyLoc,L):this.complete(y)},complete:function(p,h){if(p.type==="throw")throw p.arg;return p.type==="break"||p.type==="continue"?this.next=p.arg:p.type==="return"?(this.rval=this.arg=p.arg,this.method="return",this.next="end"):p.type==="normal"&&h&&(this.next=h),L},finish:function(p){for(var h=this.tryEntries.length-1;h>=0;--h){var g=this.tryEntries[h];if(g.finallyLoc===p)return this.complete(g.completion,g.afterLoc),Z(g),L}},catch:function(p){for(var h=this.tryEntries.length-1;h>=0;--h){var g=this.tryEntries[h];if(g.tryLoc===p){var E=g.completion;if(E.type==="throw"){var u=E.arg;Z(g)}return u}}throw new Error("illegal catch attempt")},delegateYield:function(p,h,g){return this.delegate={iterator:ie(p),resultName:h,nextLoc:g},this.method==="next"&&(this.arg=c),L}},n}(s.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(Ye);var Me=(s,e)=>`${s}-${e}-${Math.random().toString(16).slice(3,8)}`;const Ge=Me;let Ie=0;var ze=({id:s,action:e,payload:n={}})=>{let t=s;return typeof t>"u"&&(t=Ge("Job",Ie),Ie+=1),{id:t,action:e,payload:n}},ne={};let Re=!1;ne.logging=Re;ne.setLogging=s=>{Re=s};ne.log=(...s)=>Re?console.log.apply(void 0,s):null;const We=ze,{log:de}=ne,qe=Me;let Pe=0;var Ke=()=>{const s=qe("Scheduler",Pe),e={},n={};let t=[];Pe+=1;const o=()=>t.length,r=()=>Object.keys(e).length,c=()=>{if(t.length!==0){const a=Object.keys(e);for(let f=0;f<a.length;f+=1)if(typeof n[a[f]]>"u"){t[0](e[a[f]]);break}}},d=(a,f)=>new Promise((w,x)=>{const v=We({action:a,payload:f});t.push(async _=>{t.shift(),n[_.id]=v;try{w(await _[a].apply(void 0,[...f,v.id]))}catch(I){x(I)}finally{delete n[_.id],c()}}),de(`[${s}]: Add ${v.id} to JobQueue`),de(`[${s}]: JobQueue length=${t.length}`),c()});return{addWorker:a=>(e[a.id]=a,de(`[${s}]: Add ${a.id}`),de(`[${s}]: Number of workers=${r()}`),c(),a.id),addJob:async(a,...f)=>{if(r()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return d(a,f)},terminate:async()=>{Object.keys(e).forEach(async a=>{await e[a].terminate()}),t=[]},getQueueLen:o,getNumWorkers:r}};function Xe(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var Ve=Xe;const Je=Ve;var Ze=s=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":Je()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof Ue=="function"&&(e.type="node"),typeof s>"u"?e:e[s]};const Qe=Ze("type")==="browser",et=Qe?s=>new URL(s,window.location.href).href:s=>s;var tt=s=>{const e={...s};return["corePath","workerPath","langPath"].forEach(n=>{s[n]&&(e[n]=et(e[n]))}),e},nt=s=>{const e=[],n=[],t=[],o=[],r=[];return s.blocks&&s.blocks.forEach(c=>{c.paragraphs.forEach(d=>{d.lines.forEach(i=>{i.words.forEach(l=>{l.symbols.forEach(m=>{r.push({...m,page:s,block:c,paragraph:d,line:i,word:l})}),o.push({...l,page:s,block:c,paragraph:d,line:i})}),t.push({...i,page:s,block:c,paragraph:d})}),n.push({...d,page:s,block:c})}),e.push({...c,page:s})}),{...s,blocks:e,paragraphs:n,lines:t,words:o,symbols:r}},Ne={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const ot="5.1.1",it={version:ot};var st={workerBlobURL:!0,logger:()=>{}};const rt=it.version,at=st;var ct={...at,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${rt}/dist/worker.min.js`},dt=({workerPath:s,workerBlobURL:e})=>{let n;if(Blob&&URL&&e){const t=new Blob([`importScripts("${s}");`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(t))}else n=new Worker(s);return n},lt=s=>{s.terminate()},ht=(s,e)=>{s.onmessage=({data:n})=>{e(n)}},ut=async(s,e)=>{s.postMessage(e)};const ve=s=>new Promise((e,n)=>{const t=new FileReader;t.onload=()=>{e(t.result)},t.onerror=({target:{error:{code:o}}})=>{n(Error(`File could not be read! Code=${o}`))},t.readAsArrayBuffer(s)}),_e=async s=>{let e=s;if(typeof s>"u")return"undefined";if(typeof s=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(s)?e=atob(s.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(s)).arrayBuffer();else if(typeof HTMLElement<"u"&&s instanceof HTMLElement)s.tagName==="IMG"&&(e=await _e(s.src)),s.tagName==="VIDEO"&&(e=await _e(s.poster)),s.tagName==="CANVAS"&&await new Promise(n=>{s.toBlob(async t=>{e=await ve(t),n()})});else if(typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas){const n=await s.convertToBlob();e=await ve(n)}else(s instanceof File||s instanceof Blob)&&(e=await ve(s));return new Uint8Array(e)};var pt=_e;const mt=ct,ft=dt,gt=lt,wt=ht,yt=ut,vt=pt;var xt={defaultOptions:mt,spawnWorker:ft,terminateWorker:gt,onMessage:wt,send:yt,loadImage:vt};const Lt=tt,Et=nt,j=ze,{log:Oe}=ne,_t=Me,Q=Ne,{defaultOptions:St,spawnWorker:Mt,terminateWorker:Rt,onMessage:bt,loadImage:Te,send:It}=xt;let $e=0;var De=async(s="eng",e=Q.LSTM_ONLY,n={},t={})=>{const o=_t("Worker",$e),{logger:r,errorHandler:c,...d}=Lt({...St,...n}),i={},l={},m=typeof s=="string"?s.split("+"):s;let a=e,f=t;const w=[Q.DEFAULT,Q.LSTM_ONLY].includes(e)&&!d.legacyCore;let x,v;const _=new Promise((u,y)=>{v=u,x=y}),I=u=>{x(u.message)};let L=Mt(d);L.onerror=I,$e+=1;const $=(u,y)=>{i[u]=y},A=(u,y)=>{l[u]=y},M=({id:u,action:y,payload:S})=>new Promise((R,b)=>{Oe(`[${o}]: Start ${u}, action=${y}`);const P=`${y}-${u}`;$(P,R),A(P,b),It(L,{workerId:o,jobId:u,action:y,payload:S})}),T=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),N=u=>M(j({id:u,action:"load",payload:{options:{lstmOnly:w,corePath:d.corePath,logging:d.logging}}})),F=(u,y,S)=>M(j({id:S,action:"FS",payload:{method:"writeFile",args:[u,y]}})),D=(u,y)=>M(j({id:y,action:"FS",payload:{method:"readFile",args:[u,{encoding:"utf8"}]}})),Y=(u,y)=>M(j({id:y,action:"FS",payload:{method:"unlink",args:[u]}})),B=(u,y,S)=>M(j({id:S,action:"FS",payload:{method:u,args:y}})),q=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),K=(u,y)=>M(j({id:y,action:"loadLanguage",payload:{langs:u,options:{langPath:d.langPath,dataPath:d.dataPath,cachePath:d.cachePath,cacheMethod:d.cacheMethod,gzip:d.gzip,lstmOnly:[Q.DEFAULT,Q.LSTM_ONLY].includes(a)&&!d.legacyLang}}})),ge=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),Z=(u,y,S,R)=>M(j({id:R,action:"initialize",payload:{langs:u,oem:y,config:S}})),oe=(u="eng",y,S,R)=>{if(w&&[Q.TESSERACT_ONLY,Q.TESSERACT_LSTM_COMBINED].includes(y))throw Error("Legacy model requested but code missing.");const b=y||a;a=b;const P=S||f;f=P;const G=(typeof u=="string"?u.split("+"):u).filter(W=>!m.includes(W));return m.push(...G),G.length>0?K(G,R).then(()=>Z(u,b,P,R)):Z(u,b,P,R)},ie=(u={},y)=>M(j({id:y,action:"setParameters",payload:{params:u}})),ce=async(u,y={},S={blocks:!0,text:!0,hocr:!0,tsv:!0},R)=>M(j({id:R,action:"recognize",payload:{image:await Te(u),options:y,output:S}})),p=(u="Tesseract OCR Result",y=!1,S)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),M(j({id:S,action:"getPDF",payload:{title:u,textonly:y}}))),h=async(u,y)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return M(j({id:y,action:"detect",payload:{image:await Te(u)}}))},g=async()=>(L!==null&&(Rt(L),L=null),Promise.resolve());bt(L,({workerId:u,jobId:y,status:S,action:R,data:b})=>{const P=`${R}-${y}`;if(S==="resolve"){Oe(`[${u}]: Complete ${y}`);let X=b;R==="recognize"?X=Et(b):R==="getPDF"&&(X=Array.from({...b,length:Object.keys(b).length})),i[P]({jobId:y,data:X})}else if(S==="reject")if(l[P](b),R==="load"&&x(b),c)c(b);else throw Error(b);else S==="progress"&&r({...b,userJobId:y})});const E={id:o,worker:L,setResolve:$,setReject:A,load:T,writeText:F,readText:D,removeFile:Y,FS:B,loadLanguage:q,initialize:ge,reinitialize:oe,setParameters:ie,recognize:ce,getPDF:p,detect:h,terminate:g};return N().then(()=>K(s)).then(()=>Z(s,e,t)).then(()=>v(E)).catch(()=>{}),_};const Ce=De,Pt=async(s,e,n)=>{const t=await Ce(e,1,n);return t.recognize(s).finally(async()=>{await t.terminate()})},Ot=async(s,e)=>{const n=await Ce("osd",0,e);return n.detect(s).finally(async()=>{await n.terminate()})};var Tt={recognize:Pt,detect:Ot},$t={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},At={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const zt=Ke,Nt=De,Dt=Tt,Ct=$t,Ft=Ne,Bt=At,{setLogging:Ut}=ne;var jt={languages:Ct,OEM:Ft,PSM:Bt,createScheduler:zt,createWorker:Nt,setLogging:Ut,...Dt};const xe=je(jt);J.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";class kt{constructor(){this.initialized=!1,this.worker=null}async initialize(e){if(!this.initialized)try{e==null||e({status:"loading",message:"Loading Tesseract OCR engine...",progress:10}),this.worker=await xe.createWorker("eng",1,{logger:n=>{n.status==="loading tesseract core"?e==null||e({status:"loading",message:"Loading OCR core...",progress:30}):n.status==="loading language traineddata"?e==null||e({status:"loading",message:"Loading English language model...",progress:60}):n.status==="initialized tesseract"&&(e==null||e({status:"loading",message:"Initializing OCR engine...",progress:90}))},errorHandler:n=>{console.error("Tesseract error:",n)}}),await this.worker.setParameters({tessedit_ocr_engine_mode:xe.OEM.LSTM_ONLY,preserve_interword_spaces:"1",tessedit_pageseg_mode:xe.PSM.AUTO}),this.initialized=!0,e==null||e({status:"ready",message:"Tesseract OCR engine loaded successfully!",progress:100})}catch(n){throw console.error("Failed to initialize Tesseract:",n),n}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(e.type==="application/pdf")return await this.processPDF(e);const n=await this.worker.recognize(e);return this.formatResults(n)}formatResults(e){const n=[];for(const o of e.data.words)o.confidence>30&&n.push({box:[[o.bbox.x0,o.bbox.y0],[o.bbox.x1,o.bbox.y0],[o.bbox.x1,o.bbox.y1],[o.bbox.x0,o.bbox.y1]],text:o.text,confidence:o.confidence/100});return this.groupWordsIntoLines(n)}groupWordsIntoLines(e){if(e.length===0)return[];e.sort((o,r)=>o.box[0][1]-r.box[0][1]);const n=[];let t={words:[e[0]],minY:e[0].box[0][1],maxY:e[0].box[2][1]};for(let o=1;o<e.length;o++){const r=e[o],c=r.box[0][1];c<=t.maxY&&c>=t.minY-5?(t.words.push(r),t.minY=Math.min(t.minY,c),t.maxY=Math.max(t.maxY,r.box[2][1])):(n.push(this.mergeLine(t)),t={words:[r],minY:c,maxY:r.box[2][1]})}return t.words.length>0&&n.push(this.mergeLine(t)),n}mergeLine(e){e.words.sort((i,l)=>i.box[0][0]-l.box[0][0]);const n=Math.min(...e.words.map(i=>i.box[0][0])),t=Math.max(...e.words.map(i=>i.box[1][0])),o=Math.min(...e.words.map(i=>i.box[0][1])),r=Math.max(...e.words.map(i=>i.box[2][1])),c=e.words.map(i=>i.text).join(" "),d=e.words.reduce((i,l)=>i+l.confidence,0)/e.words.length;return{box:[[n,o],[t,o],[t,r],[n,r]],text:c,confidence:d}}async processPDF(e){const n=await e.arrayBuffer(),t=await J.getDocument({data:n}).promise,o=t.numPages,r=[];for(let c=1;c<=o;c++){const d=await t.getPage(c),i=d.getViewport({scale:2}),l=document.createElement("canvas"),m=l.getContext("2d");l.width=i.width,l.height=i.height,await d.render({canvasContext:m,viewport:i}).promise;const a=await new Promise(x=>l.toBlob(x,"image/png")),f=await this.worker.recognize(a),w=this.formatResults(f);r.push({page:c,results:w})}return r}async cleanup(){this.worker&&(await this.worker.terminate(),this.worker=null,this.initialized=!1)}}const be=new kt;J.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";let te=null,C="tesseract",H="improved",re=be;const Se=document.getElementById("fileInput"),ee=document.getElementById("uploadArea"),Fe=document.getElementById("previewSection"),k=document.getElementById("previewImage"),Ht=document.getElementById("processBtn"),pe=document.getElementById("resultsSection"),Le=document.getElementById("loadingIndicator"),ae=document.getElementById("ocrResults"),Yt=document.getElementById("copyBtn"),Gt=document.getElementById("downloadBtn"),Wt=document.getElementById("resetBtn");async function qt(){console.log("Initializing OCR engines..."),z("Loading OCR engines...","info");try{await Promise.all([fe.initialize(s=>{C==="paddle"&&H==="improved"&&z(s.message,s.status==="ready"?"success":"info");const e=document.querySelector("#loadingIndicator p");e&&s.progress!==void 0&&C==="paddle"&&H==="improved"&&(e.textContent=`${s.message} (${s.progress}%)`)}),se.initialize(s=>{C==="paddle"&&H==="standard"&&z(s.message,s.status==="ready"?"success":"info")}),be.initialize(s=>{C==="tesseract"&&z(s.message,s.status==="ready"?"success":"info")})]),console.log("OCR engines loaded successfully!"),z("Ready to process images","success"),Kt()}catch(s){console.error("Failed to initialize OCR engines:",s),V("Failed to load OCR engines. Please check your internet connection and refresh the page.")}}function Kt(){ee.addEventListener("click",()=>Se.click()),Se.addEventListener("change",Jt),ee.addEventListener("dragover",Zt),ee.addEventListener("dragleave",Qt),ee.addEventListener("drop",en),Ht.addEventListener("click",tn),Yt.addEventListener("click",nn),Gt.addEventListener("click",on),Wt.addEventListener("click",sn),document.querySelectorAll('input[name="ocrEngine"]').forEach(s=>{s.addEventListener("change",Xt)}),document.querySelectorAll('input[name="preprocessing"]').forEach(s=>{s.addEventListener("change",Vt)}),document.getElementById("detectionModel").addEventListener("change",Ee),document.getElementById("recognitionModel").addEventListener("change",Ee),document.getElementById("dictionary").addEventListener("change",Ee)}async function Xt(s){C=s.target.value,C==="paddle"?re=H==="improved"?fe:se:re=be;const e=document.getElementById("paddleOptions");e.style.display=C==="paddle"?"block":"none",z(`Switched to ${C==="paddle"?"PaddleOCR":"Tesseract.js"}`,"info")}async function Vt(s){if(H=s.target.value,C==="paddle"){if(re=H==="improved"?fe:se,H==="standard"){const e=document.getElementById("detectionModel").value,n=document.getElementById("recognitionModel").value,t=document.getElementById("dictionary").value;se.setModelConfig({detection:e,recognition:n,dictionary:t})}z(`Switched to ${H==="improved"?"Improved (PPU)":"Standard"} preprocessing`,"info")}}async function Ee(){if(C!=="paddle")return;const s=document.getElementById("detectionModel").value,e=document.getElementById("recognitionModel").value,n=document.getElementById("dictionary").value;H==="improved"?fe.setModelConfig({detection:s,recognition:e,dictionary:n}):se.setModelConfig({detection:s,recognition:e,dictionary:n}),z("Loading new models...","info");try{await re.initialize(t=>{z(t.message,t.status==="ready"?"success":"info")}),z("Models updated successfully!","success")}catch(t){console.error("Failed to load new models:",t),V("Failed to load new models. Please try again.")}}function Jt(s){const e=s.target.files[0];e&&(e.type.startsWith("image/")||e.type==="application/pdf")?Be(e):V("Please select a valid image or PDF file")}function Zt(s){s.preventDefault(),ee.classList.add("dragover")}function Qt(s){s.preventDefault(),ee.classList.remove("dragover")}function en(s){s.preventDefault(),ee.classList.remove("dragover");const e=s.dataTransfer.files[0];e&&(e.type.startsWith("image/")||e.type==="application/pdf")?Be(e):V("Please drop a valid image or PDF file")}async function Be(s){if(te){const e=k.src;e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),te=null}if(ae.innerHTML="",pe.style.display="none",te=s,Fe.style.display="block",pe.style.display="none",s.type==="application/pdf"){k.style.display="none";const e=k.parentElement;e.innerHTML="";const n=document.createElement("div");n.className="pdf-preview",n.innerHTML=`
            <div class="pdf-header">
                <h3>${s.name}</h3>
                <p class="pdf-info">Loading PDF preview...</p>
            </div>
            <div class="pdf-pages" id="pdfPages"></div>
        `,e.appendChild(n);try{const t=await s.arrayBuffer(),o=await J.getDocument({data:t}).promise,r=o.numPages,c=n.querySelector(".pdf-info");c.textContent=`${r} page${r>1?"s":""}`;const d=document.getElementById("pdfPages"),i=Math.min(r,3);for(let l=1;l<=i;l++){const m=await o.getPage(l),a=m.getViewport({scale:.5}),f=document.createElement("div");f.className="pdf-page-preview";const w=document.createElement("canvas"),x=w.getContext("2d");w.height=a.height,w.width=a.width;const v={canvasContext:x,viewport:a};await m.render(v).promise,f.innerHTML=`<p>Page ${l}</p>`,f.appendChild(w),d.appendChild(f)}r>3&&(d.innerHTML+=`<p class="more-pages">... and ${r-3} more pages</p>`)}catch(t){console.error("Error rendering PDF preview:",t),n.querySelector(".pdf-info").textContent="Error loading PDF preview"}}else{const e=document.querySelector(".pdf-placeholder");e&&e.remove(),k.style.display="block";const n=URL.createObjectURL(s);k.src=n,k.onload=()=>{z('Image loaded. Click "Extract Text" to process.',"success")},k.onerror=()=>{URL.revokeObjectURL(n),V("Failed to load image")}}}async function tn(){if(!te){V("Please upload an image first");return}pe.style.display="block",Le.style.display="flex",ae.innerHTML="";const s=document.querySelector("#loadingIndicator p");let e=C==="paddle"?"PaddleOCR":"Tesseract.js";C==="paddle"&&(e+=` (${H==="improved"?"Improved PPU":"Standard"})`),s&&(s.textContent=`Processing image with ${e}...`);try{console.log(`Processing image with ${e}...`),z("Detecting and recognizing text...","info");const n=performance.now(),t=await re.process(te),o=performance.now()-n;console.log(`Processing completed in ${o.toFixed(2)}ms`),console.log("OCR Results:",t),Le.style.display="none",t&&t.length>0?(Ae(t,o,e),z(`Text extraction complete! Found ${t.length} text regions.`,"success")):(Ae([],o,e),z("No text found in the image","warning"))}catch(n){console.error("OCR processing error:",n),Le.style.display="none",V("Failed to process image: "+n.message)}}function Ae(s,e,n="PaddleOCR"){var o;if(Array.isArray(s)&&((o=s[0])==null?void 0:o.page)!==void 0){let r="",c=0,d="";s.forEach(i=>{const l=i.results.map(m=>m.text).join(`
`);r+=`
--- Page ${i.page} ---
${l}
`,c+=i.results.length,d+=`
                <div class="page-results">
                    <h4>Page ${i.page}</h4>
                    <ul class="detection-list">
                        ${i.results.map((m,a)=>`
                            <li>
                                <span class="detection-index">${a+1}.</span>
                                <span class="detection-text">${le(m.text)}</span>
                                <span class="detection-confidence">${(m.confidence*100).toFixed(1)}%</span>
                            </li>
                        `).join("")}
                    </ul>
                </div>
            `}),ae.innerHTML=`
            <div class="ocr-stats">
                <p><strong>Processing Time:</strong> ${(e/1e3).toFixed(2)}s</p>
                <p><strong>Pages Processed:</strong> ${s.length}</p>
                <p><strong>Total Text Regions:</strong> ${c}</p>
                <p><strong>Engine:</strong> ${n}</p>
            </div>
            <div class="text-result">
                <h3>Extracted Text:</h3>
                <div class="text-content" id="extractedText">${le(r||"No text detected")}</div>
            </div>
            <div class="detection-results">
                <h3>Detection Details by Page:</h3>
                ${d}
            </div>
        `}else{const r=s.map(c=>c.text).join(`
`);ae.innerHTML=`
            <div class="ocr-stats">
                <p><strong>Processing Time:</strong> ${(e/1e3).toFixed(2)}s</p>
                <p><strong>Text Regions Found:</strong> ${s.length}</p>
                <p><strong>Engine:</strong> ${n}</p>
            </div>
            <div class="text-result">
                <h3>Extracted Text:</h3>
                <div class="text-content" id="extractedText">${le(r||"No text detected")}</div>
            </div>
            <div class="detection-results">
                <h3>Detection Details:</h3>
                <ul class="detection-list">
                    ${s.map((c,d)=>`
                        <li>
                            <span class="detection-index">${d+1}.</span>
                            <span class="detection-text">${le(c.text)}</span>
                            <span class="detection-confidence">${(c.confidence*100).toFixed(1)}%</span>
                        </li>
                    `).join("")}
                </ul>
            </div>
        `}}async function nn(){const s=document.getElementById("extractedText");if(s)try{await navigator.clipboard.writeText(s.textContent),rn("Text copied to clipboard!")}catch{V("Failed to copy text")}}function on(){const s=document.getElementById("extractedText");if(s){const e=s.textContent,n=new Blob([e],{type:"text/plain"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download=`pp-ocrv5-result-${Date.now()}.txt`,o.click(),URL.revokeObjectURL(t)}}function sn(){if(te){const e=k.src;e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),te=null}Se.value="",Fe.style.display="none",pe.style.display="none",ae.innerHTML="",k.src="";const s=k.parentElement;s.innerHTML='<img id="previewImage" alt="Preview">',window.previewImage=document.getElementById("previewImage"),z("Ready to process a new image","info")}function le(s){const e=document.createElement("div");return e.textContent=s,e.innerHTML}function V(s){z(s,"error");const e=document.createElement("div");e.className="toast error",e.textContent=s,document.body.appendChild(e),setTimeout(()=>{e.remove()},5e3)}function rn(s){const e=document.createElement("div");e.className="toast success",e.textContent=s,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function z(s,e="info"){console.log(`[${e.toUpperCase()}] ${s}`);const n=document.getElementById("status");n&&(n.textContent=s,n.className=`status ${e}`)}document.addEventListener("DOMContentLoaded",qt);
//# sourceMappingURL=index-CwrI6LB_.js.map
