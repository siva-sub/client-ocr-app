import{c as ae,g as Le,a as Be}from"./pdfjs-CRNIONdy.js";import{b as ue,F as te,H as ce}from"./onnxruntime-CqRzMC93.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var Se={exports:{}};/*! store2 - v2.14.4 - 2024-12-26
* Copyright (c) 2024 Nathan Bubna; Licensed MIT */(function(c){(function(e,t){var r={version:"2.14.4",areas:{},apis:{},nsdelim:".",inherit:function(n,i){for(var o in n)i.hasOwnProperty(o)||Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(n,o));return i},stringify:function(n,i){return n===void 0||typeof n=="function"?n+"":JSON.stringify(n,i||r.replace)},parse:function(n,i){try{return JSON.parse(n,i||r.revive)}catch{return n}},fn:function(n,i){r.storeAPI[n]=i;for(var o in r.apis)r.apis[o][n]=i},get:function(n,i){return n.getItem(i)},set:function(n,i,o){n.setItem(i,o)},remove:function(n,i){n.removeItem(i)},key:function(n,i){return n.key(i)},length:function(n){return n.length},clear:function(n){n.clear()},Store:function(n,i,o){var a=r.inherit(r.storeAPI,function(l,f,_){return arguments.length===0?a.getAll():typeof f=="function"?a.transact(l,f,_):f!==void 0?a.set(l,f,_):typeof l=="string"||typeof l=="number"?a.get(l):typeof l=="function"?a.each(l):l?a.setAll(l,f):a.clear()});a._id=n;try{var h="__store2_test";i.setItem(h,"ok"),a._area=i,i.removeItem(h)}catch{a._area=r.storage("fake")}return a._ns=o||"",r.areas[n]||(r.areas[n]=a._area),r.apis[a._ns+a._id]||(r.apis[a._ns+a._id]=a),a},storeAPI:{area:function(n,i){var o=this[n];return(!o||!o.area)&&(o=r.Store(n,i,this._ns),this[n]||(this[n]=o)),o},namespace:function(n,i,o){if(o=o||this._delim||r.nsdelim,!n)return this._ns?this._ns.substring(0,this._ns.length-o.length):"";var a=n,h=this[a];if((!h||!h.namespace)&&(h=r.Store(this._id,this._area,this._ns+a+o),h._delim=o,this[a]||(this[a]=h),!i))for(var l in r.areas)h.area(l,r.areas[l]);return h},isFake:function(n){return n?(this._real=this._area,this._area=r.storage("fake")):n===!1&&(this._area=this._real||this._area),this._area.name==="fake"},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(n){return this._area.has?this._area.has(this._in(n)):this._in(n)in this._area},size:function(){return this.keys().length},each:function(n,i){for(var o=0,a=r.length(this._area);o<a;o++){var h=this._out(r.key(this._area,o));if(h!==void 0&&n.call(this,h,this.get(h),i)===!1)break;a>r.length(this._area)&&(a--,o--)}return i||this},keys:function(n){return this.each(function(i,o,a){a.push(i)},n||[])},get:function(n,i){var o=r.get(this._area,this._in(n)),a;return typeof i=="function"&&(a=i,i=null),o!==null?r.parse(o,a):i??o},getAll:function(n){return this.each(function(i,o,a){a[i]=o},n||{})},transact:function(n,i,o){var a=this.get(n,o),h=i(a);return this.set(n,h===void 0?a:h),this},set:function(n,i,o){var a=this.get(n),h;return a!=null&&o===!1?i:(typeof o=="function"&&(h=o,o=void 0),r.set(this._area,this._in(n),r.stringify(i,h),o)||a)},setAll:function(n,i){var o,a;for(var h in n)a=n[h],this.set(h,a,i)!==a&&(o=!0);return o},add:function(n,i,o){var a=this.get(n);if(a instanceof Array)i=a.concat(i);else if(a!==null){var h=typeof a;if(h===typeof i&&h==="object"){for(var l in i)a[l]=i[l];i=a}else i=a+i}return r.set(this._area,this._in(n),r.stringify(i,o)),i},remove:function(n,i){var o=this.get(n,i);return r.remove(this._area,this._in(n)),o},clear:function(){return this._ns?this.each(function(n){r.remove(this._area,this._in(n))},1):r.clear(this._area),this},clearAll:function(){var n=this._area;for(var i in r.areas)r.areas.hasOwnProperty(i)&&(this._area=r.areas[i],this.clear());return this._area=n,this},_in:function(n){return typeof n!="string"&&(n=r.stringify(n)),this._ns?this._ns+n:n},_out:function(n){return this._ns?n&&n.indexOf(this._ns)===0?n.substring(this._ns.length):void 0:n}},storage:function(n){return r.inherit(r.storageAPI,{items:{},name:n})},storageAPI:{length:0,has:function(n){return this.items.hasOwnProperty(n)},key:function(n){var i=0;for(var o in this.items)if(this.has(o)&&n===i++)return o},setItem:function(n,i){this.has(n)||this.length++,this.items[n]=i},removeItem:function(n){this.has(n)&&(delete this.items[n],this.length--)},getItem:function(n){return this.has(n)?this.items[n]:null},clear:function(){for(var n in this.items)this.removeItem(n)}}},s=r.Store("local",function(){try{return localStorage}catch{}}());s.local=s,s._=r,s.area("session",function(){try{return sessionStorage}catch{}}()),s.area("page",r.storage("page")),typeof t=="function"&&t.amd!==void 0?t("store2",[],function(){return s}):c.exports?c.exports=s:(e.store&&(r.conflict=e.store),e.store=s)})(ae,ae&&ae.define)})(Se);var je=Se.exports;const Ue=Le(je);class Fe{constructor(e={}){this.namespace=e.namespace||"ocr-cache",this.maxCacheSize=e.maxCacheSize||50*1024*1024,this.maxAge=e.maxAge||7*24*60*60*1e3,this.store=Ue.namespace(this.namespace),this.store.get("metadata")||this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}}),this.cleanupOldEntries()}generateCacheKey(e,t,r){const n=`${typeof e=="string"?e:JSON.stringify(e)}-${t}-${r}`;let i=0;for(let o=0;o<n.length;o++){const a=n.charCodeAt(o);i=(i<<5)-i+a,i=i&i}return`ocr-${Math.abs(i).toString(36)}`}get(e,t,r){const s=this.generateCacheKey(e,t,r),n=this.store.get(s);return n?Date.now()-n.timestamp>this.maxAge?(this.remove(s),null):(n.lastAccessed=Date.now(),this.store.set(s,n),n.data):null}set(e,t,r,s){const n=this.generateCacheKey(e,t,r),i=JSON.stringify(s),o=new Blob([i]).size;this.ensureCacheSpace(o);const a={timestamp:Date.now(),lastAccessed:Date.now(),engineType:t,modelVersion:r,size:o,data:s},h=this.store.get("metadata");return h.totalSize+=o,h.entries[n]={size:o,timestamp:a.timestamp},this.store.set("metadata",h),this.store.set(n,a),n}remove(e){if(this.store.get(e)){const r=this.store.get("metadata");r.entries[e]&&(r.totalSize-=r.entries[e].size,delete r.entries[e],this.store.set("metadata",r)),this.store.remove(e)}}clear(){this.store.keys().forEach(t=>{t!=="metadata"&&this.store.remove(t)}),this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}})}getStats(){const e=this.store.get("metadata"),t=Object.keys(e.entries).length;return{totalSize:e.totalSize,maxSize:this.maxCacheSize,usagePercent:e.totalSize/this.maxCacheSize*100,entries:t,oldestEntry:this.getOldestEntry(),newestEntry:this.getNewestEntry()}}cleanupOldEntries(){const e=Date.now(),t=this.store.get("metadata"),r=[];Object.entries(t.entries).forEach(([s,n])=>{e-n.timestamp>this.maxAge&&r.push(s)}),r.forEach(s=>this.remove(s))}ensureCacheSpace(e){const t=this.store.get("metadata");if(t.totalSize+e<=this.maxCacheSize)return;const r=Object.entries(t.entries).sort((n,i)=>n[1].timestamp-i[1].timestamp);let s=t.totalSize;for(const[n]of r){if(s+e<=this.maxCacheSize)break;const i=this.store.get(n);i&&(s-=i.size,this.remove(n))}}getOldestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([r,s])=>{(!t||s.timestamp<t.timestamp)&&(t={key:r,...s})}),t}getNewestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([r,s])=>{(!t||s.timestamp>t.timestamp)&&(t={key:r,...s})}),t}export(){const e={metadata:this.store.get("metadata"),entries:{}};return this.store.keys().forEach(t=>{t!=="metadata"&&(e.entries[t]=this.store.get(t))}),e}import(e){if(!e||!e.metadata)throw new Error("Invalid cache data format");this.clear(),this.store.set("metadata",e.metadata),Object.entries(e.entries).forEach(([t,r])=>{this.store.set(t,r)})}}const U=new Fe;class fe{static async resizeImage(e,t,r){const s=document.createElement("canvas"),n=s.getContext("2d"),i=new Image,o=new Blob([e],{type:"image/png"}),a=URL.createObjectURL(o);return new Promise((h,l)=>{i.onload=()=>{s.width=t,s.height=r,n.drawImage(i,0,0,t,r);const f=n.getImageData(0,0,t,r);URL.revokeObjectURL(a),h(f)},i.onerror=l,i.src=a})}static canvasToImageData(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}static normalizeImageData(e,t=[.485,.456,.406],r=[.229,.224,.225]){const s=e.data,n=new Float32Array(s.length);for(let i=0;i<s.length;i+=4)n[i]=(s[i]/255-t[0])/r[0],n[i+1]=(s[i+1]/255-t[1])/r[1],n[i+2]=(s[i+2]/255-t[2])/r[2],n[i+3]=s[i+3]/255;return n}static hwcToChw(e,t,r){const n=new Float32Array(3*r*t),i=e.data||e;let o=0;for(let a=0;a<3;a++)for(let h=0;h<r;h++)for(let l=0;l<t;l++)n[o++]=i[(h*t+l)*4+a];return n}}class Oe{constructor(e={}){this.limitSideLen=e.det_limit_side_len||960,this.limitType=e.det_limit_type||"min",this.mean=e.mean||[.485,.456,.406],this.std=e.std||[.229,.224,.225],this.scale=e.scale||1/255}async preprocess(e){const t=e.width,r=e.height,{targetWidth:s,targetHeight:n}=this.calculateResizeDimensions(t,r),i=document.createElement("canvas");i.width=s,i.height=n;const o=i.getContext("2d");o.drawImage(e,0,0,s,n);const a=o.getImageData(0,0,s,n),h=this.normalizeImage(a);return{tensor:fe.hwcToChw(h,s,n),originalShape:[r,t],resizedShape:[n,s],ratio:[n/r,s/t]}}calculateResizeDimensions(e,t){let r=1;this.limitType==="max"?Math.max(t,e)>this.limitSideLen&&(r=this.limitSideLen/Math.max(t,e)):this.limitType==="min"&&Math.min(t,e)<this.limitSideLen&&(r=this.limitSideLen/Math.min(t,e));let s=Math.round(t*r),n=Math.round(e*r);return s=Math.max(Math.round(s/32)*32,32),n=Math.max(Math.round(n/32)*32,32),{targetWidth:n,targetHeight:s}}normalizeImage(e){const t=e.data,r=new Float32Array(t.length/4*3);let s=0;for(let n=0;n<t.length;n+=4)r[s++]=(t[n]*this.scale-this.mean[0])/this.std[0],r[s++]=(t[n+1]*this.scale-this.mean[1])/this.std[1],r[s++]=(t[n+2]*this.scale-this.mean[2])/this.std[2];return r}}class We{constructor(e={}){this.imageShape=e.cls_image_shape||[3,48,192]}async preprocess(e){const[t,r,s]=this.imageShape,n=e.width,i=e.height,o=n/i;let a=Math.ceil(r*o);a>s&&(a=s);const h=document.createElement("canvas");h.width=a,h.height=r,h.getContext("2d").drawImage(e,0,0,a,r);const f=document.createElement("canvas");f.width=s,f.height=r;const _=f.getContext("2d");_.fillStyle="black",_.fillRect(0,0,s,r),_.drawImage(h,0,0);const w=_.getImageData(0,0,s,r),y=this.normalizeImage(w);return fe.hwcToChw(y,s,r)}normalizeImage(e){const t=e.data,r=new Float32Array(t.length/4*3);let s=0;for(let n=0;n<t.length;n+=4)r[s++]=(t[n]/255-.5)/.5,r[s++]=(t[n+1]/255-.5)/.5,r[s++]=(t[n+2]/255-.5)/.5;return r}}class ke{constructor(e={}){this.imageShape=e.rec_image_shape||[3,48,320],this.recAlgorithm=e.rec_algorithm||"SVTR_LCNet"}async preprocess(e,t=null){const[r,s,n]=this.imageShape,i=e.width,o=e.height;t||(t=i/o);let a=Math.round(s*t);this.recAlgorithm==="NRTR"||this.recAlgorithm==="ViTSTR"?a=n:a=Math.min(a,n);const h=i/o;let l=Math.ceil(s*h);l>a&&(l=a);const f=document.createElement("canvas");f.width=l,f.height=s,f.getContext("2d").drawImage(e,0,0,l,s);const w=document.createElement("canvas");w.width=a,w.height=s;const y=w.getContext("2d");y.fillStyle="black",y.fillRect(0,0,a,s),y.drawImage(f,0,0);const x=y.getImageData(0,0,a,s),E=this.normalizeImage(x);return{tensor:fe.hwcToChw(E,a,s),shape:[1,r,s,a]}}normalizeImage(e){const t=e.data,r=new Float32Array(t.length/4*3);let s=0;for(let n=0;n<t.length;n+=4)r[s++]=(t[n]/255-.5)/.5,r[s++]=(t[n+1]/255-.5)/.5,r[s++]=(t[n+2]/255-.5)/.5;return r}}class Ge{static extractRegion(e,t){const r=this.sortPoints(t),s=Math.max(this.distance(r[0],r[1]),this.distance(r[3],r[2])),n=Math.max(this.distance(r[0],r[3]),this.distance(r[1],r[2])),i=document.createElement("canvas");i.width=Math.round(s),i.height=Math.round(n);const o=i.getContext("2d"),a=r,h=[[0,0],[s,0],[s,n],[0,n]];o.save();const l=document.createElement("canvas");l.width=e.width,l.height=e.height,l.getContext("2d").drawImage(e,0,0),o.beginPath(),o.moveTo(0,0),o.lineTo(s,0),o.lineTo(s,n),o.lineTo(0,n),o.closePath(),o.clip();const _=this.getPerspectiveTransform(a,h,s,n);if(o.setTransform(_.a,_.b,_.c,_.d,_.e,_.f),o.drawImage(e,0,0),o.restore(),n>s*1.5){const w=document.createElement("canvas");w.width=i.height,w.height=i.width;const y=w.getContext("2d");return y.translate(w.width/2,w.height/2),y.rotate(Math.PI/2),y.drawImage(i,-i.width/2,-i.height/2),w}return i}static sortPoints(e){const t=e.reduce((o,a)=>[o[0]+a[0]/e.length,o[1]+a[1]/e.length],[0,0]),r=e.slice().sort((o,a)=>{const h=Math.atan2(o[1]-t[1],o[0]-t[0]),l=Math.atan2(a[1]-t[1],a[0]-t[0]);return h-l});let s=0,n=r[0][0]+r[0][1];for(let o=1;o<r.length;o++){const a=r[o][0]+r[o][1];a<n&&(n=a,s=o)}const i=[];for(let o=0;o<r.length;o++)i.push(r[(s+o)%r.length]);return i}static distance(e,t){const r=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(r*r+s*s)}static getPerspectiveTransform(e,t,r,s){const n=r/(e[1][0]-e[0][0]),i=s/(e[3][1]-e[0][1]);return{a:n,b:0,c:0,d:i,e:-e[0][0]*n,f:-e[0][1]*i}}}class He{constructor(e={}){this.thresh=e.thresh||.3,this.boxThresh=e.box_thresh||.6,this.maxCandidates=e.max_candidates||1e3,this.unclipRatio=e.unclip_ratio||1.5,this.minSize=e.min_size||3,this.scoreMode=e.score_mode||"fast"}process(e,t){const r=e[0],s=t[0],n=this.threshold(r),i=this.findContours(n),o=[],a=[];for(const h of i){if(h.length<4)continue;const l=this.getMinAreaRect(h);if(!l)continue;const f=this.boxScore(r,l);if(f<this.boxThresh)continue;const _=this.unclip(l);if(!_)continue;const w=this.rescaleBox(_,s);this.validateBox(w)&&(o.push(w),a.push(f))}return{boxes:o,scores:a}}threshold(e){const t=e.length,r=e[0].length,s=[];for(let n=0;n<t;n++){s[n]=[];for(let i=0;i<r;i++)s[n][i]=e[n][i]>this.thresh?1:0}return s}findContours(e){const t=e.length,r=e[0].length,s=Array(t).fill(null).map(()=>Array(r).fill(!1)),n=[];for(let i=0;i<t;i++)for(let o=0;o<r;o++)if(e[i][o]===1&&!s[i][o]){const a=this.traceContour(e,s,i,o);a.length>=4&&n.push(a)}return n}traceContour(e,t,r,s){const n=e.length,i=e[0].length,o=[],a=[[r,s]],h=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(;a.length>0;){const[l,f]=a.shift();if(t[l][f])continue;t[l][f]=!0;let _=!1;for(const[w,y]of h){const x=l+w,E=f+y;if(x<0||x>=n||E<0||E>=i||e[x][E]===0){_=!0;break}}_&&o.push([f,l]);for(const[w,y]of h){const x=l+w,E=f+y;x>=0&&x<n&&E>=0&&E<i&&e[x][E]===1&&!t[x][E]&&a.push([x,E])}}return o}getMinAreaRect(e){if(e.length<4)return null;const t=this.convexHull(e);if(t.length<4)return null;let r=1/0,s=null;for(let n=0;n<t.length;n++){const i=t[n],o=t[(n+1)%t.length],a=[o[0]-i[0],o[1]-i[1]],h=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(h===0)continue;a[0]/=h,a[1]/=h;let l=1/0,f=-1/0,_=1/0,w=-1/0;for(const T of t){const S=(T[0]-i[0])*a[0]+(T[1]-i[1])*a[1],C=(T[0]-i[0])*-a[1]+(T[1]-i[1])*a[0];l=Math.min(l,S),f=Math.max(f,S),_=Math.min(_,C),w=Math.max(w,C)}const y=f-l,x=w-_,E=y*x;if(E<r){r=E;const T=[i[0]+l*a[0]+_*-a[1],i[1]+l*a[1]+_*a[0]],S=[i[0]+f*a[0]+_*-a[1],i[1]+f*a[1]+_*a[0]],C=[i[0]+f*a[0]+w*-a[1],i[1]+f*a[1]+w*a[0]],z=[i[0]+l*a[0]+w*-a[1],i[1]+l*a[1]+w*a[0]];s=[T,S,C,z]}}return s}convexHull(e){if(e.length<3)return e;let t=0;for(let i=1;i<e.length;i++)(e[i][1]<e[t][1]||e[i][1]===e[t][1]&&e[i][0]<e[t][0])&&(t=i);const r=e.slice(),s=r.splice(t,1)[0];r.sort((i,o)=>{const a=Math.atan2(i[1]-s[1],i[0]-s[0]),h=Math.atan2(o[1]-s[1],o[0]-s[0]);if(a!==h)return a-h;const l=(i[0]-s[0])*(i[0]-s[0])+(i[1]-s[1])*(i[1]-s[1]),f=(o[0]-s[0])*(o[0]-s[0])+(o[1]-s[1])*(o[1]-s[1]);return l-f});const n=[s];for(const i of r){for(;n.length>=2;){const o=n[n.length-2],a=n[n.length-1];if((a[0]-o[0])*(i[1]-o[1])-(a[1]-o[1])*(i[0]-o[0])<=0)n.pop();else break}n.push(i)}return n}boxScore(e,t){const r=Math.min(...t.map(h=>h[0])),s=Math.max(...t.map(h=>h[0])),n=Math.min(...t.map(h=>h[1])),i=Math.max(...t.map(h=>h[1]));let o=0,a=0;for(let h=Math.floor(n);h<=Math.ceil(i);h++)for(let l=Math.floor(r);l<=Math.ceil(s);l++)h>=0&&h<e.length&&l>=0&&l<e[0].length&&this.pointInPolygon([l,h],t)&&(o+=e[h][l],a++);return a>0?o/a:0}pointInPolygon(e,t){let r=!1;const s=e[0],n=e[1];for(let i=0,o=t.length-1;i<t.length;o=i++){const a=t[i][0],h=t[i][1],l=t[o][0],f=t[o][1];h>n!=f>n&&s<(l-a)*(n-h)/(f-h)+a&&(r=!r)}return r}unclip(e){let t=0;for(let i=0;i<e.length;i++){const o=(i+1)%e.length,a=e[o][0]-e[i][0],h=e[o][1]-e[i][1];t+=Math.sqrt(a*a+h*h)}let r=0;for(let i=0;i<e.length;i++){const o=(i+1)%e.length;r+=e[i][0]*e[o][1]-e[o][0]*e[i][1]}r=Math.abs(r)/2;const s=r*this.unclipRatio/t,n=[];for(let i=0;i<e.length;i++){const o=e[(i-1+e.length)%e.length],a=e[i],h=e[(i+1)%e.length],l=[o[0]-a[0],o[1]-a[1]],f=[h[0]-a[0],h[1]-a[1]],_=Math.sqrt(l[0]*l[0]+l[1]*l[1]),w=Math.sqrt(f[0]*f[0]+f[1]*f[1]);_>0&&(l[0]/=_,l[1]/=_),w>0&&(f[0]/=w,f[1]/=w);const y=[l[0]+f[0],l[1]+f[1]],x=Math.sqrt(y[0]*y[0]+y[1]*y[1]);x>0?(y[0]/=x,y[1]/=x,n.push([a[0]-y[0]*s,a[1]-y[1]*s])):n.push(a)}return n}rescaleBox(e,t){const[r,s,n,i]=t;return e.map(o=>[o[0]/i,o[1]/n])}validateBox(e){const t=Math.max(this.distance(e[0],e[1]),this.distance(e[2],e[3])),r=Math.max(this.distance(e[0],e[3]),this.distance(e[1],e[2]));return t>=this.minSize&&r>=this.minSize}distance(e,t){const r=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(r*r+s*s)}}class Ke{constructor(e={}){this.labelList=e.label_list||["0","180"],this.clsThresh=e.cls_thresh||.9}process(e){const t=[],r=e[0];for(let s=0;s<r.length;s++){const n=r[s],i=n.indexOf(Math.max(...n)),o=n[i],a=this.labelList[i];t.push({label:a,score:o,shouldRotate:a==="180"&&o>this.clsThresh})}return t}}class Ye{constructor(e){this.characterDict=e,this.blankIdx=e.length}decode(e,t="greedy"){if(t==="greedy")return this.greedyDecode(e);if(t==="beam_search")return this.beamSearchDecode(e);throw new Error(`Unknown decode method: ${t}`)}greedyDecode(e){const t=[];for(const r of e){const s=[];let n=-1;for(let a=0;a<r.length;a++){const h=r[a].indexOf(Math.max(...r[a]));h!==this.blankIdx&&h!==n&&s.push(h),n=h}const i=s.map(a=>this.characterDict[a]).join(""),o=this.calculateConfidence(r,s);t.push({text:i,confidence:o})}return t}beamSearchDecode(e,t=5){const r=[];for(const s of e){const i=this.beamSearch(s,t)[0];r.push({text:i.text,confidence:i.score})}return r}beamSearch(e,t){let r=[{text:"",score:1,lastIdx:-1}];for(let s=0;s<e.length;s++){const n=[];for(const i of r){const o=e[s],a=this.getTopK(o,t);for(const[h,l]of a)h===this.blankIdx?n.push({text:i.text,score:i.score*l,lastIdx:h}):h!==i.lastIdx?n.push({text:i.text+this.characterDict[h],score:i.score*l,lastIdx:h}):n.push({text:i.text,score:i.score*l,lastIdx:h})}n.sort((i,o)=>o.score-i.score),r=n.slice(0,t)}return r}getTopK(e,t){const r=e.map((s,n)=>[n,s]);return r.sort((s,n)=>n[1]-s[1]),r.slice(0,t)}calculateConfidence(e,t){if(t.length===0)return 0;let r=0,s=0;for(const n of t)for(;s<e.length;){if(e[s].indexOf(Math.max(...e[s]))===n){r+=e[s][n],s++;break}s++}return r/t.length}}function qe(c){if(!c||c.length===0)return[];const e=c.map((t,r)=>{const s=t.reduce((i,o)=>i+o[0],0)/t.length,n=t.reduce((i,o)=>i+o[1],0)/t.length;return{box:t,index:r,centerX:s,centerY:n}});return e.sort((t,r)=>Math.abs(t.centerY-r.centerY)<10?t.centerX-r.centerX:t.centerY-r.centerY),e.map(t=>t.box)}const Ee=window.location.hostname.includes("github.io"),Je=Ee?"/client-ocr-app/assets/":"/public/assets/";ue.wasm.wasmPaths=Je;ue.wasm.numThreads=1;class me{constructor(e={}){this.modelName=e.modelName||"PP-OCRv5",this.useAngleCls=e.useAngleCls!==!1,this.useCache=e.useCache!==!1;const t=Ee?"/client-ocr-app/models/":"/public/models/";this.modelPaths={"PP-OCRv5":{det:t+"PP-OCRv5/det/det.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5/rec/rec.onnx",dict:t+"PP-OCRv5/ppocrv5_dict.txt"},"PP-OCRv5_mobile":{det:t+"PP-OCRv5_mobile_det_infer.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5_mobile_rec_infer.onnx",dict:t+"ppocrv5_dict.txt"},"PP-OCRv4":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"PP-OCRv4/rec/rec.onnx",dict:t+"PP-OCRv4/ppocr_keys_v1.txt"},"PP-OCRv4_mobile":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"en_PP-OCRv4_mobile_rec_infer.onnx",dict:t+"en_dict.txt"},"ch_ppocr_server_v2.0":{det:t+"ch_ppocr_server_v2.0/det/det.onnx",cls:t+"ch_ppocr_server_v2.0/cls/cls.onnx",rec:null,dict:t+"ch_ppocr_server_v2.0/ppocr_keys_v1.txt"}},this.detParams={det_limit_side_len:e.detLimitSideLen||960,det_limit_type:e.detLimitType||"min",det_db_thresh:e.detDbThresh||.3,det_db_box_thresh:e.detDbBoxThresh||.6,det_db_unclip_ratio:e.detDbUnclipRatio||1.7,det_db_score_mode:e.detDbScoreMode||"fast"},this.clsParams={cls_image_shape:[3,48,192],cls_thresh:e.clsThresh||.9,label_list:["0","180"]},this.recParams={rec_image_shape:[3,48,320],rec_algorithm:"SVTR_LCNet"},this.detPreprocessor=new Oe(this.detParams),this.clsPreprocessor=new We(this.clsParams),this.recPreprocessor=new ke(this.recParams),this.detPostprocessor=new He({thresh:this.detParams.det_db_thresh,box_thresh:this.detParams.det_db_box_thresh,unclip_ratio:this.detParams.det_db_unclip_ratio,score_mode:this.detParams.det_db_score_mode}),this.clsPostprocessor=new Ke(this.clsParams),this.detSession=null,this.clsSession=null,this.recSession=null,this.characterDict=null,this.ctcDecoder=null,this.initialized=!1}async initialize(e=null){if(!this.initialized)try{const t=this.modelPaths[this.modelName];if(!t)throw new Error(`Unknown model: ${this.modelName}`);if(e==null||e("Loading character dictionary..."),await this.loadCharacterDict(t.dict),e==null||e("Loading detection model..."),this.detSession=await te.create(t.det,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),this.useAngleCls&&(e==null||e("Loading angle classification model..."),this.clsSession=await te.create(t.cls,{executionProviders:["wasm"],graphOptimizationLevel:"all"})),t.rec)e==null||e("Loading recognition model..."),this.recSession=await te.create(t.rec,{executionProviders:["wasm"],graphOptimizationLevel:"all"});else if(this.modelName==="ch_ppocr_server_v2.0"){const r="/public/models/PP-OCRv4/rec/rec.onnx";e==null||e("Loading recognition model (fallback)..."),this.recSession=await te.create(r,{executionProviders:["wasm"],graphOptimizationLevel:"all"})}this.initialized=!0,e==null||e("Initialization complete!")}catch(t){throw console.error("Failed to initialize PP-OCRv5 ONNX engine:",t),t}}async loadCharacterDict(e){try{const r=await(await fetch(e)).text();this.characterDict=r.split(`
`).filter(s=>s.length>0),this.ctcDecoder=new Ye(this.characterDict)}catch(t){throw console.error("Failed to load character dictionary:",t),t}}async process(e,t=null){if(this.initialized||await this.initialize(t),this.useCache){const h=await this.checkCache(e);if(h)return t==null||t("Using cached result"),h}const r=await this.inputToCanvas(e);t==null||t("Detecting text regions...");const s=await this.detectText(r);if(!s||s.boxes.length===0)return{text:"",boxes:[],lines:[]};const n=qe(s.boxes),i=[];for(let h=0;h<n.length;h++){t==null||t(`Processing region ${h+1}/${n.length}...`);const l=n[h],f=Ge.extractRegion(r,l);let _=0;if(this.useAngleCls&&this.clsSession&&(await this.classifyAngle(f)).shouldRotate){const x=this.rotateCanvas(f,180);f.width=x.width,f.height=x.height,f.getContext("2d").drawImage(x,0,0),_=180}const w=await this.recognizeText(f);i.push({box:l,text:w.text,confidence:w.confidence,angle:_})}const a={text:i.map(h=>h.text).join(`
`),boxes:n,lines:i,modelName:this.modelName};return this.useCache&&await this.cacheResult(e,a),a}async detectText(e){const t=await this.detPreprocessor.preprocess(e),s={x:new ce("float32",t.tensor,[1,3,t.resizedShape[0],t.resizedShape[1]])},n=await this.detSession.run(s),i=n.sigmoid_0||n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],o=i.data,[,,a,h]=i.dims,l=[];for(let _=0;_<a;_++){l[_]=[];for(let w=0;w<h;w++)l[_][w]=o[_*h+w]}return this.detPostprocessor.process([l],[t.originalShape.concat(t.ratio)])}async classifyAngle(e){const t=await this.clsPreprocessor.preprocess(e),s={x:new ce("float32",t,[1,...this.clsParams.cls_image_shape])},n=await this.clsSession.run(s),i=n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],o=Array.from(i.data);return this.clsPostprocessor.process([o])[0]}async recognizeText(e){if(!this.recSession)return{text:"",confidence:0};const t=e.width/e.height,r=await this.recPreprocessor.preprocess(e,t),n={x:new ce("float32",r.tensor,r.shape)},i=await this.recSession.run(n),o=i.save_infer_model_scale_0_tmp_1||Object.values(i)[0],[,a,h]=o.dims,l=o.data,f=[];for(let w=0;w<a;w++){const y=[];for(let x=0;x<h;x++)y.push(l[w*h+x]);f.push(y)}return this.ctcDecoder.decode([f],"greedy")[0]}async inputToCanvas(e){if(e instanceof HTMLCanvasElement)return e;const t=document.createElement("canvas"),r=t.getContext("2d");if(e instanceof File||e instanceof Blob){const s=new Image,n=URL.createObjectURL(e);return new Promise((i,o)=>{s.onload=()=>{t.width=s.width,t.height=s.height,r.drawImage(s,0,0),URL.revokeObjectURL(n),i(t)},s.onerror=o,s.src=n})}else if(typeof e=="string"){const s=new Image;return s.crossOrigin="anonymous",new Promise((n,i)=>{s.onload=()=>{t.width=s.width,t.height=s.height,r.drawImage(s,0,0),n(t)},s.onerror=i,s.src=e})}throw new Error("Unsupported input type")}rotateCanvas(e,t){const r=t*Math.PI/180,s=document.createElement("canvas"),n=s.getContext("2d");return t===180?(s.width=e.width,s.height=e.height,n.translate(e.width,e.height),n.rotate(r),n.drawImage(e,0,0)):t===90||t===-270?(s.width=e.height,s.height=e.width,n.translate(e.height,0),n.rotate(r),n.drawImage(e,0,0)):(t===-90||t===270)&&(s.width=e.height,s.height=e.width,n.translate(0,e.width),n.rotate(r),n.drawImage(e,0,0)),s}async checkCache(e){if(!this.useCache)return null;const t=await this.generateCacheKey(e);return U.get(t,"ppocr-v5-onnx",this.modelName)}async cacheResult(e,t){if(!this.useCache)return;const r=await this.generateCacheKey(e);U.set(r,"ppocr-v5-onnx",this.modelName,t)}async generateCacheKey(e){return e instanceof File?await this.fileToBase64(e):typeof e=="string"?e:e instanceof HTMLCanvasElement?e.toDataURL():JSON.stringify(e)}async fileToBase64(e){return new Promise((t,r)=>{const s=new FileReader;s.onload=n=>t(n.target.result),s.onerror=r,s.readAsDataURL(e)})}getCacheStats(){return U.getStats()}clearCache(){U.clear()}}new me;class Re{static getPresets(){return{high_accuracy:{detLimitSideLen:1920,detDbThresh:.2,detDbBoxThresh:.5,detDbUnclipRatio:2,dropScore:.3,useAngleCls:!0},fast_processing:{detLimitSideLen:640,detDbThresh:.4,detDbBoxThresh:.7,detDbUnclipRatio:1.5,dropScore:.6,useAngleCls:!1},balanced:{detLimitSideLen:960,detDbThresh:.3,detDbBoxThresh:.6,detDbUnclipRatio:1.7,dropScore:.5,useAngleCls:!0},handwritten:{detLimitSideLen:1280,detDbThresh:.15,detDbBoxThresh:.4,detDbUnclipRatio:2.5,dropScore:.3,useAngleCls:!0},low_quality:{detLimitSideLen:1440,detDbThresh:.1,detDbBoxThresh:.3,detDbUnclipRatio:3,dropScore:.2,useAngleCls:!0}}}static mergeWithPreset(e,t={}){const r=this.getPresets();return{...r[e]||r.balanced,...t}}}var Ve={exports:{}};(function(c){var e=function(t){var r=Object.prototype,s=r.hasOwnProperty,n=Object.defineProperty||function(m,d,g){m[d]=g.value},i,o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",h=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function f(m,d,g){return Object.defineProperty(m,d,{value:g,enumerable:!0,configurable:!0,writable:!0}),m[d]}try{f({},"")}catch{f=function(d,g,v){return d[g]=v}}function _(m,d,g,v){var u=d&&d.prototype instanceof C?d:C,p=Object.create(u.prototype),P=new J(v||[]);return n(p,"_invoke",{value:ie(m,g,P)}),p}t.wrap=_;function w(m,d,g){try{return{type:"normal",arg:m.call(d,g)}}catch(v){return{type:"throw",arg:v}}}var y="suspendedStart",x="suspendedYield",E="executing",T="completed",S={};function C(){}function z(){}function R(){}var K={};f(K,a,function(){return this});var Y=Object.getPrototypeOf,W=Y&&Y(Y(V([])));W&&W!==r&&s.call(W,a)&&(K=W);var N=R.prototype=C.prototype=Object.create(K);z.prototype=R,n(N,"constructor",{value:R,configurable:!0}),n(R,"constructor",{value:z,configurable:!0}),z.displayName=f(R,l,"GeneratorFunction");function Q(m){["next","throw","return"].forEach(function(d){f(m,d,function(g){return this._invoke(d,g)})})}t.isGeneratorFunction=function(m){var d=typeof m=="function"&&m.constructor;return d?d===z||(d.displayName||d.name)==="GeneratorFunction":!1},t.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,R):(m.__proto__=R,f(m,l,"GeneratorFunction")),m.prototype=Object.create(N),m},t.awrap=function(m){return{__await:m}};function k(m,d){function g(p,P,b,L){var O=w(m[p],m,P);if(O.type==="throw")L(O.arg);else{var $=O.arg,M=$.value;return M&&typeof M=="object"&&s.call(M,"__await")?d.resolve(M.__await).then(function(D){g("next",D,b,L)},function(D){g("throw",D,b,L)}):d.resolve(M).then(function(D){$.value=D,b($)},function(D){return g("throw",D,b,L)})}}var v;function u(p,P){function b(){return new d(function(L,O){g(p,P,L,O)})}return v=v?v.then(b,b):b()}n(this,"_invoke",{value:u})}Q(k.prototype),f(k.prototype,h,function(){return this}),t.AsyncIterator=k,t.async=function(m,d,g,v,u){u===void 0&&(u=Promise);var p=new k(_(m,d,g,v),u);return t.isGeneratorFunction(d)?p:p.next().then(function(P){return P.done?P.value:p.next()})};function ie(m,d,g){var v=y;return function(p,P){if(v===E)throw new Error("Generator is already running");if(v===T){if(p==="throw")throw P;return ee()}for(g.method=p,g.arg=P;;){var b=g.delegate;if(b){var L=q(b,g);if(L){if(L===S)continue;return L}}if(g.method==="next")g.sent=g._sent=g.arg;else if(g.method==="throw"){if(v===y)throw v=T,g.arg;g.dispatchException(g.arg)}else g.method==="return"&&g.abrupt("return",g.arg);v=E;var O=w(m,d,g);if(O.type==="normal"){if(v=g.done?T:x,O.arg===S)continue;return{value:O.arg,done:g.done}}else O.type==="throw"&&(v=T,g.method="throw",g.arg=O.arg)}}}function q(m,d){var g=d.method,v=m.iterator[g];if(v===i)return d.delegate=null,g==="throw"&&m.iterator.return&&(d.method="return",d.arg=i,q(m,d),d.method==="throw")||g!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+g+"' method")),S;var u=w(v,m.iterator,d.arg);if(u.type==="throw")return d.method="throw",d.arg=u.arg,d.delegate=null,S;var p=u.arg;if(!p)return d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,S;if(p.done)d[m.resultName]=p.value,d.next=m.nextLoc,d.method!=="return"&&(d.method="next",d.arg=i);else return p;return d.delegate=null,S}Q(N),f(N,l,"Generator"),f(N,a,function(){return this}),f(N,"toString",function(){return"[object Generator]"});function oe(m){var d={tryLoc:m[0]};1 in m&&(d.catchLoc=m[1]),2 in m&&(d.finallyLoc=m[2],d.afterLoc=m[3]),this.tryEntries.push(d)}function B(m){var d=m.completion||{};d.type="normal",delete d.arg,m.completion=d}function J(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(oe,this),this.reset(!0)}t.keys=function(m){var d=Object(m),g=[];for(var v in d)g.push(v);return g.reverse(),function u(){for(;g.length;){var p=g.pop();if(p in d)return u.value=p,u.done=!1,u}return u.done=!0,u}};function V(m){if(m){var d=m[a];if(d)return d.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var g=-1,v=function u(){for(;++g<m.length;)if(s.call(m,g))return u.value=m[g],u.done=!1,u;return u.value=i,u.done=!0,u};return v.next=v}}return{next:ee}}t.values=V;function ee(){return{value:i,done:!0}}return J.prototype={constructor:J,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(B),!m)for(var d in this)d.charAt(0)==="t"&&s.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=i)},stop:function(){this.done=!0;var m=this.tryEntries[0],d=m.completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var d=this;function g(L,O){return p.type="throw",p.arg=m,d.next=L,O&&(d.method="next",d.arg=i),!!O}for(var v=this.tryEntries.length-1;v>=0;--v){var u=this.tryEntries[v],p=u.completion;if(u.tryLoc==="root")return g("end");if(u.tryLoc<=this.prev){var P=s.call(u,"catchLoc"),b=s.call(u,"finallyLoc");if(P&&b){if(this.prev<u.catchLoc)return g(u.catchLoc,!0);if(this.prev<u.finallyLoc)return g(u.finallyLoc)}else if(P){if(this.prev<u.catchLoc)return g(u.catchLoc,!0)}else if(b){if(this.prev<u.finallyLoc)return g(u.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(m,d){for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g];if(v.tryLoc<=this.prev&&s.call(v,"finallyLoc")&&this.prev<v.finallyLoc){var u=v;break}}u&&(m==="break"||m==="continue")&&u.tryLoc<=d&&d<=u.finallyLoc&&(u=null);var p=u?u.completion:{};return p.type=m,p.arg=d,u?(this.method="next",this.next=u.finallyLoc,S):this.complete(p)},complete:function(m,d){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&d&&(this.next=d),S},finish:function(m){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.finallyLoc===m)return this.complete(g.completion,g.afterLoc),B(g),S}},catch:function(m){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc===m){var v=g.completion;if(v.type==="throw"){var u=v.arg;B(g)}return u}}throw new Error("illegal catch attempt")},delegateYield:function(m,d,g){return this.delegate={iterator:V(m),resultName:d,nextLoc:g},this.method==="next"&&(this.arg=i),S}},t}(c.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(Ve);var ge=(c,e)=>`${c}-${e}-${Math.random().toString(16).slice(3,8)}`;const Ze=ge;let _e=0;var Te=({id:c,action:e,payload:t={}})=>{let r=c;return typeof r>"u"&&(r=Ze("Job",_e),_e+=1),{id:r,action:e,payload:t}},H={};let pe=!1;H.logging=pe;H.setLogging=c=>{pe=c};H.log=(...c)=>pe?console.log.apply(void 0,c):null;const Xe=Te,{log:ne}=H,Qe=ge;let we=0;var et=()=>{const c=Qe("Scheduler",we),e={},t={};let r=[];we+=1;const s=()=>r.length,n=()=>Object.keys(e).length,i=()=>{if(r.length!==0){const f=Object.keys(e);for(let _=0;_<f.length;_+=1)if(typeof t[f[_]]>"u"){r[0](e[f[_]]);break}}},o=(f,_)=>new Promise((w,y)=>{const x=Xe({action:f,payload:_});r.push(async E=>{r.shift(),t[E.id]=x;try{w(await E[f].apply(void 0,[..._,x.id]))}catch(T){y(T)}finally{delete t[E.id],i()}}),ne(`[${c}]: Add ${x.id} to JobQueue`),ne(`[${c}]: JobQueue length=${r.length}`),i()});return{addWorker:f=>(e[f.id]=f,ne(`[${c}]: Add ${f.id}`),ne(`[${c}]: Number of workers=${n()}`),i(),f.id),addJob:async(f,..._)=>{if(n()===0)throw Error(`[${c}]: You need to have at least one worker before adding jobs`);return o(f,_)},terminate:async()=>{Object.keys(e).forEach(async f=>{await e[f].terminate()}),r=[]},getQueueLen:s,getNumWorkers:n}};function tt(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var nt=tt;const rt=nt;var st=c=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":rt()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof Be=="function"&&(e.type="node"),typeof c>"u"?e:e[c]};const it=st("type")==="browser",ot=it?c=>new URL(c,window.location.href).href:c=>c;var at=c=>{const e={...c};return["corePath","workerPath","langPath"].forEach(t=>{c[t]&&(e[t]=ot(e[t]))}),e},ct=c=>{const e=[],t=[],r=[],s=[],n=[];return c.blocks&&c.blocks.forEach(i=>{i.paragraphs.forEach(o=>{o.lines.forEach(a=>{a.words.forEach(h=>{h.symbols.forEach(l=>{n.push({...l,page:c,block:i,paragraph:o,line:a,word:h})}),s.push({...h,page:c,block:i,paragraph:o,line:a})}),r.push({...a,page:c,block:i,paragraph:o})}),t.push({...o,page:c,block:i})}),e.push({...i,page:c})}),{...c,blocks:e,paragraphs:t,lines:r,words:s,symbols:n}},Ie={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const ht="5.1.1",lt={version:ht};var dt={workerBlobURL:!0,logger:()=>{}};const ut=lt.version,ft=dt;var mt={...ft,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${ut}/dist/worker.min.js`},gt=({workerPath:c,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const r=new Blob([`importScripts("${c}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(r))}else t=new Worker(c);return t},pt=c=>{c.terminate()},_t=(c,e)=>{c.onmessage=({data:t})=>{e(t)}},wt=async(c,e)=>{c.postMessage(e)};const he=c=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=({target:{error:{code:s}}})=>{t(Error(`File could not be read! Code=${s}`))},r.readAsArrayBuffer(c)}),de=async c=>{let e=c;if(typeof c>"u")return"undefined";if(typeof c=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(c)?e=atob(c.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(c)).arrayBuffer();else if(typeof HTMLElement<"u"&&c instanceof HTMLElement)c.tagName==="IMG"&&(e=await de(c.src)),c.tagName==="VIDEO"&&(e=await de(c.poster)),c.tagName==="CANVAS"&&await new Promise(t=>{c.toBlob(async r=>{e=await he(r),t()})});else if(typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas){const t=await c.convertToBlob();e=await he(t)}else(c instanceof File||c instanceof Blob)&&(e=await he(c));return new Uint8Array(e)};var vt=de;const yt=mt,xt=gt,Pt=pt,bt=_t,Lt=wt,St=vt;var Ot={defaultOptions:yt,spawnWorker:xt,terminateWorker:Pt,onMessage:bt,send:Lt,loadImage:St};const Et=at,Rt=ct,A=Te,{log:ve}=H,Tt=ge,j=Ie,{defaultOptions:It,spawnWorker:Ct,terminateWorker:At,onMessage:zt,loadImage:ye,send:Mt}=Ot;let xe=0;var Ce=async(c="eng",e=j.LSTM_ONLY,t={},r={})=>{const s=Tt("Worker",xe),{logger:n,errorHandler:i,...o}=Et({...It,...t}),a={},h={},l=typeof c=="string"?c.split("+"):c;let f=e,_=r;const w=[j.DEFAULT,j.LSTM_ONLY].includes(e)&&!o.legacyCore;let y,x;const E=new Promise((u,p)=>{x=u,y=p}),T=u=>{y(u.message)};let S=Ct(o);S.onerror=T,xe+=1;const C=(u,p)=>{a[u]=p},z=(u,p)=>{h[u]=p},R=({id:u,action:p,payload:P})=>new Promise((b,L)=>{ve(`[${s}]: Start ${u}, action=${p}`);const O=`${p}-${u}`;C(O,b),z(O,L),Mt(S,{workerId:s,jobId:u,action:p,payload:P})}),K=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Y=u=>R(A({id:u,action:"load",payload:{options:{lstmOnly:w,corePath:o.corePath,logging:o.logging}}})),W=(u,p,P)=>R(A({id:P,action:"FS",payload:{method:"writeFile",args:[u,p]}})),N=(u,p)=>R(A({id:p,action:"FS",payload:{method:"readFile",args:[u,{encoding:"utf8"}]}})),Q=(u,p)=>R(A({id:p,action:"FS",payload:{method:"unlink",args:[u]}})),k=(u,p,P)=>R(A({id:P,action:"FS",payload:{method:u,args:p}})),ie=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),q=(u,p)=>R(A({id:p,action:"loadLanguage",payload:{langs:u,options:{langPath:o.langPath,dataPath:o.dataPath,cachePath:o.cachePath,cacheMethod:o.cacheMethod,gzip:o.gzip,lstmOnly:[j.DEFAULT,j.LSTM_ONLY].includes(f)&&!o.legacyLang}}})),oe=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),B=(u,p,P,b)=>R(A({id:b,action:"initialize",payload:{langs:u,oem:p,config:P}})),J=(u="eng",p,P,b)=>{if(w&&[j.TESSERACT_ONLY,j.TESSERACT_LSTM_COMBINED].includes(p))throw Error("Legacy model requested but code missing.");const L=p||f;f=L;const O=P||_;_=O;const M=(typeof u=="string"?u.split("+"):u).filter(D=>!l.includes(D));return l.push(...M),M.length>0?q(M,b).then(()=>B(u,L,O,b)):B(u,L,O,b)},V=(u={},p)=>R(A({id:p,action:"setParameters",payload:{params:u}})),ee=async(u,p={},P={blocks:!0,text:!0,hocr:!0,tsv:!0},b)=>R(A({id:b,action:"recognize",payload:{image:await ye(u),options:p,output:P}})),m=(u="Tesseract OCR Result",p=!1,P)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),R(A({id:P,action:"getPDF",payload:{title:u,textonly:p}}))),d=async(u,p)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return R(A({id:p,action:"detect",payload:{image:await ye(u)}}))},g=async()=>(S!==null&&(At(S),S=null),Promise.resolve());zt(S,({workerId:u,jobId:p,status:P,action:b,data:L})=>{const O=`${b}-${p}`;if(P==="resolve"){ve(`[${u}]: Complete ${p}`);let $=L;b==="recognize"?$=Rt(L):b==="getPDF"&&($=Array.from({...L,length:Object.keys(L).length})),a[O]({jobId:p,data:$})}else if(P==="reject")if(h[O](L),b==="load"&&y(L),i)i(L);else throw Error(L);else P==="progress"&&n({...L,userJobId:p})});const v={id:s,worker:S,setResolve:C,setReject:z,load:K,writeText:W,readText:N,removeFile:Q,FS:k,loadLanguage:ie,initialize:oe,reinitialize:J,setParameters:V,recognize:ee,getPDF:m,detect:d,terminate:g};return Y().then(()=>q(c)).then(()=>B(c,e,r)).then(()=>x(v)).catch(()=>{}),E};const Ae=Ce,Dt=async(c,e,t)=>{const r=await Ae(e,1,t);return r.recognize(c).finally(async()=>{await r.terminate()})},Nt=async(c,e)=>{const t=await Ae("osd",0,e);return t.detect(c).finally(async()=>{await t.terminate()})};var $t={recognize:Dt,detect:Nt},Bt={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},jt={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const Ut=et,Ft=Ce,Wt=$t,kt=Bt,Gt=Ie,Ht=jt,{setLogging:Kt}=H;var Yt={languages:kt,OEM:Gt,PSM:Ht,createScheduler:Ut,createWorker:Ft,setLogging:Kt,...Wt};const qt=Le(Yt);ue.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.16.3/dist/";class Jt{constructor(){this.detectionSession=null,this.recognitionSession=null,this.initialized=!1,this.canvas=null,this.ctx=null}async initialize(e){if(!this.initialized)try{this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e==null||e({status:"loading",message:"Loading text detection model..."}),this.initialized=!0,e==null||e({status:"ready",message:"OCR models loaded successfully!"})}catch(t){throw console.error("Failed to initialize PaddleOCR:",t),t}}async detectText(e){return await this.preprocessImage(e),[{box:[[10,10],[200,10],[200,50],[10,50]],confidence:.95}]}async recognizeText(e,t){const r=[];for(const s of t)await this.cropToBox(e,s),r.push({text:"Sample detected text",confidence:s.confidence});return r}async process(e){if(!this.initialized)throw new Error("PaddleOCR not initialized");const t=await this.blobToImageData(e),r=await this.detectText(t),s=await this.recognizeText(t,r);return r.map((i,o)=>({box:i.box,text:s[o].text,confidence:s[o].confidence}))}async preprocessImage(e){const r=Math.min(960/e.width,960/e.height),s=Math.round(e.width*r),n=Math.round(e.height*r);return this.canvas.width=s,this.canvas.height=n,this.ctx.drawImage(e,0,0,s,n),this.ctx.getImageData(0,0,s,n)}async cropToBox(e,t){const[r,s]=t.box[0],[n,i]=t.box[2],o=n-r,a=i-s;return this.canvas.width=o,this.canvas.height=a,this.ctx.drawImage(e,r,s,o,a,0,0,o,a),this.ctx.getImageData(0,0,o,a)}async blobToImageData(e){return new Promise((t,r)=>{const s=new Image;s.onload=()=>{this.canvas.width=s.width,this.canvas.height=s.height,this.ctx.drawImage(s,0,0),t(s)},s.onerror=r,s.src=URL.createObjectURL(e)})}}const Vt={GENERAL_TEXT:{detection:{det_limit_side_len:1536,det_db_thresh:.25,det_db_box_thresh:.45,det_db_unclip_ratio:1.7,det_db_min_size:3,det_db_max_candidates:2e3,grid_size:16,min_area_thresh:20},recognition:{rec_batch_num:24,drop_score:.4,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:1.5,sharpen_amount:1,denoise:!0}},INFOGRAPHIC_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.12,det_db_box_thresh:.35,det_db_unclip_ratio:2,det_db_min_size:2,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:10},recognition:{rec_batch_num:32,drop_score:.3,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.8,sharpen_amount:1.3,enhance_colors:!0,segment_regions:!0}},DOCUMENT_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.08,det_db_box_thresh:.25,det_db_unclip_ratio:1.5,det_db_min_size:2,det_db_max_candidates:5e3,grid_size:4,min_area_thresh:5},recognition:{rec_batch_num:32,drop_score:.25,rec_image_height:64,rec_image_width:640},preprocessing:{enhance_contrast:!0,contrast_factor:2,sharpen_amount:1.5,remove_background:!0,deskew:!0,fix_orientation:!0}},RECEIPT_OPTIMIZED:{detection:{det_limit_side_len:1920,det_db_thresh:.05,det_db_box_thresh:.2,det_db_unclip_ratio:1.3,det_db_min_size:1,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:3},recognition:{rec_batch_num:24,drop_score:.2,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:2.5,sharpen_amount:1.8,enhance_thermal:!0,fix_faded_text:!0,binary_threshold:!0}},PDF_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.15,det_db_box_thresh:.3,det_db_unclip_ratio:1.6,det_db_min_size:3,det_db_max_candidates:3500,grid_size:12,min_area_thresh:15},recognition:{rec_batch_num:32,drop_score:.35,rec_image_height:48,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.6,sharpen_amount:1.2,normalize_lighting:!0,remove_watermarks:!0}},ID_CARD_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.06,det_db_box_thresh:.15,det_db_unclip_ratio:1.2,det_db_min_size:1,det_db_max_candidates:3e3,grid_size:4,min_area_thresh:2},recognition:{rec_batch_num:16,drop_score:.15,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:2.2,sharpen_amount:1.6,remove_tint:!0,enhance_security_features:!1,detect_fields:!0}}};function Zt(c,e){const t=Vt[e];if(!t){console.error(`Unknown config type: ${e}`);return}Object.entries(t.detection).forEach(([r,s])=>{c.CONFIG&&c.CONFIG.hasOwnProperty(r)?c.CONFIG[r]=s:c.config&&c.config.hasOwnProperty(r)&&(c.config[r]=s)}),Object.entries(t.recognition).forEach(([r,s])=>{c.CONFIG&&c.CONFIG.hasOwnProperty(r)?c.CONFIG[r]=s:c.config&&c.config.hasOwnProperty(r)&&(c.config[r]=s)}),t.preprocessing&&c.preprocessingOptions&&Object.entries(t.preprocessing).forEach(([r,s])=>{c.preprocessingOptions.hasOwnProperty(r)&&(c.preprocessingOptions[r]=s)}),console.log(`Applied optimal ${e} configuration`)}let Z=null,re=null;async function Xt(){return Z||(Z=await qt.createWorker({logger:c=>console.log("Tesseract:",c)}),await Z.loadLanguage("eng"),await Z.initialize("eng")),Z}async function Qt(){return re||(re=new Jt,await re.init()),re}async function en(c,e){const r=await(await Xt()).recognize(c);return{text:r.data.text,boxes:r.data.words.map(s=>({text:s.text,bbox:s.bbox}))}}async function tn(c,e,t){const r=await Qt();e.preset&&e.preset!=="custom"&&Zt(r,e.preset);const s=await nn(c);let n=s;e.preprocessing==="improved"&&(n=(await new Oe().preprocess(s)).canvas||s);const i=await r.detect(n);return{text:i.text||"",boxes:i.boxes||[]}}async function nn(c){return new Promise((e,t)=>{const r=new Image,s=URL.createObjectURL(c);r.onload=()=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),URL.revokeObjectURL(s),e(n)},r.onerror=t,r.src=s})}window.OCREngine={processWithTesseract:en,processWithPaddleOCR:tn,PPOCRv5OnnxEngine:me,ocrCache:U,AdvancedOCROptions:Re};"serviceWorker"in navigator&&window.addEventListener("load",()=>{const c=window.location.hostname.includes("github.io")?"/client-ocr-app/sw.js":"/sw.js";navigator.serviceWorker.register(c).then(e=>{console.log("Service Worker registered:",e),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&se("New version available! Reload to update.","info")})})}).catch(e=>console.error("Service Worker registration failed:",e))});const F=document.getElementById("dropzone"),ze=document.getElementById("fileInput"),le=document.getElementById("fileList"),rn=document.getElementById("processBtn"),Pe=document.getElementById("progressSection"),sn=document.getElementById("progressBar"),on=document.getElementById("progressLabel"),Me=document.getElementById("resultsContainer"),De=document.getElementById("resultsList");let I=[],X=null;document.querySelectorAll(".tab").forEach(c=>{c.addEventListener("click",()=>{const e=c.dataset.tab;document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active")),c.classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.toggle("hidden",t.dataset.content!==e)})})});F.addEventListener("click",()=>ze.click());F.addEventListener("dragover",c=>{c.preventDefault(),F.classList.add("active")});F.addEventListener("dragleave",()=>{F.classList.remove("active")});F.addEventListener("drop",c=>{c.preventDefault(),F.classList.remove("active"),Ne(c.dataTransfer.files)});ze.addEventListener("change",c=>{Ne(c.target.files)});function Ne(c){I=Array.from(c),$e()}function $e(){if(I.length===0){le.classList.add("hidden");return}le.classList.remove("hidden"),le.innerHTML=I.map((c,e)=>`
                <div class="file-item">
                    <div class="file-info">
                        <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <div>
                            <div class="file-name">${c.name}</div>
                            <div class="file-size">${an(c.size)}</div>
                        </div>
                    </div>
                    <button class="button button-subtle" onclick="removeFile(${e})">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            `).join("")}window.removeFile=function(c){I.splice(c,1),$e()};function an(c){if(c===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(c)/Math.log(e));return parseFloat((c/Math.pow(e,r)).toFixed(2))+" "+t[r]}rn.addEventListener("click",async()=>{if(I.length===0){se("Please select files to process","error");return}const c=document.getElementById("engineSelect").value,e=document.getElementById("modelSelect").value,t=document.getElementById("presetSelect").value,r=document.getElementById("angleClassification").checked,s=document.getElementById("cacheResults").checked;Pe.classList.remove("hidden"),Me.style.display="none",De.innerHTML="";const n=[];for(let i=0;i<I.length;i++){const o=I[i];G(i/I.length*100,`Processing ${o.name}...`);try{let a=null;if(s){const h=await be(o);a=U.get(h,c,e)}if(!a){if(c==="tesseract")a=await window.OCREngine.processWithTesseract(o,h=>{G(i/I.length*100,h)});else if(c==="paddleocr"){const h={preset:t,preprocessing:"improved",modelVersion:e};a=await window.OCREngine.processWithPaddleOCR(o,h,l=>{G(i/I.length*100,l)})}else if(c==="ppocr-v5"){const h=t!=="custom"?Re.mergeWithPreset(t,{modelName:e,useAngleCls:r,useCache:s}):{modelName:e,useAngleCls:r,useCache:s};(!X||X.modelName!==e)&&(X=new me(h),await X.initialize(l=>{G(i/I.length*100,l)})),a=await X.process(o,l=>{G(i/I.length*100,l)})}if(s&&a){const h=await be(o);U.set(h,c,e,a)}}n.push({filename:o.name,text:(a==null?void 0:a.text)||"No text detected",boxes:(a==null?void 0:a.boxes)||[]})}catch(a){console.error("Error processing file:",a),n.push({filename:o.name,text:`Error: ${a.message}`,boxes:[]})}}G(100,"Processing complete!"),cn(n),setTimeout(()=>{Pe.classList.add("hidden")},1e3)});function G(c,e){sn.style.width=c+"%",on.textContent=e}function cn(c){Me.style.display="block",De.innerHTML=c.map((e,t)=>`
                <div class="result-item">
                    <div class="result-header">
                        <span class="result-filename">${e.filename}</span>
                        <button class="button button-subtle" onclick="copyText(${t})">
                            Copy Text
                        </button>
                    </div>
                    <div class="result-text">${e.text}</div>
                </div>
            `).join(""),window.results=c}window.copyText=function(c){const e=window.results[c].text;navigator.clipboard.writeText(e).then(()=>{se("Text copied to clipboard","success")})};function se(c,e="success"){const t=document.createElement("div");t.className=`notification notification-${e}`,t.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${e==="success"?'<polyline points="20 6 9 17 4 12"/>':'<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>'}
                </svg>
                <span>${c}</span>
            `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}async function be(c){return new Promise((e,t)=>{const r=new FileReader;r.onload=s=>e(s.target.result),r.onerror=t,r.readAsDataURL(c)})}document.getElementById("downloadAllBtn").addEventListener("click",()=>{if(!window.results||window.results.length===0)return;const c=window.results.map(s=>`=== ${s.filename} ===

${s.text}

`).join(`
`),e=new Blob([c],{type:"text/plain"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="ocr-results.txt",r.click(),URL.revokeObjectURL(t)});se("Smart OCR ready!","success");
//# sourceMappingURL=index-7Xdv9re6.js.map
