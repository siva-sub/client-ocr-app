import{c as oe,g as Ie,a as Te}from"./pdfjs-CRNIONdy.js";import{b as _e,F as ee,H as ie}from"./onnxruntime-CqRzMC93.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();var xe={exports:{}};/*! store2 - v2.14.4 - 2024-12-26
* Copyright (c) 2024 Nathan Bubna; Licensed MIT */(function(c){(function(e,t){var s={version:"2.14.4",areas:{},apis:{},nsdelim:".",inherit:function(n,r){for(var a in n)r.hasOwnProperty(a)||Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(n,a));return r},stringify:function(n,r){return n===void 0||typeof n=="function"?n+"":JSON.stringify(n,r||s.replace)},parse:function(n,r){try{return JSON.parse(n,r||s.revive)}catch{return n}},fn:function(n,r){s.storeAPI[n]=r;for(var a in s.apis)s.apis[a][n]=r},get:function(n,r){return n.getItem(r)},set:function(n,r,a){n.setItem(r,a)},remove:function(n,r){n.removeItem(r)},key:function(n,r){return n.key(r)},length:function(n){return n.length},clear:function(n){n.clear()},Store:function(n,r,a){var i=s.inherit(s.storeAPI,function(h,g,w){return arguments.length===0?i.getAll():typeof g=="function"?i.transact(h,g,w):g!==void 0?i.set(h,g,w):typeof h=="string"||typeof h=="number"?i.get(h):typeof h=="function"?i.each(h):h?i.setAll(h,g):i.clear()});i._id=n;try{var l="__store2_test";r.setItem(l,"ok"),i._area=r,r.removeItem(l)}catch{i._area=s.storage("fake")}return i._ns=a||"",s.areas[n]||(s.areas[n]=i._area),s.apis[i._ns+i._id]||(s.apis[i._ns+i._id]=i),i},storeAPI:{area:function(n,r){var a=this[n];return(!a||!a.area)&&(a=s.Store(n,r,this._ns),this[n]||(this[n]=a)),a},namespace:function(n,r,a){if(a=a||this._delim||s.nsdelim,!n)return this._ns?this._ns.substring(0,this._ns.length-a.length):"";var i=n,l=this[i];if((!l||!l.namespace)&&(l=s.Store(this._id,this._area,this._ns+i+a),l._delim=a,this[i]||(this[i]=l),!r))for(var h in s.areas)l.area(h,s.areas[h]);return l},isFake:function(n){return n?(this._real=this._area,this._area=s.storage("fake")):n===!1&&(this._area=this._real||this._area),this._area.name==="fake"},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(n){return this._area.has?this._area.has(this._in(n)):this._in(n)in this._area},size:function(){return this.keys().length},each:function(n,r){for(var a=0,i=s.length(this._area);a<i;a++){var l=this._out(s.key(this._area,a));if(l!==void 0&&n.call(this,l,this.get(l),r)===!1)break;i>s.length(this._area)&&(i--,a--)}return r||this},keys:function(n){return this.each(function(r,a,i){i.push(r)},n||[])},get:function(n,r){var a=s.get(this._area,this._in(n)),i;return typeof r=="function"&&(i=r,r=null),a!==null?s.parse(a,i):r??a},getAll:function(n){return this.each(function(r,a,i){i[r]=a},n||{})},transact:function(n,r,a){var i=this.get(n,a),l=r(i);return this.set(n,l===void 0?i:l),this},set:function(n,r,a){var i=this.get(n),l;return i!=null&&a===!1?r:(typeof a=="function"&&(l=a,a=void 0),s.set(this._area,this._in(n),s.stringify(r,l),a)||i)},setAll:function(n,r){var a,i;for(var l in n)i=n[l],this.set(l,i,r)!==i&&(a=!0);return a},add:function(n,r,a){var i=this.get(n);if(i instanceof Array)r=i.concat(r);else if(i!==null){var l=typeof i;if(l===typeof r&&l==="object"){for(var h in r)i[h]=r[h];r=i}else r=i+r}return s.set(this._area,this._in(n),s.stringify(r,a)),r},remove:function(n,r){var a=this.get(n,r);return s.remove(this._area,this._in(n)),a},clear:function(){return this._ns?this.each(function(n){s.remove(this._area,this._in(n))},1):s.clear(this._area),this},clearAll:function(){var n=this._area;for(var r in s.areas)s.areas.hasOwnProperty(r)&&(this._area=s.areas[r],this.clear());return this._area=n,this},_in:function(n){return typeof n!="string"&&(n=s.stringify(n)),this._ns?this._ns+n:n},_out:function(n){return this._ns?n&&n.indexOf(this._ns)===0?n.substring(this._ns.length):void 0:n}},storage:function(n){return s.inherit(s.storageAPI,{items:{},name:n})},storageAPI:{length:0,has:function(n){return this.items.hasOwnProperty(n)},key:function(n){var r=0;for(var a in this.items)if(this.has(a)&&n===r++)return a},setItem:function(n,r){this.has(n)||this.length++,this.items[n]=r},removeItem:function(n){this.has(n)&&(delete this.items[n],this.length--)},getItem:function(n){return this.has(n)?this.items[n]:null},clear:function(){for(var n in this.items)this.removeItem(n)}}},o=s.Store("local",function(){try{return localStorage}catch{}}());o.local=o,o._=s,o.area("session",function(){try{return sessionStorage}catch{}}()),o.area("page",s.storage("page")),typeof t=="function"&&t.amd!==void 0?t("store2",[],function(){return o}):c.exports?c.exports=o:(e.store&&(s.conflict=e.store),e.store=o)})(oe,oe&&oe.define)})(xe);var ze=xe.exports;const Me=Ie(ze);class Ae{constructor(e={}){this.namespace=e.namespace||"ocr-cache",this.maxCacheSize=e.maxCacheSize||50*1024*1024,this.maxAge=e.maxAge||7*24*60*60*1e3,this.store=Me.namespace(this.namespace),this.store.get("metadata")||this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}}),this.cleanupOldEntries()}generateCacheKey(e,t,s){const n=`${typeof e=="string"?e:JSON.stringify(e)}-${t}-${s}`;let r=0;for(let a=0;a<n.length;a++){const i=n.charCodeAt(a);r=(r<<5)-r+i,r=r&r}return`ocr-${Math.abs(r).toString(36)}`}get(e,t,s){const o=this.generateCacheKey(e,t,s),n=this.store.get(o);return n?Date.now()-n.timestamp>this.maxAge?(this.remove(o),null):(n.lastAccessed=Date.now(),this.store.set(o,n),n.data):null}set(e,t,s,o){const n=this.generateCacheKey(e,t,s),r=JSON.stringify(o),a=new Blob([r]).size;this.ensureCacheSpace(a);const i={timestamp:Date.now(),lastAccessed:Date.now(),engineType:t,modelVersion:s,size:a,data:o},l=this.store.get("metadata");return l.totalSize+=a,l.entries[n]={size:a,timestamp:i.timestamp},this.store.set("metadata",l),this.store.set(n,i),n}remove(e){if(this.store.get(e)){const s=this.store.get("metadata");s.entries[e]&&(s.totalSize-=s.entries[e].size,delete s.entries[e],this.store.set("metadata",s)),this.store.remove(e)}}clear(){this.store.keys().forEach(t=>{t!=="metadata"&&this.store.remove(t)}),this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}})}getStats(){const e=this.store.get("metadata"),t=Object.keys(e.entries).length;return{totalSize:e.totalSize,maxSize:this.maxCacheSize,usagePercent:e.totalSize/this.maxCacheSize*100,entries:t,oldestEntry:this.getOldestEntry(),newestEntry:this.getNewestEntry()}}cleanupOldEntries(){const e=Date.now(),t=this.store.get("metadata"),s=[];Object.entries(t.entries).forEach(([o,n])=>{e-n.timestamp>this.maxAge&&s.push(o)}),s.forEach(o=>this.remove(o))}ensureCacheSpace(e){const t=this.store.get("metadata");if(t.totalSize+e<=this.maxCacheSize)return;const s=Object.entries(t.entries).sort((n,r)=>n[1].timestamp-r[1].timestamp);let o=t.totalSize;for(const[n]of s){if(o+e<=this.maxCacheSize)break;const r=this.store.get(n);r&&(o-=r.size,this.remove(n))}}getOldestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([s,o])=>{(!t||o.timestamp<t.timestamp)&&(t={key:s,...o})}),t}getNewestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([s,o])=>{(!t||o.timestamp>t.timestamp)&&(t={key:s,...o})}),t}export(){const e={metadata:this.store.get("metadata"),entries:{}};return this.store.keys().forEach(t=>{t!=="metadata"&&(e.entries[t]=this.store.get(t))}),e}import(e){if(!e||!e.metadata)throw new Error("Invalid cache data format");this.clear(),this.store.set("metadata",e.metadata),Object.entries(e.entries).forEach(([t,s])=>{this.store.set(t,s)})}}const H=new Ae;class de{static async resizeImage(e,t,s){const o=document.createElement("canvas"),n=o.getContext("2d"),r=new Image,a=new Blob([e],{type:"image/png"}),i=URL.createObjectURL(a);return new Promise((l,h)=>{r.onload=()=>{o.width=t,o.height=s,n.drawImage(r,0,0,t,s);const g=n.getImageData(0,0,t,s);URL.revokeObjectURL(i),l(g)},r.onerror=h,r.src=i})}static canvasToImageData(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}static normalizeImageData(e,t=[.485,.456,.406],s=[.229,.224,.225]){const o=e.data,n=new Float32Array(o.length);for(let r=0;r<o.length;r+=4)n[r]=(o[r]/255-t[0])/s[0],n[r+1]=(o[r+1]/255-t[1])/s[1],n[r+2]=(o[r+2]/255-t[2])/s[2],n[r+3]=o[r+3]/255;return n}static hwcToChw(e,t,s){const n=new Float32Array(3*s*t),r=e.data||e;let a=0;for(let i=0;i<3;i++)for(let l=0;l<s;l++)for(let h=0;h<t;h++)n[a++]=r[(l*t+h)*4+i];return n}}class De{constructor(e={}){this.limitSideLen=e.det_limit_side_len||960,this.limitType=e.det_limit_type||"min",this.mean=e.mean||[.485,.456,.406],this.std=e.std||[.229,.224,.225],this.scale=e.scale||1/255}async preprocess(e){const t=e.width,s=e.height,{targetWidth:o,targetHeight:n}=this.calculateResizeDimensions(t,s),r=document.createElement("canvas");r.width=o,r.height=n;const a=r.getContext("2d");a.drawImage(e,0,0,o,n);const i=a.getImageData(0,0,o,n),l=this.normalizeImage(i);return{tensor:de.hwcToChw(l,o,n),originalShape:[s,t],resizedShape:[n,o],ratio:[n/s,o/t]}}calculateResizeDimensions(e,t){let s=1;this.limitType==="max"?Math.max(t,e)>this.limitSideLen&&(s=this.limitSideLen/Math.max(t,e)):this.limitType==="min"&&Math.min(t,e)<this.limitSideLen&&(s=this.limitSideLen/Math.min(t,e));let o=Math.round(t*s),n=Math.round(e*s);return o=Math.max(Math.round(o/32)*32,32),n=Math.max(Math.round(n/32)*32,32),{targetWidth:n,targetHeight:o}}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let o=0;for(let n=0;n<t.length;n+=4)s[o++]=(t[n]*this.scale-this.mean[0])/this.std[0],s[o++]=(t[n+1]*this.scale-this.mean[1])/this.std[1],s[o++]=(t[n+2]*this.scale-this.mean[2])/this.std[2];return s}}class Be{constructor(e={}){this.imageShape=e.cls_image_shape||[3,48,192]}async preprocess(e){const[t,s,o]=this.imageShape,n=e.width,r=e.height,a=n/r;let i=Math.ceil(s*a);i>o&&(i=o);const l=document.createElement("canvas");l.width=i,l.height=s,l.getContext("2d").drawImage(e,0,0,i,s);const g=document.createElement("canvas");g.width=o,g.height=s;const w=g.getContext("2d");w.fillStyle="black",w.fillRect(0,0,o,s),w.drawImage(l,0,0);const v=w.getImageData(0,0,o,s),_=this.normalizeImage(v);return de.hwcToChw(_,o,s)}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let o=0;for(let n=0;n<t.length;n+=4)s[o++]=(t[n]/255-.5)/.5,s[o++]=(t[n+1]/255-.5)/.5,s[o++]=(t[n+2]/255-.5)/.5;return s}}class $e{constructor(e={}){this.imageShape=e.rec_image_shape||[3,48,320],this.recAlgorithm=e.rec_algorithm||"SVTR_LCNet"}async preprocess(e,t=null){const[s,o,n]=this.imageShape,r=e.width,a=e.height;t||(t=r/a);let i=Math.round(o*t);this.recAlgorithm==="NRTR"||this.recAlgorithm==="ViTSTR"?i=n:i=Math.min(i,n);const l=r/a;let h=Math.ceil(o*l);h>i&&(h=i);const g=document.createElement("canvas");g.width=h,g.height=o,g.getContext("2d").drawImage(e,0,0,h,o);const v=document.createElement("canvas");v.width=i,v.height=o;const _=v.getContext("2d");_.fillStyle="black",_.fillRect(0,0,i,o),_.drawImage(g,0,0);const P=_.getImageData(0,0,i,o),R=this.normalizeImage(P);return{tensor:de.hwcToChw(R,i,o),shape:[1,s,o,i]}}normalizeImage(e){const t=e.data,s=new Float32Array(t.length/4*3);let o=0;for(let n=0;n<t.length;n+=4)s[o++]=(t[n]/255-.5)/.5,s[o++]=(t[n+1]/255-.5)/.5,s[o++]=(t[n+2]/255-.5)/.5;return s}}class je{static extractRegion(e,t){const s=this.sortPoints(t),o=Math.max(this.distance(s[0],s[1]),this.distance(s[3],s[2])),n=Math.max(this.distance(s[0],s[3]),this.distance(s[1],s[2])),r=document.createElement("canvas");r.width=Math.round(o),r.height=Math.round(n);const a=r.getContext("2d"),i=s,l=[[0,0],[o,0],[o,n],[0,n]];a.save();const h=document.createElement("canvas");h.width=e.width,h.height=e.height,h.getContext("2d").drawImage(e,0,0),a.beginPath(),a.moveTo(0,0),a.lineTo(o,0),a.lineTo(o,n),a.lineTo(0,n),a.closePath(),a.clip();const w=this.getPerspectiveTransform(i,l,o,n);if(a.setTransform(w.a,w.b,w.c,w.d,w.e,w.f),a.drawImage(e,0,0),a.restore(),n>o*1.5){const v=document.createElement("canvas");v.width=r.height,v.height=r.width;const _=v.getContext("2d");return _.translate(v.width/2,v.height/2),_.rotate(Math.PI/2),_.drawImage(r,-r.width/2,-r.height/2),v}return r}static sortPoints(e){const t=e.reduce((a,i)=>[a[0]+i[0]/e.length,a[1]+i[1]/e.length],[0,0]),s=e.slice().sort((a,i)=>{const l=Math.atan2(a[1]-t[1],a[0]-t[0]),h=Math.atan2(i[1]-t[1],i[0]-t[0]);return l-h});let o=0,n=s[0][0]+s[0][1];for(let a=1;a<s.length;a++){const i=s[a][0]+s[a][1];i<n&&(n=i,o=a)}const r=[];for(let a=0;a<s.length;a++)r.push(s[(o+a)%s.length]);return r}static distance(e,t){const s=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(s*s+o*o)}static getPerspectiveTransform(e,t,s,o){const n=s/(e[1][0]-e[0][0]),r=o/(e[3][1]-e[0][1]);return{a:n,b:0,c:0,d:r,e:-e[0][0]*n,f:-e[0][1]*r}}}class Ne{constructor(e={}){this.thresh=e.thresh||.3,this.boxThresh=e.box_thresh||.6,this.maxCandidates=e.max_candidates||1e3,this.unclipRatio=e.unclip_ratio||1.5,this.minSize=e.min_size||3,this.scoreMode=e.score_mode||"fast"}process(e,t){const s=e[0],o=t[0],n=this.threshold(s),r=this.findContours(n),a=[],i=[];for(const l of r){if(l.length<4)continue;const h=this.getMinAreaRect(l);if(!h)continue;const g=this.boxScore(s,h);if(g<this.boxThresh)continue;const w=this.unclip(h);if(!w)continue;const v=this.rescaleBox(w,o);this.validateBox(v)&&(a.push(v),i.push(g))}return{boxes:a,scores:i}}threshold(e){const t=e.length,s=e[0].length,o=[];for(let n=0;n<t;n++){o[n]=[];for(let r=0;r<s;r++)o[n][r]=e[n][r]>this.thresh?1:0}return o}findContours(e){const t=e.length,s=e[0].length,o=Array(t).fill(null).map(()=>Array(s).fill(!1)),n=[];for(let r=0;r<t;r++)for(let a=0;a<s;a++)if(e[r][a]===1&&!o[r][a]){const i=this.traceContour(e,o,r,a);i.length>=4&&n.push(i)}return n}traceContour(e,t,s,o){const n=e.length,r=e[0].length,a=[],i=[[s,o]],l=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(;i.length>0;){const[h,g]=i.shift();if(t[h][g])continue;t[h][g]=!0;let w=!1;for(const[v,_]of l){const P=h+v,R=g+_;if(P<0||P>=n||R<0||R>=r||e[P][R]===0){w=!0;break}}w&&a.push([g,h]);for(const[v,_]of l){const P=h+v,R=g+_;P>=0&&P<n&&R>=0&&R<r&&e[P][R]===1&&!t[P][R]&&i.push([P,R])}}return a}getMinAreaRect(e){if(e.length<4)return null;const t=this.convexHull(e);if(t.length<4)return null;let s=1/0,o=null;for(let n=0;n<t.length;n++){const r=t[n],a=t[(n+1)%t.length],i=[a[0]-r[0],a[1]-r[1]],l=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(l===0)continue;i[0]/=l,i[1]/=l;let h=1/0,g=-1/0,w=1/0,v=-1/0;for(const I of t){const O=(I[0]-r[0])*i[0]+(I[1]-r[1])*i[1],z=(I[0]-r[0])*-i[1]+(I[1]-r[1])*i[0];h=Math.min(h,O),g=Math.max(g,O),w=Math.min(w,z),v=Math.max(v,z)}const _=g-h,P=v-w,R=_*P;if(R<s){s=R;const I=[r[0]+h*i[0]+w*-i[1],r[1]+h*i[1]+w*i[0]],O=[r[0]+g*i[0]+w*-i[1],r[1]+g*i[1]+w*i[0]],z=[r[0]+g*i[0]+v*-i[1],r[1]+g*i[1]+v*i[0]],A=[r[0]+h*i[0]+v*-i[1],r[1]+h*i[1]+v*i[0]];o=[I,O,z,A]}}return o}convexHull(e){if(e.length<3)return e;let t=0;for(let r=1;r<e.length;r++)(e[r][1]<e[t][1]||e[r][1]===e[t][1]&&e[r][0]<e[t][0])&&(t=r);const s=e.slice(),o=s.splice(t,1)[0];s.sort((r,a)=>{const i=Math.atan2(r[1]-o[1],r[0]-o[0]),l=Math.atan2(a[1]-o[1],a[0]-o[0]);if(i!==l)return i-l;const h=(r[0]-o[0])*(r[0]-o[0])+(r[1]-o[1])*(r[1]-o[1]),g=(a[0]-o[0])*(a[0]-o[0])+(a[1]-o[1])*(a[1]-o[1]);return h-g});const n=[o];for(const r of s){for(;n.length>=2;){const a=n[n.length-2],i=n[n.length-1];if((i[0]-a[0])*(r[1]-a[1])-(i[1]-a[1])*(r[0]-a[0])<=0)n.pop();else break}n.push(r)}return n}boxScore(e,t){const s=Math.min(...t.map(l=>l[0])),o=Math.max(...t.map(l=>l[0])),n=Math.min(...t.map(l=>l[1])),r=Math.max(...t.map(l=>l[1]));let a=0,i=0;for(let l=Math.floor(n);l<=Math.ceil(r);l++)for(let h=Math.floor(s);h<=Math.ceil(o);h++)l>=0&&l<e.length&&h>=0&&h<e[0].length&&this.pointInPolygon([h,l],t)&&(a+=e[l][h],i++);return i>0?a/i:0}pointInPolygon(e,t){let s=!1;const o=e[0],n=e[1];for(let r=0,a=t.length-1;r<t.length;a=r++){const i=t[r][0],l=t[r][1],h=t[a][0],g=t[a][1];l>n!=g>n&&o<(h-i)*(n-l)/(g-l)+i&&(s=!s)}return s}unclip(e){let t=0;for(let r=0;r<e.length;r++){const a=(r+1)%e.length,i=e[a][0]-e[r][0],l=e[a][1]-e[r][1];t+=Math.sqrt(i*i+l*l)}let s=0;for(let r=0;r<e.length;r++){const a=(r+1)%e.length;s+=e[r][0]*e[a][1]-e[a][0]*e[r][1]}s=Math.abs(s)/2;const o=s*this.unclipRatio/t,n=[];for(let r=0;r<e.length;r++){const a=e[(r-1+e.length)%e.length],i=e[r],l=e[(r+1)%e.length],h=[a[0]-i[0],a[1]-i[1]],g=[l[0]-i[0],l[1]-i[1]],w=Math.sqrt(h[0]*h[0]+h[1]*h[1]),v=Math.sqrt(g[0]*g[0]+g[1]*g[1]);w>0&&(h[0]/=w,h[1]/=w),v>0&&(g[0]/=v,g[1]/=v);const _=[h[0]+g[0],h[1]+g[1]],P=Math.sqrt(_[0]*_[0]+_[1]*_[1]);P>0?(_[0]/=P,_[1]/=P,n.push([i[0]-_[0]*o,i[1]-_[1]*o])):n.push(i)}return n}rescaleBox(e,t){const[s,o,n,r]=t;return e.map(a=>[a[0]/r,a[1]/n])}validateBox(e){const t=Math.max(this.distance(e[0],e[1]),this.distance(e[2],e[3])),s=Math.max(this.distance(e[0],e[3]),this.distance(e[1],e[2]));return t>=this.minSize&&s>=this.minSize}distance(e,t){const s=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(s*s+o*o)}}class Fe{constructor(e={}){this.labelList=e.label_list||["0","180"],this.clsThresh=e.cls_thresh||.9}process(e){const t=[],s=e[0];for(let o=0;o<s.length;o++){const n=s[o],r=n.indexOf(Math.max(...n)),a=n[r],i=this.labelList[r];t.push({label:i,score:a,shouldRotate:i==="180"&&a>this.clsThresh})}return t}}class We{constructor(e){this.characterDict=e,this.blankIdx=e.length}decode(e,t="greedy"){if(t==="greedy")return this.greedyDecode(e);if(t==="beam_search")return this.beamSearchDecode(e);throw new Error(`Unknown decode method: ${t}`)}greedyDecode(e){const t=[];for(const s of e){const o=[];let n=-1;for(let i=0;i<s.length;i++){const l=s[i].indexOf(Math.max(...s[i]));l!==this.blankIdx&&l!==n&&o.push(l),n=l}const r=o.map(i=>this.characterDict[i]).join(""),a=this.calculateConfidence(s,o);t.push({text:r,confidence:a})}return t}beamSearchDecode(e,t=5){const s=[];for(const o of e){const r=this.beamSearch(o,t)[0];s.push({text:r.text,confidence:r.score})}return s}beamSearch(e,t){let s=[{text:"",score:1,lastIdx:-1}];for(let o=0;o<e.length;o++){const n=[];for(const r of s){const a=e[o],i=this.getTopK(a,t);for(const[l,h]of i)l===this.blankIdx?n.push({text:r.text,score:r.score*h,lastIdx:l}):l!==r.lastIdx?n.push({text:r.text+this.characterDict[l],score:r.score*h,lastIdx:l}):n.push({text:r.text,score:r.score*h,lastIdx:l})}n.sort((r,a)=>a.score-r.score),s=n.slice(0,t)}return s}getTopK(e,t){const s=e.map((o,n)=>[n,o]);return s.sort((o,n)=>n[1]-o[1]),s.slice(0,t)}calculateConfidence(e,t){if(t.length===0)return 0;let s=0,o=0;for(const n of t)for(;o<e.length;){if(e[o].indexOf(Math.max(...e[o]))===n){s+=e[o][n],o++;break}o++}return s/t.length}}function Ue(c){if(!c||c.length===0)return[];const e=c.map((t,s)=>{const o=t.reduce((r,a)=>r+a[0],0)/t.length,n=t.reduce((r,a)=>r+a[1],0)/t.length;return{box:t,index:s,centerX:o,centerY:n}});return e.sort((t,s)=>Math.abs(t.centerY-s.centerY)<10?t.centerX-s.centerX:t.centerY-s.centerY),e.map(t=>t.box)}const ke=window.location.hostname.includes("github.io"),le=ke?"/client-ocr-app":"",Ge=`${le}/assets/`;_e.wasm.wasmPaths=Ge;_e.wasm.numThreads=1;class Pe{constructor(e={}){this.modelName=e.modelName||"PP-OCRv5",this.useAngleCls=e.useAngleCls!==!1,this.useCache=e.useCache!==!1;const t=`${le}/models/`;this.modelPaths={"PP-OCRv5":{det:t+"PP-OCRv5/det/det.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5/rec/rec.onnx",dict:t+"PP-OCRv5/ppocrv5_dict.txt"},"PP-OCRv5_mobile":{det:t+"PP-OCRv5_mobile_det_infer.onnx",cls:t+"PP-OCRv5/cls/cls.onnx",rec:t+"PP-OCRv5_mobile_rec_infer.onnx",dict:t+"ppocrv5_dict.txt"},"PP-OCRv4":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"PP-OCRv4/rec/rec.onnx",dict:t+"PP-OCRv4/ppocr_keys_v1.txt"},"PP-OCRv4_mobile":{det:t+"PP-OCRv4/det/det.onnx",cls:t+"PP-OCRv4/cls/cls.onnx",rec:t+"en_PP-OCRv4_mobile_rec_infer.onnx",dict:t+"en_dict.txt"},"ch_ppocr_server_v2.0":{det:t+"ch_ppocr_server_v2.0/det/det.onnx",cls:t+"ch_ppocr_server_v2.0/cls/cls.onnx",rec:null,dict:t+"ch_ppocr_server_v2.0/ppocr_keys_v1.txt"}},this.detParams={det_limit_side_len:e.detLimitSideLen||960,det_limit_type:e.detLimitType||"min",det_db_thresh:e.detDbThresh||.3,det_db_box_thresh:e.detDbBoxThresh||.6,det_db_unclip_ratio:e.detDbUnclipRatio||1.7,det_db_score_mode:e.detDbScoreMode||"fast"},this.clsParams={cls_image_shape:[3,48,192],cls_thresh:e.clsThresh||.9,label_list:["0","180"]},this.recParams={rec_image_shape:[3,48,320],rec_algorithm:"SVTR_LCNet"},this.detPreprocessor=new De(this.detParams),this.clsPreprocessor=new Be(this.clsParams),this.recPreprocessor=new $e(this.recParams),this.detPostprocessor=new Ne({thresh:this.detParams.det_db_thresh,box_thresh:this.detParams.det_db_box_thresh,unclip_ratio:this.detParams.det_db_unclip_ratio,score_mode:this.detParams.det_db_score_mode}),this.clsPostprocessor=new Fe(this.clsParams),this.detSession=null,this.clsSession=null,this.recSession=null,this.characterDict=null,this.ctcDecoder=null,this.initialized=!1}async initialize(e=null){if(!this.initialized)try{const t=this.modelPaths[this.modelName];if(!t)throw new Error(`Unknown model: ${this.modelName}`);if(e==null||e("Loading character dictionary..."),await this.loadCharacterDict(t.dict),e==null||e("Loading detection model..."),this.detSession=await ee.create(t.det,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),this.useAngleCls&&(e==null||e("Loading angle classification model..."),this.clsSession=await ee.create(t.cls,{executionProviders:["wasm"],graphOptimizationLevel:"all"})),t.rec)e==null||e("Loading recognition model..."),this.recSession=await ee.create(t.rec,{executionProviders:["wasm"],graphOptimizationLevel:"all"});else if(this.modelName==="ch_ppocr_server_v2.0"){const s=`${le}/models/PP-OCRv4/rec/rec.onnx`;e==null||e("Loading recognition model (fallback)..."),this.recSession=await ee.create(s,{executionProviders:["wasm"],graphOptimizationLevel:"all"})}this.initialized=!0,e==null||e("Initialization complete!")}catch(t){throw console.error("Failed to initialize PP-OCRv5 ONNX engine:",t),t}}async loadCharacterDict(e){try{const s=await(await fetch(e)).text();this.characterDict=s.split(`
`).filter(o=>o.length>0),this.ctcDecoder=new We(this.characterDict)}catch(t){throw console.error("Failed to load character dictionary:",t),t}}async process(e,t=null){if(this.initialized||await this.initialize(t),this.useCache){const l=await this.checkCache(e);if(l)return t==null||t("Using cached result"),l}const s=await this.inputToCanvas(e);t==null||t("Detecting text regions...");const o=await this.detectText(s);if(!o||o.boxes.length===0)return{text:"",boxes:[],lines:[]};const n=Ue(o.boxes),r=[];for(let l=0;l<n.length;l++){t==null||t(`Processing region ${l+1}/${n.length}...`);const h=n[l],g=je.extractRegion(s,h);let w=0;if(this.useAngleCls&&this.clsSession&&(await this.classifyAngle(g)).shouldRotate){const P=this.rotateCanvas(g,180);g.width=P.width,g.height=P.height,g.getContext("2d").drawImage(P,0,0),w=180}const v=await this.recognizeText(g);r.push({box:h,text:v.text,confidence:v.confidence,angle:w})}const i={text:r.map(l=>l.text).join(`
`),boxes:n,lines:r,modelName:this.modelName};return this.useCache&&await this.cacheResult(e,i),i}async detectText(e){const t=await this.detPreprocessor.preprocess(e),o={x:new ie("float32",t.tensor,[1,3,t.resizedShape[0],t.resizedShape[1]])},n=await this.detSession.run(o),r=n.sigmoid_0||n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],a=r.data,[,,i,l]=r.dims,h=[];for(let w=0;w<i;w++){h[w]=[];for(let v=0;v<l;v++)h[w][v]=a[w*l+v]}return this.detPostprocessor.process([h],[t.originalShape.concat(t.ratio)])}async classifyAngle(e){const t=await this.clsPreprocessor.preprocess(e),o={x:new ie("float32",t,[1,...this.clsParams.cls_image_shape])},n=await this.clsSession.run(o),r=n.save_infer_model_scale_0_tmp_1||Object.values(n)[0],a=Array.from(r.data);return this.clsPostprocessor.process([a])[0]}async recognizeText(e){if(!this.recSession)return{text:"",confidence:0};const t=e.width/e.height,s=await this.recPreprocessor.preprocess(e,t),n={x:new ie("float32",s.tensor,s.shape)},r=await this.recSession.run(n),a=r.save_infer_model_scale_0_tmp_1||Object.values(r)[0],[,i,l]=a.dims,h=a.data,g=[];for(let v=0;v<i;v++){const _=[];for(let P=0;P<l;P++)_.push(h[v*l+P]);g.push(_)}return this.ctcDecoder.decode([g],"greedy")[0]}async inputToCanvas(e){if(e instanceof HTMLCanvasElement)return e;const t=document.createElement("canvas"),s=t.getContext("2d");if(e instanceof File||e instanceof Blob){const o=new Image,n=URL.createObjectURL(e);return new Promise((r,a)=>{o.onload=()=>{t.width=o.width,t.height=o.height,s.drawImage(o,0,0),URL.revokeObjectURL(n),r(t)},o.onerror=a,o.src=n})}else if(typeof e=="string"){const o=new Image;return o.crossOrigin="anonymous",new Promise((n,r)=>{o.onload=()=>{t.width=o.width,t.height=o.height,s.drawImage(o,0,0),n(t)},o.onerror=r,o.src=e})}throw new Error("Unsupported input type")}rotateCanvas(e,t){const s=t*Math.PI/180,o=document.createElement("canvas"),n=o.getContext("2d");return t===180?(o.width=e.width,o.height=e.height,n.translate(e.width,e.height),n.rotate(s),n.drawImage(e,0,0)):t===90||t===-270?(o.width=e.height,o.height=e.width,n.translate(e.height,0),n.rotate(s),n.drawImage(e,0,0)):(t===-90||t===270)&&(o.width=e.height,o.height=e.width,n.translate(0,e.width),n.rotate(s),n.drawImage(e,0,0)),o}async checkCache(e){if(!this.useCache)return null;const t=await this.generateCacheKey(e);return H.get(t,"ppocr-v5-onnx",this.modelName)}async cacheResult(e,t){if(!this.useCache)return;const s=await this.generateCacheKey(e);H.set(s,"ppocr-v5-onnx",this.modelName,t)}async generateCacheKey(e){return e instanceof File?await this.fileToBase64(e):typeof e=="string"?e:e instanceof HTMLCanvasElement?e.toDataURL():JSON.stringify(e)}async fileToBase64(e){return new Promise((t,s)=>{const o=new FileReader;o.onload=n=>t(n.target.result),o.onerror=s,o.readAsDataURL(e)})}getCacheStats(){return H.getStats()}clearCache(){H.clear()}}new Pe;class He{static getPresets(){return{high_accuracy:{detLimitSideLen:1920,detDbThresh:.2,detDbBoxThresh:.5,detDbUnclipRatio:2,dropScore:.3,useAngleCls:!0},fast_processing:{detLimitSideLen:640,detDbThresh:.4,detDbBoxThresh:.7,detDbUnclipRatio:1.5,dropScore:.6,useAngleCls:!1},balanced:{detLimitSideLen:960,detDbThresh:.3,detDbBoxThresh:.6,detDbUnclipRatio:1.7,dropScore:.5,useAngleCls:!0},handwritten:{detLimitSideLen:1280,detDbThresh:.15,detDbBoxThresh:.4,detDbUnclipRatio:2.5,dropScore:.3,useAngleCls:!0},low_quality:{detLimitSideLen:1440,detDbThresh:.1,detDbBoxThresh:.3,detDbUnclipRatio:3,dropScore:.2,useAngleCls:!0}}}static mergeWithPreset(e,t={}){const s=this.getPresets();return{...s[e]||s.balanced,...t}}}var qe={exports:{}};(function(c){var e=function(t){var s=Object.prototype,o=s.hasOwnProperty,n=Object.defineProperty||function(f,d,m){f[d]=m.value},r,a=typeof Symbol=="function"?Symbol:{},i=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function g(f,d,m){return Object.defineProperty(f,d,{value:m,enumerable:!0,configurable:!0,writable:!0}),f[d]}try{g({},"")}catch{g=function(d,m,y){return d[m]=y}}function w(f,d,m,y){var u=d&&d.prototype instanceof z?d:z,p=Object.create(u.prototype),x=new J(y||[]);return n(p,"_invoke",{value:re(f,m,x)}),p}t.wrap=w;function v(f,d,m){try{return{type:"normal",arg:f.call(d,m)}}catch(y){return{type:"throw",arg:y}}}var _="suspendedStart",P="suspendedYield",R="executing",I="completed",O={};function z(){}function A(){}function b(){}var q={};g(q,i,function(){return this});var Y=Object.getPrototypeOf,U=Y&&Y(Y(V([])));U&&U!==s&&o.call(U,i)&&(q=U);var $=b.prototype=z.prototype=Object.create(q);A.prototype=b,n($,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:A,configurable:!0}),A.displayName=g(b,h,"GeneratorFunction");function Z(f){["next","throw","return"].forEach(function(d){g(f,d,function(m){return this._invoke(d,m)})})}t.isGeneratorFunction=function(f){var d=typeof f=="function"&&f.constructor;return d?d===A||(d.displayName||d.name)==="GeneratorFunction":!1},t.mark=function(f){return Object.setPrototypeOf?Object.setPrototypeOf(f,b):(f.__proto__=b,g(f,h,"GeneratorFunction")),f.prototype=Object.create($),f},t.awrap=function(f){return{__await:f}};function k(f,d){function m(p,x,S,L){var C=v(f[p],f,x);if(C.type==="throw")L(C.arg);else{var j=C.arg,D=j.value;return D&&typeof D=="object"&&o.call(D,"__await")?d.resolve(D.__await).then(function(B){m("next",B,S,L)},function(B){m("throw",B,S,L)}):d.resolve(D).then(function(B){j.value=B,S(j)},function(B){return m("throw",B,S,L)})}}var y;function u(p,x){function S(){return new d(function(L,C){m(p,x,L,C)})}return y=y?y.then(S,S):S()}n(this,"_invoke",{value:u})}Z(k.prototype),g(k.prototype,l,function(){return this}),t.AsyncIterator=k,t.async=function(f,d,m,y,u){u===void 0&&(u=Promise);var p=new k(w(f,d,m,y),u);return t.isGeneratorFunction(d)?p:p.next().then(function(x){return x.done?x.value:p.next()})};function re(f,d,m){var y=_;return function(p,x){if(y===R)throw new Error("Generator is already running");if(y===I){if(p==="throw")throw x;return Q()}for(m.method=p,m.arg=x;;){var S=m.delegate;if(S){var L=K(S,m);if(L){if(L===O)continue;return L}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(y===_)throw y=I,m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);y=R;var C=v(f,d,m);if(C.type==="normal"){if(y=m.done?I:P,C.arg===O)continue;return{value:C.arg,done:m.done}}else C.type==="throw"&&(y=I,m.method="throw",m.arg=C.arg)}}}function K(f,d){var m=d.method,y=f.iterator[m];if(y===r)return d.delegate=null,m==="throw"&&f.iterator.return&&(d.method="return",d.arg=r,K(f,d),d.method==="throw")||m!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+m+"' method")),O;var u=v(y,f.iterator,d.arg);if(u.type==="throw")return d.method="throw",d.arg=u.arg,d.delegate=null,O;var p=u.arg;if(!p)return d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,O;if(p.done)d[f.resultName]=p.value,d.next=f.nextLoc,d.method!=="return"&&(d.method="next",d.arg=r);else return p;return d.delegate=null,O}Z($),g($,h,"Generator"),g($,i,function(){return this}),g($,"toString",function(){return"[object Generator]"});function se(f){var d={tryLoc:f[0]};1 in f&&(d.catchLoc=f[1]),2 in f&&(d.finallyLoc=f[2],d.afterLoc=f[3]),this.tryEntries.push(d)}function N(f){var d=f.completion||{};d.type="normal",delete d.arg,f.completion=d}function J(f){this.tryEntries=[{tryLoc:"root"}],f.forEach(se,this),this.reset(!0)}t.keys=function(f){var d=Object(f),m=[];for(var y in d)m.push(y);return m.reverse(),function u(){for(;m.length;){var p=m.pop();if(p in d)return u.value=p,u.done=!1,u}return u.done=!0,u}};function V(f){if(f){var d=f[i];if(d)return d.call(f);if(typeof f.next=="function")return f;if(!isNaN(f.length)){var m=-1,y=function u(){for(;++m<f.length;)if(o.call(f,m))return u.value=f[m],u.done=!1,u;return u.value=r,u.done=!0,u};return y.next=y}}return{next:Q}}t.values=V;function Q(){return{value:r,done:!0}}return J.prototype={constructor:J,reset:function(f){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(N),!f)for(var d in this)d.charAt(0)==="t"&&o.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=r)},stop:function(){this.done=!0;var f=this.tryEntries[0],d=f.completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(f){if(this.done)throw f;var d=this;function m(L,C){return p.type="throw",p.arg=f,d.next=L,C&&(d.method="next",d.arg=r),!!C}for(var y=this.tryEntries.length-1;y>=0;--y){var u=this.tryEntries[y],p=u.completion;if(u.tryLoc==="root")return m("end");if(u.tryLoc<=this.prev){var x=o.call(u,"catchLoc"),S=o.call(u,"finallyLoc");if(x&&S){if(this.prev<u.catchLoc)return m(u.catchLoc,!0);if(this.prev<u.finallyLoc)return m(u.finallyLoc)}else if(x){if(this.prev<u.catchLoc)return m(u.catchLoc,!0)}else if(S){if(this.prev<u.finallyLoc)return m(u.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(f,d){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc<=this.prev&&o.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var u=y;break}}u&&(f==="break"||f==="continue")&&u.tryLoc<=d&&d<=u.finallyLoc&&(u=null);var p=u?u.completion:{};return p.type=f,p.arg=d,u?(this.method="next",this.next=u.finallyLoc,O):this.complete(p)},complete:function(f,d){if(f.type==="throw")throw f.arg;return f.type==="break"||f.type==="continue"?this.next=f.arg:f.type==="return"?(this.rval=this.arg=f.arg,this.method="return",this.next="end"):f.type==="normal"&&d&&(this.next=d),O},finish:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.finallyLoc===f)return this.complete(m.completion,m.afterLoc),N(m),O}},catch:function(f){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc===f){var y=m.completion;if(y.type==="throw"){var u=y.arg;N(m)}return u}}throw new Error("illegal catch attempt")},delegateYield:function(f,d,m){return this.delegate={iterator:V(f),resultName:d,nextLoc:m},this.method==="next"&&(this.arg=r),O}},t}(c.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(qe);var Se=(c,e)=>`${c}-${e}-${Math.random().toString(16).slice(3,8)}`;const Ye=Se;let fe=0;var Ke=({id:c,action:e,payload:t={}})=>{let s=c;return typeof s>"u"&&(s=Ye("Job",fe),fe+=1),{id:s,action:e,payload:t}},te={};let ue=!1;te.logging=ue;te.setLogging=c=>{ue=c};te.log=(...c)=>ue?console.log.apply(void 0,c):null;function Je(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var Ve=Je;const Xe=Ve;var Ze=c=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":Xe()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof Te=="function"&&(e.type="node"),typeof c>"u"?e:e[c]};const Qe=Ze("type")==="browser",et=Qe?c=>new URL(c,window.location.href).href:c=>c;var tt=c=>{const e={...c};return["corePath","workerPath","langPath"].forEach(t=>{c[t]&&(e[t]=et(e[t]))}),e},nt=c=>{const e=[],t=[],s=[],o=[],n=[];return c.blocks&&c.blocks.forEach(r=>{r.paragraphs.forEach(a=>{a.lines.forEach(i=>{i.words.forEach(l=>{l.symbols.forEach(h=>{n.push({...h,page:c,block:r,paragraph:a,line:i,word:l})}),o.push({...l,page:c,block:r,paragraph:a,line:i})}),s.push({...i,page:c,block:r,paragraph:a})}),t.push({...a,page:c,block:r})}),e.push({...r,page:c})}),{...c,blocks:e,paragraphs:t,lines:s,words:o,symbols:n}},rt={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const st="5.1.1",ot={version:st};var it={workerBlobURL:!0,logger:()=>{}};const at=ot.version,ct=it;var lt={...ct,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${at}/dist/worker.min.js`},ht=({workerPath:c,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const s=new Blob([`importScripts("${c}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(s))}else t=new Worker(c);return t},dt=c=>{c.terminate()},ut=(c,e)=>{c.onmessage=({data:t})=>{e(t)}},ft=async(c,e)=>{c.postMessage(e)};const ae=c=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{e(s.result)},s.onerror=({target:{error:{code:o}}})=>{t(Error(`File could not be read! Code=${o}`))},s.readAsArrayBuffer(c)}),he=async c=>{let e=c;if(typeof c>"u")return"undefined";if(typeof c=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(c)?e=atob(c.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(c)).arrayBuffer();else if(typeof HTMLElement<"u"&&c instanceof HTMLElement)c.tagName==="IMG"&&(e=await he(c.src)),c.tagName==="VIDEO"&&(e=await he(c.poster)),c.tagName==="CANVAS"&&await new Promise(t=>{c.toBlob(async s=>{e=await ae(s),t()})});else if(typeof OffscreenCanvas<"u"&&c instanceof OffscreenCanvas){const t=await c.convertToBlob();e=await ae(t)}else(c instanceof File||c instanceof Blob)&&(e=await ae(c));return new Uint8Array(e)};var mt=he;const gt=lt,pt=ht,vt=dt,wt=ut,yt=ft,_t=mt;var xt={defaultOptions:gt,spawnWorker:pt,terminateWorker:vt,onMessage:wt,send:yt,loadImage:_t};const Pt=tt,St=nt,M=Ke,{log:me}=te,Lt=Se,F=rt,{defaultOptions:Ot,spawnWorker:Ct,terminateWorker:Et,onMessage:Rt,loadImage:ge,send:bt}=xt;let pe=0;var It=async(c="eng",e=F.LSTM_ONLY,t={},s={})=>{const o=Lt("Worker",pe),{logger:n,errorHandler:r,...a}=Pt({...Ot,...t}),i={},l={},h=typeof c=="string"?c.split("+"):c;let g=e,w=s;const v=[F.DEFAULT,F.LSTM_ONLY].includes(e)&&!a.legacyCore;let _,P;const R=new Promise((u,p)=>{P=u,_=p}),I=u=>{_(u.message)};let O=Ct(a);O.onerror=I,pe+=1;const z=(u,p)=>{i[u]=p},A=(u,p)=>{l[u]=p},b=({id:u,action:p,payload:x})=>new Promise((S,L)=>{me(`[${o}]: Start ${u}, action=${p}`);const C=`${p}-${u}`;z(C,S),A(C,L),bt(O,{workerId:o,jobId:u,action:p,payload:x})}),q=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Y=u=>b(M({id:u,action:"load",payload:{options:{lstmOnly:v,corePath:a.corePath,logging:a.logging}}})),U=(u,p,x)=>b(M({id:x,action:"FS",payload:{method:"writeFile",args:[u,p]}})),$=(u,p)=>b(M({id:p,action:"FS",payload:{method:"readFile",args:[u,{encoding:"utf8"}]}})),Z=(u,p)=>b(M({id:p,action:"FS",payload:{method:"unlink",args:[u]}})),k=(u,p,x)=>b(M({id:x,action:"FS",payload:{method:u,args:p}})),re=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),K=(u,p)=>b(M({id:p,action:"loadLanguage",payload:{langs:u,options:{langPath:a.langPath,dataPath:a.dataPath,cachePath:a.cachePath,cacheMethod:a.cacheMethod,gzip:a.gzip,lstmOnly:[F.DEFAULT,F.LSTM_ONLY].includes(g)&&!a.legacyLang}}})),se=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),N=(u,p,x,S)=>b(M({id:S,action:"initialize",payload:{langs:u,oem:p,config:x}})),J=(u="eng",p,x,S)=>{if(v&&[F.TESSERACT_ONLY,F.TESSERACT_LSTM_COMBINED].includes(p))throw Error("Legacy model requested but code missing.");const L=p||g;g=L;const C=x||w;w=C;const D=(typeof u=="string"?u.split("+"):u).filter(B=>!h.includes(B));return h.push(...D),D.length>0?K(D,S).then(()=>N(u,L,C,S)):N(u,L,C,S)},V=(u={},p)=>b(M({id:p,action:"setParameters",payload:{params:u}})),Q=async(u,p={},x={blocks:!0,text:!0,hocr:!0,tsv:!0},S)=>b(M({id:S,action:"recognize",payload:{image:await ge(u),options:p,output:x}})),f=(u="Tesseract OCR Result",p=!1,x)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),b(M({id:x,action:"getPDF",payload:{title:u,textonly:p}}))),d=async(u,p)=>{if(v)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return b(M({id:p,action:"detect",payload:{image:await ge(u)}}))},m=async()=>(O!==null&&(Et(O),O=null),Promise.resolve());Rt(O,({workerId:u,jobId:p,status:x,action:S,data:L})=>{const C=`${S}-${p}`;if(x==="resolve"){me(`[${u}]: Complete ${p}`);let j=L;S==="recognize"?j=St(L):S==="getPDF"&&(j=Array.from({...L,length:Object.keys(L).length})),i[C]({jobId:p,data:j})}else if(x==="reject")if(l[C](L),S==="load"&&_(L),r)r(L);else throw Error(L);else x==="progress"&&n({...L,userJobId:p})});const y={id:o,worker:O,setResolve:z,setReject:A,load:q,writeText:U,readText:$,removeFile:Z,FS:k,loadLanguage:re,initialize:se,reinitialize:J,setParameters:V,recognize:Q,getPDF:f,detect:d,terminate:m};return Y().then(()=>K(c)).then(()=>N(c,e,s)).then(()=>P(y)).catch(()=>{}),R};const Le=It,Tt=async(c,e,t)=>{const s=await Le(e,1,t);return s.recognize(c).finally(async()=>{await s.terminate()})},zt=async(c,e)=>{const t=await Le("osd",0,e);return t.detect(c).finally(async()=>{await t.terminate()})};var Mt={recognize:Tt,detect:zt};const At=Mt;({...At});const Dt="client-ocr-app",Bt=window.location.hostname.includes("github.io"),$t=Bt?`/${Dt}/`:"/";function E(c){const e=c.startsWith("/")?c.slice(1):c;return new URL(e,new URL($t,window.location.origin)).href}function jt(){return"crossOriginIsolated"in self&&self.crossOriginIsolated}E("models/PP-OCRv5/det/det.onnx"),E("models/PP-OCRv5/cls/cls.onnx"),E("models/PP-OCRv5/rec/rec.onnx"),E("models/PP-OCRv5/ppocrv5_dict.txt"),E("models/PP-OCRv4/det/det.onnx"),E("models/PP-OCRv4/cls/cls.onnx"),E("models/PP-OCRv4/rec/rec.onnx"),E("models/PP-OCRv4/ppocr_keys_v1.txt"),E("models/ch_ppocr_server_v2.0/det/det.onnx"),E("models/ch_ppocr_server_v2.0/cls/cls.onnx"),E("models/PP-OCRv4/rec/rec.onnx"),E("models/ch_ppocr_server_v2.0/ppocr_keys_v1.txt"),E("models/PP-OCRv5_mobile_det_infer.onnx"),E("models/PP-OCRv5/cls/cls.onnx"),E("models/PP-OCRv5_mobile_rec_infer.onnx"),E("models/ppocrv5_dict.txt"),E("models/PP-OCRv4/det/det.onnx"),E("models/PP-OCRv4/cls/cls.onnx"),E("models/en_PP-OCRv4_mobile_rec_infer.onnx"),E("models/en_dict.txt");E("assets/");async function Nt(){if("serviceWorker"in navigator)try{const c=E("sw-enhanced.js"),e=await navigator.serviceWorker.register(c,{scope:E("")});return console.log("Service Worker registered:",e.scope),jt()&&console.log("Cross-origin isolation enabled - WebAssembly threading available"),e}catch(c){console.error("Service Worker registration failed:",c)}}async function Ft(){}typeof window<"u"&&(window.addEventListener("load",()=>{Nt()}),window.addEventListener("beforeunload",()=>{Ft()}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(c=>{console.log("Service Worker registered:",c),c.addEventListener("updatefound",()=>{const e=c.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&ne("New version available! Reload to update.","info")})})}).catch(c=>console.error("Service Worker registration failed:",c))});const W=document.getElementById("dropzone"),Oe=document.getElementById("fileInput"),ce=document.getElementById("fileList"),Wt=document.getElementById("processBtn"),ve=document.getElementById("progressSection"),Ut=document.getElementById("progressBar"),kt=document.getElementById("progressLabel"),Ce=document.getElementById("resultsContainer"),Ee=document.getElementById("resultsList");let T=[],X=null;document.querySelectorAll(".tab").forEach(c=>{c.addEventListener("click",()=>{const e=c.dataset.tab;document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active")),c.classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.toggle("hidden",t.dataset.content!==e)})})});W.addEventListener("click",()=>Oe.click());W.addEventListener("dragover",c=>{c.preventDefault(),W.classList.add("active")});W.addEventListener("dragleave",()=>{W.classList.remove("active")});W.addEventListener("drop",c=>{c.preventDefault(),W.classList.remove("active"),Re(c.dataTransfer.files)});Oe.addEventListener("change",c=>{Re(c.target.files)});function Re(c){T=Array.from(c),be()}function be(){if(T.length===0){ce.classList.add("hidden");return}ce.classList.remove("hidden"),ce.innerHTML=T.map((c,e)=>`
                <div class="file-item">
                    <div class="file-info">
                        <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        <div>
                            <div class="file-name">${c.name}</div>
                            <div class="file-size">${Gt(c.size)}</div>
                        </div>
                    </div>
                    <button class="button button-subtle" onclick="removeFile(${e})">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            `).join("")}window.removeFile=function(c){T.splice(c,1),be()};function Gt(c){if(c===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(c)/Math.log(e));return parseFloat((c/Math.pow(e,s)).toFixed(2))+" "+t[s]}Wt.addEventListener("click",async()=>{if(T.length===0){ne("Please select files to process","error");return}const c=document.getElementById("engineSelect").value,e=document.getElementById("modelSelect").value,t=document.getElementById("presetSelect").value,s=document.getElementById("angleClassification").checked,o=document.getElementById("cacheResults").checked;ve.classList.remove("hidden"),Ce.style.display="none",Ee.innerHTML="";const n=[];for(let r=0;r<T.length;r++){const a=T[r];G(r/T.length*100,`Processing ${a.name}...`);try{let i=null;if(o){const l=await ye(a);i=H.get(l,c,e)}if(!i){if(c==="tesseract")i=await window.OCREngine.processWithTesseract(a,l=>{G(r/T.length*100,l)});else if(c==="paddleocr"){const l={preset:t,preprocessing:"improved",modelVersion:e};i=await window.OCREngine.processWithPaddleOCR(a,l,h=>{G(r/T.length*100,h),h.phase==="model_selection"&&h.models&&we(h.models)})}else if(c==="ppocr-v5"){const l=t!=="custom"?He.mergeWithPreset(t,{modelName:e,useAngleCls:s,useCache:o}):{modelName:e,useAngleCls:s,useCache:o};(!X||X.modelName!==e)&&(X=new Pe(l),await X.initialize(h=>{G(r/T.length*100,h),h.phase==="model_selection"&&h.models&&we(h.models)})),i=await X.process(a,h=>{G(r/T.length*100,h)})}if(o&&i){const l=await ye(a);H.set(l,c,e,i)}}n.push({filename:a.name,text:(i==null?void 0:i.text)||"No text detected",boxes:(i==null?void 0:i.boxes)||[]})}catch(i){console.error("Error processing file:",i),n.push({filename:a.name,text:`Error: ${i.message}`,boxes:[]})}}G(100,"Processing complete!"),Ht(n),setTimeout(()=>{ve.classList.add("hidden")},1e3)});function G(c,e){Ut.style.width=c+"%",kt.textContent=e}function Ht(c){Ce.style.display="block",Ee.innerHTML=c.map((e,t)=>`
                <div class="result-item">
                    <div class="result-header">
                        <span class="result-filename">${e.filename}</span>
                        <button class="button button-subtle" onclick="copyText(${t})">
                            Copy Text
                        </button>
                    </div>
                    <div class="result-text">${e.text}</div>
                </div>
            `).join(""),window.results=c}window.copyText=function(c){const e=window.results[c].text;navigator.clipboard.writeText(e).then(()=>{ne("Text copied to clipboard","success")})};function we(c){c&&(document.getElementById("modelInfoSection").style.display="block",document.getElementById("selectedDET").textContent=c.det||"-",document.getElementById("selectedCLS").textContent=c.cls||"-",document.getElementById("selectedREC").textContent=c.rec||"-",document.getElementById("selectedDICT").textContent=c.dict||"-")}function ne(c,e="success"){const t=document.createElement("div");t.className=`notification notification-${e}`,t.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${e==="success"?'<polyline points="20 6 9 17 4 12"/>':'<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>'}
                </svg>
                <span>${c}</span>
            `,document.body.appendChild(t),setTimeout(()=>{t.remove()},3e3)}async function ye(c){return new Promise((e,t)=>{const s=new FileReader;s.onload=o=>e(o.target.result),s.onerror=t,s.readAsDataURL(c)})}document.getElementById("downloadAllBtn").addEventListener("click",()=>{if(!window.results||window.results.length===0)return;const c=window.results.map(o=>`=== ${o.filename} ===

${o.text}

`).join(`
`),e=new Blob([c],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="ocr-results.txt",s.click(),URL.revokeObjectURL(t)});ne("Smart OCR ready!","success");
//# sourceMappingURL=index-CgZXonUR.js.map
