import{b as G,F as J,H as ee}from"./onnxruntime-CqRzMC93.js";import{p as he,c as Te,g as it,a as pt}from"./pdfjs-2tDPGsej.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();he.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";G.wasm.wasmPaths="/client-ocr-app/assets/";G.wasm.numThreads=1;G.webgl.pack=!1;G.webgl.matmulMaxBatchSize=16;const ze="/client-ocr-app/models/",_t={det_limit_side_len:1280,det_limit_type:"max",det_db_thresh:.05,det_db_box_thresh:.1,det_db_unclip_ratio:2.5,det_db_min_size:2,det_db_max_candidates:2e3,det_use_dilation:!0,det_dilation_kernel:3,rec_image_height:48,rec_image_width:320,rec_batch_num:6,drop_score:.05,det_mean:[.485,.456,.406],det_std:[.229,.224,.225],rec_mean:.5,rec_std:.5,min_area_thresh:2,vertical_gap_threshold:.5,english_mode:!0,min_word_confidence:.1,enable_word_splitting:!0,grid_size:16,overlap_ratio:.2};class wt{constructor(){this.detectionSession=null,this.recognitionSession=null,this.charDict=[],this.initialized=!1,this.canvas=null,this.ctx=null,this.modelConfig={detection:"PP-OCRv5_mobile_det_infer.onnx",recognition:"en_PP-OCRv4_mobile_rec_infer.onnx",dictionary:"en_dict.txt"},this.CONFIG=_t}setModelConfig(e){e.detection&&(this.modelConfig.detection=e.detection),e.recognition&&(this.modelConfig.recognition=e.recognition),e.dictionary&&(this.modelConfig.dictionary=e.dictionary),this.initialized=!1}async initialize(e){try{this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),e==null||e({status:"loading",message:"Loading dictionary...",progress:10}),await this.loadDictionary();const t=this.modelConfig.detection.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${t}...`,progress:30}),this.detectionSession&&await this.detectionSession.release();const n=["webgl","wasm"];let i=null;for(const s of n)try{console.log(`Trying to load detection model with ${s} provider...`),this.detectionSession=await J.create(ze+this.modelConfig.detection,{executionProviders:[s],graphOptimizationLevel:"all",enableCpuMemArena:!1,enableMemPattern:!1}),console.log(`Detection model loaded successfully with ${s}:`,this.detectionSession.inputNames,this.detectionSession.outputNames);break}catch(a){if(console.warn(`Failed to load with ${s}:`,a.message),i=a,s===n[n.length-1])throw i}const o=this.modelConfig.recognition.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${o}...`,progress:70}),this.recognitionSession&&await this.recognitionSession.release();for(const s of n)try{console.log(`Trying to load recognition model with ${s} provider...`),this.recognitionSession=await J.create(ze+this.modelConfig.recognition,{executionProviders:[s],graphOptimizationLevel:"all",enableCpuMemArena:!1,enableMemPattern:!1}),console.log(`Recognition model loaded successfully with ${s}:`,this.recognitionSession.inputNames,this.recognitionSession.outputNames);break}catch(a){if(console.warn(`Failed to load recognition with ${s}:`,a.message),i=a,s===n[n.length-1])throw i}this.initialized=!0,e==null||e({status:"ready",message:"PP-OCR ready!",progress:100})}catch(t){throw console.error("Failed to initialize PP-OCR models:",t),t}}async loadDictionary(){try{const t=await(await fetch(ze+this.modelConfig.dictionary)).text();this.charDict=t.split(`
`).filter(n=>n.trim()),this.charDict.unshift(" "),console.log(`Loaded dictionary ${this.modelConfig.dictionary} with ${this.charDict.length} characters`)}catch(e){console.error("Failed to load dictionary:",e),this.charDict=[" "];for(let t=32;t<127;t++)this.charDict.push(String.fromCharCode(t))}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(console.log("Processing blob type:",e.type,"size:",e.size),e.type==="application/pdf")return await this.processPDF(e);console.log("Converting blob to image...");const t=await this.blobToImage(e);console.log("Image loaded:",t.width,"x",t.height);const n=await this.detectText(t),i=await this.recognizeText(t,n);return this.mergeTextLines(i)}async detectText(e){var t,n;if(console.log("detectText called, checking detection session..."),!this.detectionSession)throw new Error("Detection model not loaded");console.log("Detection session exists:",this.detectionSession),console.log("Current dictionary:",this.modelConfig.dictionary,"Dictionary length:",this.charDict.length);try{console.log("Starting image resize...");const{resizedImage:i,ratio:o}=await this.resizeForDetection(e);console.log("Image resized, ratio:",o),console.log("Starting preprocessing...");const s=await this.preprocessForDetection(i);console.log("Preprocessing complete, tensor shape:",s.dims),console.log("Running detection model..."),console.log("Input names:",this.detectionSession.inputNames),console.log("Output names:",this.detectionSession.outputNames);const a={[this.detectionSession.inputNames[0]]:s};let r;try{console.log("Tensor data type:",s.type),console.log("Tensor size:",s.data.length),console.log("Tensor shape:",s.dims),console.log("Expected input name:",this.detectionSession.inputNames[0]);try{const g=this.detectionSession.inputNames.map(v=>({name:v}));console.log("Model inputs:",g)}catch{console.log("Could not get model input info")}const h=s.data;let d=0,u=0,m=1/0,f=-1/0;for(let g=0;g<h.length;g++)isNaN(h[g])&&d++,isFinite(h[g])||u++,m=Math.min(m,h[g]),f=Math.max(f,h[g]);console.log(`Tensor stats: min=${m.toFixed(3)}, max=${f.toFixed(3)}`),(d>0||u>0)&&console.error(`Invalid tensor data: ${d} NaN values, ${u} Inf values`),r=await this.detectionSession.run(a),console.log("Detection complete"),console.log("Output shape:",r[this.detectionSession.outputNames[0]].dims)}catch(h){if(console.error("ONNX inference error:",h),console.error("Error code:",h.code),console.error("Error message:",h.message),console.error("Error stack:",h.stack),h.code===30757872||(t=h.message)!=null&&t.includes("invalid graph")||(n=h.message)!=null&&n.includes("dimension mismatch")){console.error("Model compatibility issue detected. The model might require specific input dimensions."),console.error("Trying simplified approach...");try{const d=await this.simplifiedDetection(i,o);return console.log(`Simplified detection found ${d.length} regions`),d}catch(d){console.error("Simplified detection also failed:",d)}}throw h}const c=await this.postprocessDetection(r[this.detectionSession.outputNames[0]],i.width,i.height,o);return console.log(`Detected ${c.length} text regions`),this.sortBoxes(c)}catch(i){return console.error("Error in detectText:",i),console.error("Error details:",{message:i.message,stack:i.stack,name:i.name,code:i.code}),[]}}async resizeForDetection(e){try{console.log("resizeForDetection - input image size:",e.width,"x",e.height);const t=this.CONFIG.det_limit_side_len,n=this.CONFIG.det_limit_type;let i=e.width,o=e.height,s=1;n==="max"?Math.max(o,i)>t&&(s=o>i?t/o:t/i):Math.min(o,i)<t&&(s=o<i?t/o:t/i),i=Math.round(i*s),o=Math.round(o*s);const a=this.CONFIG.grid_size||32,r=Math.max(a,Math.round(i/a)*a),c=Math.max(a,Math.round(o/a)*a);if(console.log(`Resizing from ${e.width}x${e.height} to ${r}x${c} (ratio: ${s})`),r<=0||c<=0||!isFinite(r)||!isFinite(c))throw new Error(`Invalid target dimensions: ${r}x${c}`);const h=await this.preprocessImage(e,r,c),d=new Image;return new Promise(u=>{this.canvas.toBlob(m=>{const f=URL.createObjectURL(m);d.onload=()=>{URL.revokeObjectURL(f),u({resizedImage:d,ratio:s})},d.src=f})})}catch(t){throw console.error("Error in resizeForDetection:",t),t}}async preprocessImage(e,t,n){this.canvas.width=t,this.canvas.height=n,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,t,n),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high";const i=Math.min(t/e.width,n/e.height),o=e.width*i,s=e.height*i,a=(t-o)/2,r=(n-s)/2;this.ctx.drawImage(e,a,r,o,s);const c=this.ctx.getImageData(0,0,t,n),h=c.data;for(let d=0;d<h.length;d+=4){let m=(.299*h[d]+.587*h[d+1]+.114*h[d+2]-128)*1.2+128;m>240?m=255:m<15&&(m=0),m=Math.max(0,Math.min(255,m)),h[d]=m,h[d+1]=m,h[d+2]=m}return this.ctx.putImageData(c,0,0),this.canvas}async preprocessForDetection(e){try{this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const n=this.ctx.getImageData(0,0,e.width,e.height).data;console.log(`Preprocessing image: ${e.width}x${e.height}`);const i=e.width*e.height,o=new Float32Array(3*i),s=this.CONFIG.det_mean||[.485,.456,.406],a=this.CONFIG.det_std||[.229,.224,.225];for(let c=0;c<i;c++){const h=c*4,d=Math.max(0,Math.min(255,n[h])),u=Math.max(0,Math.min(255,n[h+1])),m=Math.max(0,Math.min(255,n[h+2]));o[c]=(d/255-s[0])/a[0],o[i+c]=(u/255-s[1])/a[1],o[2*i+c]=(m/255-s[2])/a[2]}for(let c=0;c<o.length;c++)isFinite(o[c])||(console.error(`Invalid value at index ${c}: ${o[c]}`),o[c]=0);const r=new ee("float32",o,[1,3,e.height,e.width]);return console.log("Created tensor with shape:",r.dims,"type:",r.type),r}catch(t){throw console.error("Error in preprocessForDetection:",t),new Error(`Preprocessing failed: ${t.message}`)}}async postprocessDetection(e,t,n,i){try{let o,s,a;if(e.dims.length===4){const[x,I,E,O]=e.dims;o=E,s=O,a=e.data}else if(e.dims.length===3){const[x,I,E]=e.dims;o=I,s=E,a=e.data}else throw new Error(`Unexpected output tensor dimensions: ${e.dims}`);console.log(`Detection output shape: ${o}x${s}, total pixels: ${o*s}`),console.log("Output tensor dims:",e.dims),console.log("Data length:",a.length);const r=new Float32Array(o*s);for(let x=0;x<o*s;x++)r[x]=1/(1+Math.exp(-a[x]));const c=new Uint8Array(o*s);let h=0;for(let x=0;x<o*s;x++)c[x]=r[x]>this.CONFIG.det_db_thresh?255:0,c[x]===255&&h++;console.log(`Detected pixels: ${h} out of ${o*s} (${(h/(o*s)*100).toFixed(2)}%)`),console.log(`Detection threshold: ${this.CONFIG.det_db_thresh}`);const d=[];for(let x=0;x<Math.min(10,r.length);x+=Math.floor(r.length/10))d.push(r[x].toFixed(3));console.log("Sample probability values:",d);const u=[],m=new Set;let f=0,g=0,v=0,P=0;for(let x=0;x<o&&f<this.CONFIG.det_db_max_candidates;x++)for(let I=0;I<s&&f<this.CONFIG.det_db_max_candidates;I++){const E=x*s+I;if(c[E]===255&&!m.has(E)){const O=this.findConnectedComponent(c,s,o,I,x,m,r);if(O)if(g++,O.score>=this.CONFIG.det_db_box_thresh){O.points=O.points.map(z=>[Math.round(z[0]/i),Math.round(z[1]/i)]);const F=this.calculatePolygonArea(O.points);F>this.CONFIG.min_area_thresh?(u.push(O),f++):(P++,console.log(`Component rejected by area: ${F} < ${this.CONFIG.min_area_thresh}`))}else v++,console.log(`Component rejected by score: ${O.score.toFixed(3)} < ${this.CONFIG.det_db_box_thresh}`)}}return console.log(`Detection summary: ${g} components found, ${f} accepted, ${v} rejected by score, ${P} rejected by area`),u}catch(o){throw console.error("Error in postprocessDetection:",o),new Error(`Detection post-processing failed: ${o.message}`)}}findConnectedComponent(e,t,n,i,o,s,a){const r=[[i,o]],c=[];let h=0,d=0;const u=1e4,m=o*t+i;if(s.has(m)||e[m]!==255)return null;const f=new Set;for(f.add(m);r.length>0&&c.length<u;){const[z,A]=r.pop(),U=A*t+z;if(!s.has(U)&&(s.add(U),e[U]===255)){c.push([z,A]),h+=a[U],d++;const _e=[[z,A-1],[z,A+1],[z-1,A],[z+1,A]];for(const[Y,te]of _e)if(Y>=0&&Y<t&&te>=0&&te<n){const ne=te*t+Y;if(!s.has(ne)&&e[ne]===255){const ve=Math.abs(te-o),oe=Math.abs(Y-i);(ve<n*.05||oe<t*.3)&&(r.push([Y,te]),f.add(ne))}}}}if(c.length<this.CONFIG.det_db_min_size)return null;const g=c.map(z=>z[0]),v=c.map(z=>z[1]);let P=Math.min(...g),x=Math.max(...g),I=Math.min(...v),E=Math.max(...v);this.CONFIG.det_db_unclip_ratio;const O=(x-P)*.1,F=(E-I)*.2;return P=Math.max(0,P-O),x=Math.min(t-1,x+O),I=Math.max(0,I-F),E=Math.min(n-1,E+F),{points:[[P,I],[x,I],[x,E],[P,E]],score:h/d}}calculatePolygonArea(e){let t=0;const n=e.length;for(let i=0;i<n;i++){const o=(i+1)%n;t+=e[i][0]*e[o][1],t-=e[o][0]*e[i][1]}return Math.abs(t)/2}async simplifiedDetection(e,t){console.log("Using simplified detection fallback..."),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const i=this.ctx.getImageData(0,0,e.width,e.height).data,o=new Uint8Array(e.width*e.height);for(let r=0;r<o.length;r++){const c=r*4,h=.299*i[c]+.587*i[c+1]+.114*i[c+2];o[r]=h<200?255:0}const s=[],a=new Set;for(let r=10;r<e.height-10;r+=20)for(let c=10;c<e.width-10;c+=20){const h=r*e.width+c;if(o[h]===255&&!a.has(h)){let d=c,u=c,m=r,f=r;const g=[[c,r]];for(;g.length>0&&a.size<1e4;){const[v,P]=g.pop(),x=P*e.width+v;v<0||v>=e.width||P<0||P>=e.height||a.has(x)||o[x]!==255||(a.add(x),d=Math.min(d,v),u=Math.max(u,v),m=Math.min(m,P),f=Math.max(f,P),g.push([v+1,P],[v-1,P],[v,P+1],[v,P-1]))}u-d>10&&f-m>10&&s.push({points:[[d/t,m/t],[u/t,m/t],[u/t,f/t],[d/t,f/t]],score:.8})}}return s}sortBoxes(e){if(e.length===0)return e;e.sort((t,n)=>{const i=t.points[0][1],o=n.points[0][1];return i-o});for(let t=e.length-1;t>0;t--)for(let n=t-1;n>=0&&(Math.abs(e[n+1].points[0][1]-e[n].points[0][1])<10&&e[n+1].points[0][0]<e[n].points[0][0]);n--){const i=e[n];e[n]=e[n+1],e[n+1]=i}return e}async recognizeText(e,t){if(!this.recognitionSession)throw new Error("Recognition model not loaded");const n=[],i=this.CONFIG.rec_batch_num;for(let o=0;o<t.length;o+=i){const s=t.slice(o,Math.min(o+i,t.length)),a=await this.processBatch(e,s);n.push(...a)}return n}async processBatch(e,t){const n=[],i=[],o=[];for(const a of t){const r=await this.getRotateCropImage(e,a),c=r.width/r.height;i.push(r),o.push(c)}const s=Array.from({length:t.length},(a,r)=>r).sort((a,r)=>o[a]-o[r]);for(const a of s){const r=i[a],c=t[a],h=await this.preprocessForRecognition(r),d={[this.recognitionSession.inputNames[0]]:h},u=await this.recognitionSession.run(d),m=await this.decodeRecognition(u[this.recognitionSession.outputNames[0]]);m.score>=this.CONFIG.drop_score&&n.push({text:m.text,confidence:m.score,box:c.points})}return n}async getRotateCropImage(e,t){const n=t.points;Math.sqrt(Math.pow(n[0][0]-n[1][0],2)+Math.pow(n[0][1]-n[1][1],2)),Math.sqrt(Math.pow(n[2][0]-n[3][0],2)+Math.pow(n[2][1]-n[3][1],2)),Math.sqrt(Math.pow(n[0][0]-n[3][0],2)+Math.pow(n[0][1]-n[3][1],2)),Math.sqrt(Math.pow(n[1][0]-n[2][0],2)+Math.pow(n[1][1]-n[2][1],2));const i=Math.min(...n.map(d=>d[0])),o=Math.max(...n.map(d=>d[0])),s=Math.min(...n.map(d=>d[1])),a=Math.max(...n.map(d=>d[1])),r=o-i,c=a-s;if(this.canvas.width=r,this.canvas.height=c,this.ctx.drawImage(e,i,s,r,c,0,0,r,c),c*1/r>=1.5){const d=document.createElement("canvas"),u=d.getContext("2d",{willReadFrequently:!0});d.width=c,d.height=r,u.translate(c/2,r/2),u.rotate(Math.PI/2),u.drawImage(this.canvas,-r/2,-c/2),this.canvas.width=c,this.canvas.height=r,this.ctx.drawImage(d,0,0)}const h=new Image;return new Promise(d=>{this.canvas.toBlob(u=>{const m=URL.createObjectURL(u);h.onload=()=>{URL.revokeObjectURL(m),d(h)},h.src=m})})}async preprocessForRecognition(e){const n=this.CONFIG.rec_image_height,i=this.CONFIG.rec_image_width,o=e.height,a=e.width/o;let r;Math.ceil(n*a)>i?r=i:r=Math.ceil(n*a),this.canvas.width=r,this.canvas.height=n,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,r,n),this.ctx.drawImage(e,0,0,r,n);const h=this.ctx.getImageData(0,0,r,n).data,d=new Float32Array(3*n*i);for(let u=0;u<3;u++)for(let m=0;m<n;m++)for(let f=0;f<r;f++){const g=(m*r+f)*4+u,v=u*n*i+m*i+f;d[v]=(h[g]/255-this.CONFIG.rec_mean)/this.CONFIG.rec_std}return new ee("float32",d,[1,3,n,i])}async decodeRecognition(e){const[t,n,i]=e.dims,o=e.data,s=[],a=[];for(let d=0;d<n;d++){let u=0,m=o[d*i];for(let f=1;f<i;f++){const g=o[d*i+f];g>m&&(m=g,u=f)}s.push(u),a.push(m)}const r=[],c=[];let h=-1;for(let d=0;d<s.length;d++){const u=s[d];u!==0&&u!==h&&u<this.charDict.length&&(r.push(this.charDict[u]),c.push(a[d])),h=u}return{text:r.join(""),score:c.length>0?c.reduce((d,u)=>d+u)/c.length:0}}mergeTextLines(e){if(e.length===0)return e;let t=this.filterResults(e);if(t.length===0)return t;this.CONFIG.english_mode&&(t=this.postProcessEnglishText(t));const n=t.map(r=>{const c=r.box.map(h=>h[1]);return Math.max(...c)-Math.min(...c)}),i=n.reduce((r,c)=>r+c)/n.length,o=[];let s=[t[0]];for(let r=1;r<t.length;r++){const c=t[r],h=t[r-1],d=Math.min(...h.box.map(g=>g[1])),u=Math.min(...c.box.map(g=>g[1])),m=Math.abs(u-d),f=i*this.CONFIG.vertical_gap_threshold;m<=f?s.push(c):(o.push(s),s=[c])}s.length>0&&o.push(s);const a=[];for(const r of o){r.sort((f,g)=>{const v=Math.min(...f.box.map(x=>x[0])),P=Math.min(...g.box.map(x=>x[0]));return v-P});const c=r.map(f=>f.text).join(" "),h=r.reduce((f,g)=>f+g.confidence,0)/r.length,d=r.flatMap(f=>f.box),u=d.map(f=>f[0]),m=d.map(f=>f[1]);a.push({text:c,confidence:h,box:[[Math.min(...u),Math.min(...m)],[Math.max(...u),Math.min(...m)],[Math.max(...u),Math.max(...m)],[Math.min(...u),Math.max(...m)]]})}return a}filterResults(e){const t=this.CONFIG.drop_score;return e.filter(n=>n.confidence<t?!1:n.text&&n.text.trim().length>0)}async processPDF(e){const t=await e.arrayBuffer(),n=await he.getDocument({data:t}).promise,i=n.numPages,o=[];for(let s=1;s<=i;s++){const a=await n.getPage(s),r=a.getViewport({scale:2}),c=document.createElement("canvas"),h=c.getContext("2d");c.width=r.width,c.height=r.height,await a.render({canvasContext:h,viewport:r}).promise;const d=await new Promise(m=>c.toBlob(m)),u=await this.process(d);o.push({page:s,results:u})}return o}async blobToImage(e){return new Promise((t,n)=>{const i=new Image,o=URL.createObjectURL(e);i.onload=()=>{URL.revokeObjectURL(o),t(i)},i.onerror=()=>{URL.revokeObjectURL(o),n(new Error("Failed to load image"))},i.src=o})}postProcessEnglishText(e){return e.map(t=>{let n=t.text;n=n.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([a-zA-Z])(\d)/g,"$1 $2").replace(/(\d)([a-zA-Z])/g,"$1 $2").replace(/\s+/g," ").replace(/([.,!?;:])([a-zA-Z])/g,"$1 $2").trim();const i={tne:"the",tnat:"that",wnen:"when",wnere:"where",witn:"with","l'":"I'"," l ":" I ","^l ":"I "};for(const[o,s]of Object.entries(i)){const a=new RegExp(o,"gi");n=n.replace(a,s)}return{...t,text:n}})}}const Q=new wt;he.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";G.wasm.wasmPaths="/client-ocr-app/assets/";G.wasm.numThreads=1;const $e="/client-ocr-app/models/",q={det_limit_side_len:1280,det_db_thresh:.05,det_db_box_thresh:.15,det_db_unclip_ratio:2.5,drop_score:.05,mean:[.485,.456,.406],std:[.229,.224,.225]};class xt{constructor(){this.detectionSession=null,this.recognitionSession=null,this.charDict=[],this.initialized=!1,this.canvas=null,this.ctx=null,this.modelConfig={detection:"PP-OCRv5_mobile_det_infer.onnx",recognition:"en_PP-OCRv4_mobile_rec_infer.onnx",dictionary:"en_dict.txt"}}setModelConfig(e){e.detection&&(this.modelConfig.detection=e.detection),e.recognition&&(this.modelConfig.recognition=e.recognition),e.dictionary&&(this.modelConfig.dictionary=e.dictionary),this.initialized=!1}async initialize(e){this.initialized=!1;try{this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),e==null||e({status:"loading",message:"Loading dictionary...",progress:10}),await this.loadDictionary();const t=this.modelConfig.detection.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${t}...`,progress:30}),this.detectionSession&&await this.detectionSession.release(),this.detectionSession=await J.create($e+this.modelConfig.detection,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Detection model loaded:",this.detectionSession.inputNames,this.detectionSession.outputNames);const n=this.modelConfig.recognition.replace(".onnx","").replace(/_/g," ");e==null||e({status:"loading",message:`Loading ${n}...`,progress:70}),this.recognitionSession&&await this.recognitionSession.release(),this.recognitionSession=await J.create($e+this.modelConfig.recognition,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("Recognition model loaded:",this.recognitionSession.inputNames,this.recognitionSession.outputNames),this.initialized=!0,e==null||e({status:"ready",message:"PP-OCR models loaded successfully!",progress:100})}catch(t){throw console.error("Failed to initialize PP-OCR models:",t),t}}async loadDictionary(){try{const t=await(await fetch($e+this.modelConfig.dictionary)).text();this.charDict=t.split(`
`).filter(n=>n.trim()),this.charDict.unshift(" "),console.log(`Loaded dictionary ${this.modelConfig.dictionary} with ${this.charDict.length} characters`)}catch(e){console.error("Failed to load dictionary:",e),this.charDict=[" "];for(let t=32;t<127;t++)this.charDict.push(String.fromCharCode(t))}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(e.type==="application/pdf")return await this.processPDF(e);const t=await this.blobToImage(e),n=await this.detectText(t);return await this.recognizeText(t,n)}async detectText(e){if(!this.detectionSession)throw new Error("Detection model not loaded");const{resizedImage:t,ratio:n}=await this.resizeForDetection(e),i=await this.preprocessForDetection(t),o={[this.detectionSession.inputNames[0]]:i},a=(await this.detectionSession.run(o))[this.detectionSession.outputNames[0]];return await this.postprocessDetection(a,t.width,t.height,n)}async resizeForDetection(e){const t=q.det_limit_side_len;let n=e.width,i=e.height,o=1;Math.max(i,n)>t&&(o=t/Math.max(i,n));const s=Math.ceil(n*o),a=Math.ceil(i*o),r=Math.ceil(s/32)*32,c=Math.ceil(a/32)*32;this.canvas.width=r,this.canvas.height=c,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,r,c),this.ctx.drawImage(e,0,0,s,a);const h=new Image;return new Promise(d=>{this.canvas.toBlob(u=>{const m=URL.createObjectURL(u);h.onload=()=>{URL.revokeObjectURL(m),d({resizedImage:h,ratio:o})},h.src=m})})}async preprocessForDetection(e){this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0);const n=this.ctx.getImageData(0,0,e.width,e.height).data,i=e.width*e.height,o=new Float32Array(3*i);for(let s=0;s<i;s++){const a=s*4;o[s]=(n[a]/255-q.mean[0])/q.std[0],o[i+s]=(n[a+1]/255-q.mean[1])/q.std[1],o[2*i+s]=(n[a+2]/255-q.mean[2])/q.std[2]}return new ee("float32",o,[1,3,e.height,e.width])}async postprocessDetection(e,t,n,i){const[o,s,a,r]=e.dims,c=e.data,h=new Float32Array(a*r);for(let g=0;g<a*r;g++)h[g]=1/(1+Math.exp(-c[g]));const d=new Uint8Array(a*r),u=q.det_db_thresh;for(let g=0;g<a*r;g++)d[g]=h[g]>u?1:0;const m=[],f=new Set;for(let g=0;g<a;g++)for(let v=0;v<r;v++){const P=g*r+v;if(d[P]===1&&!f.has(P)&&h[P]>q.det_db_box_thresh){const x=this.expandBox(d,h,v,g,r,a,f);if(x){const I={points:x.points.map(E=>[Math.round(E[0]*t/r/i),Math.round(E[1]*n/a/i)]),score:x.score};m.push(I)}}}return this.sortBoxes(m)}expandBox(e,t,n,i,o,s,a){let r=n,c=n,h=i,d=i,u=0,m=0;const f=[[n,i]];for(a.add(i*o+n);f.length>0;){const[P,x]=f.shift();u+=t[x*o+P],m++;for(let I=-1;I<=1;I++)for(let E=-1;E<=1;E++){const O=P+E,F=x+I,z=F*o+O;O>=0&&O<o&&F>=0&&F<s&&e[z]===1&&!a.has(z)&&(a.add(z),f.push([O,F]),r=Math.min(r,O),c=Math.max(c,O),h=Math.min(h,F),d=Math.max(d,F))}}if(c-r<3||d-h<3)return null;const g=q.det_db_unclip_ratio,v=Math.max(c-r,d-h)*(g-1)/2;return r=Math.max(0,r-v),c=Math.min(o-1,c+v),h=Math.max(0,h-v),d=Math.min(s-1,d+v),{points:[[r,h],[c,h],[c,d],[r,d]],score:u/m}}sortBoxes(e){return e.sort((t,n)=>{const i=Math.min(...t.points.map(s=>s[1])),o=Math.min(...n.points.map(s=>s[1]));if(Math.abs(i-o)<10){const s=Math.min(...t.points.map(r=>r[0])),a=Math.min(...n.points.map(r=>r[0]));return s-a}return i-o})}async recognizeText(e,t){if(!this.recognitionSession)throw new Error("Recognition model not loaded");const n=[];for(const i of t){const o=await this.cropToBox(e,i),s=await this.preprocessForRecognition(o),a={[this.recognitionSession.inputNames[0]]:s},r=await this.recognitionSession.run(a),c=await this.decodeRecognition(r[this.recognitionSession.outputNames[0]]);c.score>=q.drop_score&&n.push({text:c.text,confidence:c.score,box:i.points})}return n}async cropToBox(e,t){const n=t.points,i=Math.min(...n.map(d=>d[0])),o=Math.max(...n.map(d=>d[0])),s=Math.min(...n.map(d=>d[1])),a=Math.max(...n.map(d=>d[1])),r=o-i,c=a-s;this.canvas.width=r,this.canvas.height=c,this.ctx.drawImage(e,i,s,r,c,0,0,r,c);const h=new Image;return new Promise(d=>{this.canvas.toBlob(u=>{const m=URL.createObjectURL(u);h.onload=()=>{URL.revokeObjectURL(m),d(h)},h.src=m})})}async preprocessForRecognition(e){const n=e.width/e.height;let i=Math.round(48*n);i=Math.max(i,48),this.canvas.width=i,this.canvas.height=48,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,i,48),this.ctx.drawImage(e,0,0,i,48);const s=this.ctx.getImageData(0,0,i,48).data,a=i*48,r=new Float32Array(3*a);for(let c=0;c<a;c++){const h=c*4;r[c]=(s[h]/255-.5)/.5,r[a+c]=(s[h+1]/255-.5)/.5,r[2*a+c]=(s[h+2]/255-.5)/.5}return new ee("float32",r,[1,3,48,i])}async decodeRecognition(e){const[t,n,i]=e.dims,o=e.data,s=[],a=[];for(let d=0;d<n;d++){let u=0,m=o[d*i];for(let f=1;f<i;f++){const g=o[d*i+f];g>m&&(m=g,u=f)}s.push(u),a.push(m)}const r=[],c=[];let h=-1;for(let d=0;d<s.length;d++){const u=s[d];u!==0&&u!==h&&u<this.charDict.length&&(r.push(this.charDict[u]),c.push(a[d])),h=u}return{text:r.join(""),score:c.length>0?c.reduce((d,u)=>d+u)/c.length:0}}async processPDF(e){const t=await e.arrayBuffer(),n=await he.getDocument({data:t}).promise,i=n.numPages,o=[];for(let s=1;s<=i;s++){const a=await n.getPage(s),r=a.getViewport({scale:2}),c=document.createElement("canvas"),h=c.getContext("2d");c.width=r.width,c.height=r.height,await a.render({canvasContext:h,viewport:r}).promise;const d=await new Promise(g=>c.toBlob(g,"image/png")),u=await this.blobToImage(d),m=await this.detectText(u),f=await this.recognizeText(u,m);o.push({page:s,results:f})}return o}async blobToImage(e){return new Promise((t,n)=>{const i=new Image;i.onload=()=>t(i),i.onerror=n,i.src=URL.createObjectURL(e)})}}const Z=new xt,Ae={GENERAL_TEXT:{detection:{det_limit_side_len:1536,det_db_thresh:.25,det_db_box_thresh:.45,det_db_unclip_ratio:1.7,det_db_min_size:3,det_db_max_candidates:2e3,grid_size:16,min_area_thresh:20},recognition:{rec_batch_num:24,drop_score:.4,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:1.5,sharpen_amount:1,denoise:!0}},INFOGRAPHIC_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.12,det_db_box_thresh:.35,det_db_unclip_ratio:2,det_db_min_size:2,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:10},recognition:{rec_batch_num:32,drop_score:.3,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.8,sharpen_amount:1.3,enhance_colors:!0,segment_regions:!0}},DOCUMENT_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.08,det_db_box_thresh:.25,det_db_unclip_ratio:1.5,det_db_min_size:2,det_db_max_candidates:5e3,grid_size:4,min_area_thresh:5},recognition:{rec_batch_num:32,drop_score:.25,rec_image_height:64,rec_image_width:640},preprocessing:{enhance_contrast:!0,contrast_factor:2,sharpen_amount:1.5,remove_background:!0,deskew:!0,fix_orientation:!0}},RECEIPT_OPTIMIZED:{detection:{det_limit_side_len:1920,det_db_thresh:.05,det_db_box_thresh:.2,det_db_unclip_ratio:1.3,det_db_min_size:1,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:3},recognition:{rec_batch_num:24,drop_score:.2,rec_image_height:48,rec_image_width:320},preprocessing:{enhance_contrast:!0,contrast_factor:2.5,sharpen_amount:1.8,enhance_thermal:!0,fix_faded_text:!0,binary_threshold:!0}},PDF_OPTIMIZED:{detection:{det_limit_side_len:2048,det_db_thresh:.15,det_db_box_thresh:.3,det_db_unclip_ratio:1.6,det_db_min_size:3,det_db_max_candidates:3500,grid_size:12,min_area_thresh:15},recognition:{rec_batch_num:32,drop_score:.35,rec_image_height:48,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:1.6,sharpen_amount:1.2,normalize_lighting:!0,remove_watermarks:!0}},ID_CARD_OPTIMIZED:{detection:{det_limit_side_len:2560,det_db_thresh:.06,det_db_box_thresh:.15,det_db_unclip_ratio:1.2,det_db_min_size:1,det_db_max_candidates:3e3,grid_size:4,min_area_thresh:2},recognition:{rec_batch_num:16,drop_score:.15,rec_image_height:64,rec_image_width:480},preprocessing:{enhance_contrast:!0,contrast_factor:2.2,sharpen_amount:1.6,remove_tint:!0,enhance_security_features:!1,detect_fields:!0}}};function yt(l,e){const t=Ae[e];if(!t){console.error(`Unknown config type: ${e}`);return}Object.entries(t.detection).forEach(([n,i])=>{l.CONFIG&&l.CONFIG.hasOwnProperty(n)?l.CONFIG[n]=i:l.config&&l.config.hasOwnProperty(n)&&(l.config[n]=i)}),Object.entries(t.recognition).forEach(([n,i])=>{l.CONFIG&&l.CONFIG.hasOwnProperty(n)?l.CONFIG[n]=i:l.config&&l.config.hasOwnProperty(n)&&(l.config[n]=i)}),t.preprocessing&&l.preprocessingOptions&&Object.entries(t.preprocessing).forEach(([n,i])=>{l.preprocessingOptions.hasOwnProperty(n)&&(l.preprocessingOptions[n]=i)}),console.log(`Applied optimal ${e} configuration`)}G.wasm.wasmPaths="/client-ocr-app/";G.wasm.numThreads=1;G.wasm.simd=!0;G.webgl.pack=!1;G.webgl.asyncKernel=!1;G.logLevel="warning";const Xe={"PP-OCRv5":{det:"PP-OCRv5/det/det.onnx",rec:"PP-OCRv5/rec/rec.onnx",cls:"PP-OCRv5/cls/cls.onnx",dict:"PP-OCRv5/ppocrv5_dict.txt",rec_image_shape:[3,48,320],preprocessing:{det:{mean:[.485,.456,.406],std:[.229,.224,.225]},rec:{mean:[.5,.5,.5],std:[.5,.5,.5]}}},"PP-OCRv4":{det:"PP-OCRv4/det/det.onnx",rec:"PP-OCRv4/rec/rec.onnx",cls:"PP-OCRv4/cls/cls.onnx",dict:"PP-OCRv4/ppocr_keys_v1.txt",rec_image_shape:[3,48,320],preprocessing:{det:{mean:[.485,.456,.406],std:[.229,.224,.225]},rec:{mean:[.5,.5,.5],std:[.5,.5,.5]}}},"ch_ppocr_server_v2.0":{det:"ch_ppocr_server_v2.0/det/det.onnx",rec:"ch_ppocr_server_v2.0/rec/rec.onnx",cls:"ch_ppocr_server_v2.0/cls/cls.onnx",dict:"ch_ppocr_server_v2.0/ppocr_keys_v1.txt",rec_image_shape:[3,32,320],preprocessing:{det:{mean:[.485,.456,.406],std:[.229,.224,.225]},rec:{mean:[.5,.5,.5],std:[.5,.5,.5]}}}};class vt{constructor(e={}){this.modelName=e.modelName||"PP-OCRv5",this.useAngleCls=e.useAngleCls!==!1,this.useGpu=e.useGpu===!0&&"gpu"in navigator,this.detLimitSideLen=e.detLimitSideLen||960,this.detLimitType=e.detLimitType||"max",this.detDbThresh=e.detDbThresh||.3,this.detDbBoxThresh=e.detDbBoxThresh||.6,this.detDbUnclipRatio=e.detDbUnclipRatio||1.7,this.detDbScoreMode=e.detDbScoreMode||"fast",this.useDilation=e.useDilation||!1,this.recBatchNum=e.recBatchNum||6,this.dropScore=e.dropScore||.5,this.detSession=null,this.recSession=null,this.clsSession=null,this.dictionary=[],this.currentConfig=Ae.GENERAL_TEXT,this.performanceMetrics={detection:{count:0,totalTime:0},recognition:{count:0,totalTime:0},classification:{count:0,totalTime:0},preprocessing:{count:0,totalTime:0}},this.initialized=!1}async initialize(e=null){if(!this.initialized)try{const t=Xe[this.modelName];if(!t)throw new Error(`Unknown model: ${this.modelName}`);const n="/client-ocr-app/models/";e==null||e({status:"loading",message:`Loading ${this.modelName} models...`,progress:10});const i=this.getSessionOptions();e==null||e({status:"loading",message:"Loading detection model...",progress:25}),this.detSession=await this.createSession(n+t.det,i),e==null||e({status:"loading",message:"Loading recognition model...",progress:50}),this.recSession=await this.createSession(n+t.rec,i),this.useAngleCls&&(e==null||e({status:"loading",message:"Loading classification model...",progress:70}),this.clsSession=await this.createSession(n+t.cls,i)),e==null||e({status:"loading",message:"Loading dictionary...",progress:85}),await this.loadDictionary(n+t.dict),this.modelConfig=t,this.initialized=!0,e==null||e({status:"ready",message:`${this.modelName} ready!`,progress:100}),console.log(`${this.modelName} engine initialized successfully`)}catch(t){throw console.error("Failed to initialize PP-OCR:",t),t}}getSessionOptions(){const e=[];return this.useGpu&&e.push({name:"webgl",deviceType:"gpu",powerPreference:"high-performance"}),e.push({name:"wasm",simd:!0,threads:navigator.hardwareConcurrency||4}),{executionProviders:e,graphOptimizationLevel:"all",enableCpuMemArena:!0,enableMemPattern:!0,executionMode:"parallel",interOpNumThreads:navigator.hardwareConcurrency||4,intraOpNumThreads:navigator.hardwareConcurrency||4}}async createSession(e,t){try{return await J.create(e,t)}catch(n){console.warn("Failed with primary provider, falling back to WASM:",n.message);const i={...t,executionProviders:["wasm"]};return await J.create(e,i)}}async loadDictionary(e){const n=await(await fetch(e)).text();this.dictionary=n.split(`
`).filter(i=>i.trim()),this.dictionary[0]!==" "&&this.dictionary.unshift(" ")}applyConfiguration(e){const t=Ae[e];if(!t){console.warn(`Unknown configuration: ${e}`);return}this.currentConfig=t,t.detection&&(this.detDbThresh=t.detection.det_db_thresh||this.detDbThresh,this.detDbBoxThresh=t.detection.det_db_box_thresh||this.detDbBoxThresh,this.detDbUnclipRatio=t.detection.det_db_unclip_ratio||this.detDbUnclipRatio,this.detLimitSideLen=t.detection.det_limit_side_len||this.detLimitSideLen),t.recognition&&(this.dropScore=t.recognition.drop_score||this.dropScore,this.recBatchNum=t.recognition.rec_batch_num||this.recBatchNum),console.log(`Applied ${e} configuration`)}async process(e){this.initialized||await this.initialize();const t=performance.now();try{const n=await this.blobToImage(e),i=await this.imageToCv(n),o=await this.ocr(i,!0,!0,this.useAngleCls),s=performance.now()-t;return console.log(`${this.modelName} processing complete in ${s.toFixed(2)}ms`),console.log("Performance metrics:",this.getPerformanceReport()),this.formatResults(o)}catch(n){throw console.error("PP-OCR processing error:",n),n}}async ocr(e,t=!0,n=!0,i=!0){if(i&&!this.useAngleCls&&(console.log("Angle classifier not initialized, skipping classification"),i=!1),t&&n){const o=await this.textDetector(e);if(!o||o.length===0)return[];const s=this.sortedBoxes(o),a=[];for(const h of s){const d=this.getRotateCropImage(e,h);a.push(d)}if(i&&this.clsSession){const h=performance.now(),d=await this.textClassifier(a);this.recordMetric("classification",performance.now()-h);for(let u=0;u<a.length;u++)d[u].label==="180"&&(a[u]=this.rotateImage(a[u],180))}const r=await this.textRecognizer(a),c=[];for(let h=0;h<s.length;h++)r[h][1]>=this.dropScore&&c.push({box:s[h],text:r[h][0],confidence:r[h][1]});return c}else{if(t&&!n)return await this.textDetector(e);{const o=Array.isArray(e)?e:[e];if(i&&this.clsSession){const s=await this.textClassifier(o);for(let a=0;a<o.length;a++)s[a].label==="180"&&(o[a]=this.rotateImage(o[a],180))}return await this.textRecognizer(o)}}}async textDetector(e){const t=performance.now(),{processedImg:n,ratioH:i,ratioW:o}=this.preprocessDetection(e),a={x:this.imageToTensor(n,"det")},r=await this.detSession.run(a),c=this.detSession.outputNames[0],h=r[c],d=await this.postprocessDetection(h,i,o);return this.recordMetric("detection",performance.now()-t),d}preprocessDetection(e){const t=e.height,n=e.width;let i,o;if(this.detLimitType==="max")if(Math.max(t,n)>this.detLimitSideLen){const h=this.detLimitSideLen/Math.max(t,n);i=Math.round(t*h),o=Math.round(n*h)}else i=t,o=n;else if(Math.min(t,n)<this.detLimitSideLen){const h=this.detLimitSideLen/Math.min(t,n);i=Math.round(t*h),o=Math.round(n*h)}else i=t,o=n;i=Math.round(i/32)*32,o=Math.round(o/32)*32;const s=document.createElement("canvas");s.width=o,s.height=i,s.getContext("2d").drawImage(e.canvas||e,0,0,o,i);const r=i/t,c=o/n;return{processedImg:s,ratioH:r,ratioW:c}}imageToTensor(e,t="det"){const i=e.getContext("2d").getImageData(0,0,e.width,e.height),{data:o}=i,s=this.modelConfig.preprocessing[t],a=s.mean,r=s.std,c=3,h=e.height,d=e.width,u=new Float32Array(c*h*d);for(let m=0;m<c;m++)for(let f=0;f<h;f++)for(let g=0;g<d;g++){const v=(f*d+g)*4+m,P=o[v]/255;u[m*h*d+f*d+g]=(P-a[m])/r[m]}return new ee("float32",u,[1,c,h,d])}async postprocessDetection(e,t,n){const i=e.data,[o,s,a]=e.dims,r=new Uint8Array(s*a);for(let d=0;d<s*a;d++)r[d]=i[d]>this.detDbThresh?255:0;const c=this.findContours(r,a,s),h=[];for(const d of c){if(d.area<5||this.boxScoreFast(i,d.points,a,s)<this.detDbBoxThresh)continue;const m=this.unclip(d.points,this.detDbUnclipRatio);if(!m||m.length<4)continue;const f=this.getMiniBoxes(m);if(this.calculateBoxArea(f)<10)continue;const g=f.map(v=>[Math.round(v[0]/n),Math.round(v[1]/t)]);h.push(g)}return h}findContours(e,t,n){const i=[],o=new Uint8Array(t*n);for(let s=1;s<n-1;s++)for(let a=1;a<t-1;a++){const r=s*t+a;if(e[r]===255&&!o[r]){const c=this.traceContour(e,o,a,s,t,n);c.points.length>=4&&i.push(c)}}return i}traceContour(e,t,n,i,o,s){const a=[],r=[[n,i]];let c=0;for(;r.length>0;){const[d,u]=r.pop(),m=u*o+d;if(!(d<0||d>=o||u<0||u>=s||t[m]||e[m]!==255)){t[m]=1,a.push([d,u]),c++;for(let f=-1;f<=1;f++)for(let g=-1;g<=1;g++)(g!==0||f!==0)&&r.push([d+g,u+f])}}return{points:this.convexHull(a),area:c}}convexHull(e){if(e.length<3)return e;e.sort((i,o)=>i[0]-o[0]||i[1]-o[1]);const t=[];for(const i of e){for(;t.length>=2&&this.cross(t[t.length-2],t[t.length-1],i)<=0;)t.pop();t.push(i)}const n=[];for(let i=e.length-1;i>=0;i--){const o=e[i];for(;n.length>=2&&this.cross(n[n.length-2],n[n.length-1],o)<=0;)n.pop();n.push(o)}return t.pop(),n.pop(),t.concat(n)}cross(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}boxScoreFast(e,t,n,i){const o=this.createMask(t,n,i);let s=0,a=0;for(let r=0;r<i;r++)for(let c=0;c<n;c++)o[r*n+c]&&(s+=e[r*n+c],a++);return a>0?s/a:0}createMask(e,t,n){const i=new Uint8Array(t*n);for(let o=0;o<n;o++)for(let s=0;s<t;s++)this.pointInPolygon([s,o],e)&&(i[o*t+s]=1);return i}pointInPolygon(e,t){let n=!1;const i=e[0],o=e[1];for(let s=0,a=t.length-1;s<t.length;a=s++){const r=t[s][0],c=t[s][1],h=t[a][0],d=t[a][1];c>o!=d>o&&i<(h-r)*(o-c)/(d-c)+r&&(n=!n)}return n}unclip(e,t){try{const n=this.calculatePolygonArea(e),i=this.calculatePolygonPerimeter(e),o=n*t/i,s=[],a=e.length;for(let r=0;r<a;r++){const c=(r+1)%a,h=(r-1+a)%a,d=[e[c][0]-e[r][0],e[c][1]-e[r][1]],u=[e[h][0]-e[r][0],e[h][1]-e[r][1]],m=Math.sqrt(d[0]*d[0]+d[1]*d[1]),f=Math.sqrt(u[0]*u[0]+u[1]*u[1]);d[0]/=m,d[1]/=m,u[0]/=f,u[1]/=f;const g=[d[0]+u[0],d[1]+u[1]],v=Math.sqrt(g[0]*g[0]+g[1]*g[1]);v>0?(g[0]/=v,g[1]/=v,s.push([e[r][0]+g[0]*o,e[r][1]+g[1]*o])):s.push(e[r])}return s}catch(n){return console.warn("Unclip failed:",n),e}}calculatePolygonArea(e){let t=0;const n=e.length;for(let i=0;i<n;i++){const o=(i+1)%n;t+=e[i][0]*e[o][1],t-=e[o][0]*e[i][1]}return Math.abs(t)/2}calculatePolygonPerimeter(e){let t=0;const n=e.length;for(let i=0;i<n;i++){const o=(i+1)%n,s=e[o][0]-e[i][0],a=e[o][1]-e[i][1];t+=Math.sqrt(s*s+a*a)}return t}getMiniBoxes(e){const t=[...e];let n=1/0,i=1/0,o=-1/0,s=-1/0;for(const[a,r]of t)n=Math.min(n,a),i=Math.min(i,r),o=Math.max(o,a),s=Math.max(s,r);return[[n,i],[o,i],[o,s],[n,s]]}calculateBoxArea(e){const[t,n,i,o]=e;return Math.abs(t[0]*n[1]-n[0]*t[1]+(n[0]*i[1]-i[0]*n[1])+(i[0]*o[1]-o[0]*i[1])+(o[0]*t[1]-t[0]*o[1]))/2}sortedBoxes(e){return e.sort((t,n)=>{const i=Math.min(...t.map(s=>s[1])),o=Math.min(...n.map(s=>s[1]));if(Math.abs(i-o)<10){const s=Math.min(...t.map(r=>r[0])),a=Math.min(...n.map(r=>r[0]));return s-a}return i-o})}getRotateCropImage(e,t){const n=e.canvas||e,i=t.map(f=>f[0]),o=t.map(f=>f[1]),s=Math.max(0,Math.min(...i)),a=Math.min(n.width,Math.max(...i)),r=Math.max(0,Math.min(...o)),c=Math.min(n.height,Math.max(...o)),h=a-s,d=c-r,u=document.createElement("canvas");return u.width=h,u.height=d,u.getContext("2d").drawImage(n,s,r,h,d,0,0,h,d),u}rotateImage(e,t){if(t===0)return e;const n=document.createElement("canvas"),i=n.getContext("2d");return t===180?(n.width=e.width,n.height=e.height,i.translate(e.width,e.height),i.rotate(Math.PI)):t===90?(n.width=e.height,n.height=e.width,i.translate(e.height,0),i.rotate(Math.PI/2)):t===270&&(n.width=e.height,n.height=e.width,i.translate(0,e.width),i.rotate(-Math.PI/2)),i.drawImage(e,0,0),n}async textClassifier(e){if(!this.clsSession)return e.map(()=>({label:"0",confidence:1}));const t=[],n=8;for(let i=0;i<e.length;i+=n){const o=e.slice(i,i+n),s=await this.classifyBatch(o);t.push(...s)}return t}async classifyBatch(e){const t=[];for(const f of e){const g=this.resizeNormImg(f,[3,48,192]);t.push(g)}const n=t.length,[i,o,s]=[3,48,192],a=new Float32Array(n*i*o*s);for(let f=0;f<n;f++){const g=f*i*o*s;a.set(t[f],g)}const c={x:new ee("float32",a,[n,i,o,s])},h=await this.clsSession.run(c),d=this.clsSession.outputNames[0],u=h[d],m=[];for(let f=0;f<n;f++){const g=u.data.slice(f*2,(f+1)*2),v=g[1]>g[0]?"180":"0",P=Math.max(...g);m.push({label:v,confidence:P})}return m}async textRecognizer(e){const t=performance.now(),n=[],i=this.recBatchNum;for(let o=0;o<e.length;o+=i){const s=e.slice(o,o+i),a=await this.recognizeBatch(s);n.push(...a)}return this.recordMetric("recognition",performance.now()-t),n}async recognizeBatch(e){const t=[],n=6.666666666666667;for(const g of e){const v=this.resizeNormImg(g,this.modelConfig.rec_image_shape,n);t.push(v)}const i=t.length,[o,s,a]=this.modelConfig.rec_image_shape,r=a,c=new Float32Array(i*o*s*r);for(let g=0;g<i;g++){const v=g*o*s*r;c.set(t[g],v)}const d={x:new ee("float32",c,[i,o,s,r])},u=await this.recSession.run(d),m=this.recSession.outputNames[0],f=u[m];return this.decodeRecognitionBatch(f,i)}resizeNormImg(e,t,n=null){const[i,o,s]=t,a=e.canvas||e,r=a.height,h=a.width/r;let d;n&&Math.ceil(o*h)>s?d=s:d=Math.min(s,Math.ceil(o*h));const u=document.createElement("canvas");u.width=d,u.height=o;const m=u.getContext("2d");m.drawImage(a,0,0,d,o);const g=m.getImageData(0,0,d,o).data,v=this.modelConfig.preprocessing.rec.mean,P=this.modelConfig.preprocessing.rec.std,x=new Float32Array(i*o*s);for(let I=0;I<i;I++)for(let E=0;E<o;E++){for(let O=0;O<d;O++){const F=(E*d+O)*4+I,z=I*o*s+E*s+O,A=g[F]/255;x[z]=(A-v[I])/P[I]}for(let O=d;O<s;O++){const F=I*o*s+E*s+O;x[F]=(0-v[I])/P[I]}}return x}decodeRecognitionBatch(e,t){const n=[],[i,o,s]=e.dims,a=e.data;for(let r=0;r<t;r++){const c=r*o*s,h=a.slice(c,c+o*s),d=[];let u=-1,m=0,f=0;for(let P=0;P<o;P++){let x=0,I=h[P*s];for(let E=1;E<s;E++){const O=h[P*s+E];O>I&&(I=O,x=E)}x!==0&&x!==u&&x<this.dictionary.length&&(d.push(this.dictionary[x]),m+=I,f++),u=x}const g=d.join(""),v=f>0?m/f:0;n.push([g,v])}return n}formatResults(e){const t=[];for(const n of e)t.push({text:n.text,confidence:n.confidence,box:n.box});return t}async blobToImage(e){return new Promise((t,n)=>{const i=new Image;i.onload=()=>{URL.revokeObjectURL(i.src),t(i)},i.onerror=n,i.src=URL.createObjectURL(e)})}async imageToCv(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),{canvas:t,width:e.width,height:e.height}}recordMetric(e,t){this.performanceMetrics[e].count++,this.performanceMetrics[e].totalTime+=t}getPerformanceReport(){const e={};for(const[t,n]of Object.entries(this.performanceMetrics))n.count>0&&(e[t]={avgTime:(n.totalTime/n.count).toFixed(2),totalTime:n.totalTime.toFixed(2),count:n.count});return e}setModel(e){Xe[e]&&e!==this.modelName&&(this.modelName=e,this.initialized=!1,console.log(`Switched to ${e} model. Re-initialization required.`))}}const ge=new vt;class He{static async resizeImage(e,t,n){const i=document.createElement("canvas"),o=i.getContext("2d"),s=new Image,a=new Blob([e],{type:"image/png"}),r=URL.createObjectURL(a);return new Promise((c,h)=>{s.onload=()=>{i.width=t,i.height=n,o.drawImage(s,0,0,t,n);const d=o.getImageData(0,0,t,n);URL.revokeObjectURL(r),c(d)},s.onerror=h,s.src=r})}static canvasToImageData(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}static normalizeImageData(e,t=[.485,.456,.406],n=[.229,.224,.225]){const i=e.data,o=new Float32Array(i.length);for(let s=0;s<i.length;s+=4)o[s]=(i[s]/255-t[0])/n[0],o[s+1]=(i[s+1]/255-t[1])/n[1],o[s+2]=(i[s+2]/255-t[2])/n[2],o[s+3]=i[s+3]/255;return o}static hwcToChw(e,t,n){const o=new Float32Array(3*n*t),s=e.data||e;let a=0;for(let r=0;r<3;r++)for(let c=0;c<n;c++)for(let h=0;h<t;h++)o[a++]=s[(c*t+h)*4+r];return o}}class bt{constructor(e={}){this.limitSideLen=e.det_limit_side_len||960,this.limitType=e.det_limit_type||"min",this.mean=e.mean||[.485,.456,.406],this.std=e.std||[.229,.224,.225],this.scale=e.scale||1/255}async preprocess(e){const t=e.width,n=e.height,{targetWidth:i,targetHeight:o}=this.calculateResizeDimensions(t,n),s=document.createElement("canvas");s.width=i,s.height=o;const a=s.getContext("2d");a.drawImage(e,0,0,i,o);const r=a.getImageData(0,0,i,o),c=this.normalizeImage(r);return{tensor:He.hwcToChw(c,i,o),originalShape:[n,t],resizedShape:[o,i],ratio:[o/n,i/t]}}calculateResizeDimensions(e,t){let n=1;this.limitType==="max"?Math.max(t,e)>this.limitSideLen&&(n=this.limitSideLen/Math.max(t,e)):this.limitType==="min"&&Math.min(t,e)<this.limitSideLen&&(n=this.limitSideLen/Math.min(t,e));let i=Math.round(t*n),o=Math.round(e*n);return i=Math.max(Math.round(i/32)*32,32),o=Math.max(Math.round(o/32)*32,32),{targetWidth:o,targetHeight:i}}normalizeImage(e){const t=e.data,n=new Float32Array(t.length/4*3);let i=0;for(let o=0;o<t.length;o+=4)n[i++]=(t[o]*this.scale-this.mean[0])/this.std[0],n[i++]=(t[o+1]*this.scale-this.mean[1])/this.std[1],n[i++]=(t[o+2]*this.scale-this.mean[2])/this.std[2];return n}}class Pt{constructor(e={}){this.imageShape=e.cls_image_shape||[3,48,192]}async preprocess(e){const[t,n,i]=this.imageShape,o=e.width,s=e.height,a=o/s;let r=Math.ceil(n*a);r>i&&(r=i);const c=document.createElement("canvas");c.width=r,c.height=n,c.getContext("2d").drawImage(e,0,0,r,n);const d=document.createElement("canvas");d.width=i,d.height=n;const u=d.getContext("2d");u.fillStyle="black",u.fillRect(0,0,i,n),u.drawImage(c,0,0);const m=u.getImageData(0,0,i,n),f=this.normalizeImage(m);return He.hwcToChw(f,i,n)}normalizeImage(e){const t=e.data,n=new Float32Array(t.length/4*3);let i=0;for(let o=0;o<t.length;o+=4)n[i++]=(t[o]/255-.5)/.5,n[i++]=(t[o+1]/255-.5)/.5,n[i++]=(t[o+2]/255-.5)/.5;return n}}class Ot{constructor(e={}){this.imageShape=e.rec_image_shape||[3,48,320],this.recAlgorithm=e.rec_algorithm||"SVTR_LCNet"}async preprocess(e,t=null){const[n,i,o]=this.imageShape,s=e.width,a=e.height;t||(t=s/a);let r=Math.round(i*t);this.recAlgorithm==="NRTR"||this.recAlgorithm==="ViTSTR"?r=o:r=Math.min(r,o);const c=s/a;let h=Math.ceil(i*c);h>r&&(h=r);const d=document.createElement("canvas");d.width=h,d.height=i,d.getContext("2d").drawImage(e,0,0,h,i);const m=document.createElement("canvas");m.width=r,m.height=i;const f=m.getContext("2d");f.fillStyle="black",f.fillRect(0,0,r,i),f.drawImage(d,0,0);const g=f.getImageData(0,0,r,i),v=this.normalizeImage(g);return{tensor:He.hwcToChw(v,r,i),shape:[1,n,i,r]}}normalizeImage(e){const t=e.data,n=new Float32Array(t.length/4*3);let i=0;for(let o=0;o<t.length;o+=4)n[i++]=(t[o]/255-.5)/.5,n[i++]=(t[o+1]/255-.5)/.5,n[i++]=(t[o+2]/255-.5)/.5;return n}}class It{static extractRegion(e,t){const n=this.sortPoints(t),i=Math.max(this.distance(n[0],n[1]),this.distance(n[3],n[2])),o=Math.max(this.distance(n[0],n[3]),this.distance(n[1],n[2])),s=document.createElement("canvas");s.width=Math.round(i),s.height=Math.round(o);const a=s.getContext("2d"),r=n,c=[[0,0],[i,0],[i,o],[0,o]];a.save();const h=document.createElement("canvas");h.width=e.width,h.height=e.height,h.getContext("2d").drawImage(e,0,0),a.beginPath(),a.moveTo(0,0),a.lineTo(i,0),a.lineTo(i,o),a.lineTo(0,o),a.closePath(),a.clip();const u=this.getPerspectiveTransform(r,c,i,o);if(a.setTransform(u.a,u.b,u.c,u.d,u.e,u.f),a.drawImage(e,0,0),a.restore(),o>i*1.5){const m=document.createElement("canvas");m.width=s.height,m.height=s.width;const f=m.getContext("2d");return f.translate(m.width/2,m.height/2),f.rotate(Math.PI/2),f.drawImage(s,-s.width/2,-s.height/2),m}return s}static sortPoints(e){const t=e.reduce((a,r)=>[a[0]+r[0]/e.length,a[1]+r[1]/e.length],[0,0]),n=e.slice().sort((a,r)=>{const c=Math.atan2(a[1]-t[1],a[0]-t[0]),h=Math.atan2(r[1]-t[1],r[0]-t[0]);return c-h});let i=0,o=n[0][0]+n[0][1];for(let a=1;a<n.length;a++){const r=n[a][0]+n[a][1];r<o&&(o=r,i=a)}const s=[];for(let a=0;a<n.length;a++)s.push(n[(i+a)%n.length]);return s}static distance(e,t){const n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}static getPerspectiveTransform(e,t,n,i){const o=n/(e[1][0]-e[0][0]),s=i/(e[3][1]-e[0][1]);return{a:o,b:0,c:0,d:s,e:-e[0][0]*o,f:-e[0][1]*s}}}class Mt{constructor(e={}){this.thresh=e.thresh||.3,this.boxThresh=e.box_thresh||.6,this.maxCandidates=e.max_candidates||1e3,this.unclipRatio=e.unclip_ratio||1.5,this.minSize=e.min_size||3,this.scoreMode=e.score_mode||"fast"}process(e,t){const n=e[0],i=t[0],o=this.threshold(n),s=this.findContours(o),a=[],r=[];for(const c of s){if(c.length<4)continue;const h=this.getMinAreaRect(c);if(!h)continue;const d=this.boxScore(n,h);if(d<this.boxThresh)continue;const u=this.unclip(h);if(!u)continue;const m=this.rescaleBox(u,i);this.validateBox(m)&&(a.push(m),r.push(d))}return{boxes:a,scores:r}}threshold(e){const t=e.length,n=e[0].length,i=[];for(let o=0;o<t;o++){i[o]=[];for(let s=0;s<n;s++)i[o][s]=e[o][s]>this.thresh?1:0}return i}findContours(e){const t=e.length,n=e[0].length,i=Array(t).fill(null).map(()=>Array(n).fill(!1)),o=[];for(let s=0;s<t;s++)for(let a=0;a<n;a++)if(e[s][a]===1&&!i[s][a]){const r=this.traceContour(e,i,s,a);r.length>=4&&o.push(r)}return o}traceContour(e,t,n,i){const o=e.length,s=e[0].length,a=[],r=[[n,i]],c=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(;r.length>0;){const[h,d]=r.shift();if(t[h][d])continue;t[h][d]=!0;let u=!1;for(const[m,f]of c){const g=h+m,v=d+f;if(g<0||g>=o||v<0||v>=s||e[g][v]===0){u=!0;break}}u&&a.push([d,h]);for(const[m,f]of c){const g=h+m,v=d+f;g>=0&&g<o&&v>=0&&v<s&&e[g][v]===1&&!t[g][v]&&r.push([g,v])}}return a}getMinAreaRect(e){if(e.length<4)return null;const t=this.convexHull(e);if(t.length<4)return null;let n=1/0,i=null;for(let o=0;o<t.length;o++){const s=t[o],a=t[(o+1)%t.length],r=[a[0]-s[0],a[1]-s[1]],c=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(c===0)continue;r[0]/=c,r[1]/=c;let h=1/0,d=-1/0,u=1/0,m=-1/0;for(const P of t){const x=(P[0]-s[0])*r[0]+(P[1]-s[1])*r[1],I=(P[0]-s[0])*-r[1]+(P[1]-s[1])*r[0];h=Math.min(h,x),d=Math.max(d,x),u=Math.min(u,I),m=Math.max(m,I)}const f=d-h,g=m-u,v=f*g;if(v<n){n=v;const P=[s[0]+h*r[0]+u*-r[1],s[1]+h*r[1]+u*r[0]],x=[s[0]+d*r[0]+u*-r[1],s[1]+d*r[1]+u*r[0]],I=[s[0]+d*r[0]+m*-r[1],s[1]+d*r[1]+m*r[0]],E=[s[0]+h*r[0]+m*-r[1],s[1]+h*r[1]+m*r[0]];i=[P,x,I,E]}}return i}convexHull(e){if(e.length<3)return e;let t=0;for(let s=1;s<e.length;s++)(e[s][1]<e[t][1]||e[s][1]===e[t][1]&&e[s][0]<e[t][0])&&(t=s);const n=e.slice(),i=n.splice(t,1)[0];n.sort((s,a)=>{const r=Math.atan2(s[1]-i[1],s[0]-i[0]),c=Math.atan2(a[1]-i[1],a[0]-i[0]);if(r!==c)return r-c;const h=(s[0]-i[0])*(s[0]-i[0])+(s[1]-i[1])*(s[1]-i[1]),d=(a[0]-i[0])*(a[0]-i[0])+(a[1]-i[1])*(a[1]-i[1]);return h-d});const o=[i];for(const s of n){for(;o.length>=2;){const a=o[o.length-2],r=o[o.length-1];if((r[0]-a[0])*(s[1]-a[1])-(r[1]-a[1])*(s[0]-a[0])<=0)o.pop();else break}o.push(s)}return o}boxScore(e,t){const n=Math.min(...t.map(c=>c[0])),i=Math.max(...t.map(c=>c[0])),o=Math.min(...t.map(c=>c[1])),s=Math.max(...t.map(c=>c[1]));let a=0,r=0;for(let c=Math.floor(o);c<=Math.ceil(s);c++)for(let h=Math.floor(n);h<=Math.ceil(i);h++)c>=0&&c<e.length&&h>=0&&h<e[0].length&&this.pointInPolygon([h,c],t)&&(a+=e[c][h],r++);return r>0?a/r:0}pointInPolygon(e,t){let n=!1;const i=e[0],o=e[1];for(let s=0,a=t.length-1;s<t.length;a=s++){const r=t[s][0],c=t[s][1],h=t[a][0],d=t[a][1];c>o!=d>o&&i<(h-r)*(o-c)/(d-c)+r&&(n=!n)}return n}unclip(e){let t=0;for(let s=0;s<e.length;s++){const a=(s+1)%e.length,r=e[a][0]-e[s][0],c=e[a][1]-e[s][1];t+=Math.sqrt(r*r+c*c)}let n=0;for(let s=0;s<e.length;s++){const a=(s+1)%e.length;n+=e[s][0]*e[a][1]-e[a][0]*e[s][1]}n=Math.abs(n)/2;const i=n*this.unclipRatio/t,o=[];for(let s=0;s<e.length;s++){const a=e[(s-1+e.length)%e.length],r=e[s],c=e[(s+1)%e.length],h=[a[0]-r[0],a[1]-r[1]],d=[c[0]-r[0],c[1]-r[1]],u=Math.sqrt(h[0]*h[0]+h[1]*h[1]),m=Math.sqrt(d[0]*d[0]+d[1]*d[1]);u>0&&(h[0]/=u,h[1]/=u),m>0&&(d[0]/=m,d[1]/=m);const f=[h[0]+d[0],h[1]+d[1]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]);g>0?(f[0]/=g,f[1]/=g,o.push([r[0]-f[0]*i,r[1]-f[1]*i])):o.push(r)}return o}rescaleBox(e,t){const[n,i,o,s]=t;return e.map(a=>[a[0]/s,a[1]/o])}validateBox(e){const t=Math.max(this.distance(e[0],e[1]),this.distance(e[2],e[3])),n=Math.max(this.distance(e[0],e[3]),this.distance(e[1],e[2]));return t>=this.minSize&&n>=this.minSize}distance(e,t){const n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}}class Et{constructor(e={}){this.labelList=e.label_list||["0","180"],this.clsThresh=e.cls_thresh||.9}process(e){const t=[],n=e[0];for(let i=0;i<n.length;i++){const o=n[i],s=o.indexOf(Math.max(...o)),a=o[s],r=this.labelList[s];t.push({label:r,score:a,shouldRotate:r==="180"&&a>this.clsThresh})}return t}}class Rt{constructor(e){this.characterDict=e,this.blankIdx=e.length}decode(e,t="greedy"){if(t==="greedy")return this.greedyDecode(e);if(t==="beam_search")return this.beamSearchDecode(e);throw new Error(`Unknown decode method: ${t}`)}greedyDecode(e){const t=[];for(const n of e){const i=[];let o=-1;for(let r=0;r<n.length;r++){const c=n[r].indexOf(Math.max(...n[r]));c!==this.blankIdx&&c!==o&&i.push(c),o=c}const s=i.map(r=>this.characterDict[r]).join(""),a=this.calculateConfidence(n,i);t.push({text:s,confidence:a})}return t}beamSearchDecode(e,t=5){const n=[];for(const i of e){const s=this.beamSearch(i,t)[0];n.push({text:s.text,confidence:s.score})}return n}beamSearch(e,t){let n=[{text:"",score:1,lastIdx:-1}];for(let i=0;i<e.length;i++){const o=[];for(const s of n){const a=e[i],r=this.getTopK(a,t);for(const[c,h]of r)c===this.blankIdx?o.push({text:s.text,score:s.score*h,lastIdx:c}):c!==s.lastIdx?o.push({text:s.text+this.characterDict[c],score:s.score*h,lastIdx:c}):o.push({text:s.text,score:s.score*h,lastIdx:c})}o.sort((s,a)=>a.score-s.score),n=o.slice(0,t)}return n}getTopK(e,t){const n=e.map((i,o)=>[o,i]);return n.sort((i,o)=>o[1]-i[1]),n.slice(0,t)}calculateConfidence(e,t){if(t.length===0)return 0;let n=0,i=0;for(const o of t)for(;i<e.length;){if(e[i].indexOf(Math.max(...e[i]))===o){n+=e[i][o],i++;break}i++}return n/t.length}}function Ct(l){if(!l||l.length===0)return[];const e=l.map((t,n)=>{const i=t.reduce((s,a)=>s+a[0],0)/t.length,o=t.reduce((s,a)=>s+a[1],0)/t.length;return{box:t,index:n,centerX:i,centerY:o}});return e.sort((t,n)=>Math.abs(t.centerY-n.centerY)<10?t.centerX-n.centerX:t.centerY-n.centerY),e.map(t=>t.box)}var st={exports:{}};/*! store2 - v2.14.4 - 2024-12-26
* Copyright (c) 2024 Nathan Bubna; Licensed MIT */(function(l){(function(e,t){var n={version:"2.14.4",areas:{},apis:{},nsdelim:".",inherit:function(o,s){for(var a in o)s.hasOwnProperty(a)||Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(o,a));return s},stringify:function(o,s){return o===void 0||typeof o=="function"?o+"":JSON.stringify(o,s||n.replace)},parse:function(o,s){try{return JSON.parse(o,s||n.revive)}catch{return o}},fn:function(o,s){n.storeAPI[o]=s;for(var a in n.apis)n.apis[a][o]=s},get:function(o,s){return o.getItem(s)},set:function(o,s,a){o.setItem(s,a)},remove:function(o,s){o.removeItem(s)},key:function(o,s){return o.key(s)},length:function(o){return o.length},clear:function(o){o.clear()},Store:function(o,s,a){var r=n.inherit(n.storeAPI,function(h,d,u){return arguments.length===0?r.getAll():typeof d=="function"?r.transact(h,d,u):d!==void 0?r.set(h,d,u):typeof h=="string"||typeof h=="number"?r.get(h):typeof h=="function"?r.each(h):h?r.setAll(h,d):r.clear()});r._id=o;try{var c="__store2_test";s.setItem(c,"ok"),r._area=s,s.removeItem(c)}catch{r._area=n.storage("fake")}return r._ns=a||"",n.areas[o]||(n.areas[o]=r._area),n.apis[r._ns+r._id]||(n.apis[r._ns+r._id]=r),r},storeAPI:{area:function(o,s){var a=this[o];return(!a||!a.area)&&(a=n.Store(o,s,this._ns),this[o]||(this[o]=a)),a},namespace:function(o,s,a){if(a=a||this._delim||n.nsdelim,!o)return this._ns?this._ns.substring(0,this._ns.length-a.length):"";var r=o,c=this[r];if((!c||!c.namespace)&&(c=n.Store(this._id,this._area,this._ns+r+a),c._delim=a,this[r]||(this[r]=c),!s))for(var h in n.areas)c.area(h,n.areas[h]);return c},isFake:function(o){return o?(this._real=this._area,this._area=n.storage("fake")):o===!1&&(this._area=this._real||this._area),this._area.name==="fake"},toString:function(){return"store"+(this._ns?"."+this.namespace():"")+"["+this._id+"]"},has:function(o){return this._area.has?this._area.has(this._in(o)):this._in(o)in this._area},size:function(){return this.keys().length},each:function(o,s){for(var a=0,r=n.length(this._area);a<r;a++){var c=this._out(n.key(this._area,a));if(c!==void 0&&o.call(this,c,this.get(c),s)===!1)break;r>n.length(this._area)&&(r--,a--)}return s||this},keys:function(o){return this.each(function(s,a,r){r.push(s)},o||[])},get:function(o,s){var a=n.get(this._area,this._in(o)),r;return typeof s=="function"&&(r=s,s=null),a!==null?n.parse(a,r):s??a},getAll:function(o){return this.each(function(s,a,r){r[s]=a},o||{})},transact:function(o,s,a){var r=this.get(o,a),c=s(r);return this.set(o,c===void 0?r:c),this},set:function(o,s,a){var r=this.get(o),c;return r!=null&&a===!1?s:(typeof a=="function"&&(c=a,a=void 0),n.set(this._area,this._in(o),n.stringify(s,c),a)||r)},setAll:function(o,s){var a,r;for(var c in o)r=o[c],this.set(c,r,s)!==r&&(a=!0);return a},add:function(o,s,a){var r=this.get(o);if(r instanceof Array)s=r.concat(s);else if(r!==null){var c=typeof r;if(c===typeof s&&c==="object"){for(var h in s)r[h]=s[h];s=r}else s=r+s}return n.set(this._area,this._in(o),n.stringify(s,a)),s},remove:function(o,s){var a=this.get(o,s);return n.remove(this._area,this._in(o)),a},clear:function(){return this._ns?this.each(function(o){n.remove(this._area,this._in(o))},1):n.clear(this._area),this},clearAll:function(){var o=this._area;for(var s in n.areas)n.areas.hasOwnProperty(s)&&(this._area=n.areas[s],this.clear());return this._area=o,this},_in:function(o){return typeof o!="string"&&(o=n.stringify(o)),this._ns?this._ns+o:o},_out:function(o){return this._ns?o&&o.indexOf(this._ns)===0?o.substring(this._ns.length):void 0:o}},storage:function(o){return n.inherit(n.storageAPI,{items:{},name:o})},storageAPI:{length:0,has:function(o){return this.items.hasOwnProperty(o)},key:function(o){var s=0;for(var a in this.items)if(this.has(a)&&o===s++)return a},setItem:function(o,s){this.has(o)||this.length++,this.items[o]=s},removeItem:function(o){this.has(o)&&(delete this.items[o],this.length--)},getItem:function(o){return this.has(o)?this.items[o]:null},clear:function(){for(var o in this.items)this.removeItem(o)}}},i=n.Store("local",function(){try{return localStorage}catch{}}());i.local=i,i._=n,i.area("session",function(){try{return sessionStorage}catch{}}()),i.area("page",n.storage("page")),typeof t=="function"&&t.amd!==void 0?t("store2",[],function(){return i}):l.exports?l.exports=i:(e.store&&(n.conflict=e.store),e.store=i)})(Te,Te&&Te.define)})(st);var St=st.exports;const Lt=it(St);class Tt{constructor(e={}){this.namespace=e.namespace||"ocr-cache",this.maxCacheSize=e.maxCacheSize||50*1024*1024,this.maxAge=e.maxAge||7*24*60*60*1e3,this.store=Lt.namespace(this.namespace),this.store.get("metadata")||this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}}),this.cleanupOldEntries()}generateCacheKey(e,t,n){const o=`${typeof e=="string"?e:JSON.stringify(e)}-${t}-${n}`;let s=0;for(let a=0;a<o.length;a++){const r=o.charCodeAt(a);s=(s<<5)-s+r,s=s&s}return`ocr-${Math.abs(s).toString(36)}`}get(e,t,n){const i=this.generateCacheKey(e,t,n),o=this.store.get(i);return o?Date.now()-o.timestamp>this.maxAge?(this.remove(i),null):(o.lastAccessed=Date.now(),this.store.set(i,o),o.data):null}set(e,t,n,i){const o=this.generateCacheKey(e,t,n),s=JSON.stringify(i),a=new Blob([s]).size;this.ensureCacheSpace(a);const r={timestamp:Date.now(),lastAccessed:Date.now(),engineType:t,modelVersion:n,size:a,data:i},c=this.store.get("metadata");return c.totalSize+=a,c.entries[o]={size:a,timestamp:r.timestamp},this.store.set("metadata",c),this.store.set(o,r),o}remove(e){if(this.store.get(e)){const n=this.store.get("metadata");n.entries[e]&&(n.totalSize-=n.entries[e].size,delete n.entries[e],this.store.set("metadata",n)),this.store.remove(e)}}clear(){this.store.keys().forEach(t=>{t!=="metadata"&&this.store.remove(t)}),this.store.set("metadata",{version:"1.0",created:Date.now(),totalSize:0,entries:{}})}getStats(){const e=this.store.get("metadata"),t=Object.keys(e.entries).length;return{totalSize:e.totalSize,maxSize:this.maxCacheSize,usagePercent:e.totalSize/this.maxCacheSize*100,entries:t,oldestEntry:this.getOldestEntry(),newestEntry:this.getNewestEntry()}}cleanupOldEntries(){const e=Date.now(),t=this.store.get("metadata"),n=[];Object.entries(t.entries).forEach(([i,o])=>{e-o.timestamp>this.maxAge&&n.push(i)}),n.forEach(i=>this.remove(i))}ensureCacheSpace(e){const t=this.store.get("metadata");if(t.totalSize+e<=this.maxCacheSize)return;const n=Object.entries(t.entries).sort((o,s)=>o[1].timestamp-s[1].timestamp);let i=t.totalSize;for(const[o]of n){if(i+e<=this.maxCacheSize)break;const s=this.store.get(o);s&&(i-=s.size,this.remove(o))}}getOldestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([n,i])=>{(!t||i.timestamp<t.timestamp)&&(t={key:n,...i})}),t}getNewestEntry(){const e=this.store.get("metadata");let t=null;return Object.entries(e.entries).forEach(([n,i])=>{(!t||i.timestamp>t.timestamp)&&(t={key:n,...i})}),t}export(){const e={metadata:this.store.get("metadata"),entries:{}};return this.store.keys().forEach(t=>{t!=="metadata"&&(e.entries[t]=this.store.get(t))}),e}import(e){if(!e||!e.metadata)throw new Error("Invalid cache data format");this.clear(),this.store.set("metadata",e.metadata),Object.entries(e.entries).forEach(([t,n])=>{this.store.set(t,n)})}}const Me=new Tt;G.wasm.wasmPaths="/public/assets/";G.wasm.numThreads=1;class zt{constructor(e={}){this.modelName=e.modelName||"PP-OCRv5",this.useAngleCls=e.useAngleCls!==!1,this.useCache=e.useCache!==!1,this.modelPaths={"PP-OCRv5":{det:"/public/models/PP-OCRv5/det/det.onnx",cls:"/public/models/PP-OCRv5/cls/cls.onnx",rec:"/public/models/PP-OCRv5/rec/rec.onnx",dict:"/public/models/PP-OCRv5/ppocrv5_dict.txt"},"PP-OCRv5_mobile":{det:"/public/models/PP-OCRv5_mobile_det_infer.onnx",cls:"/public/models/PP-OCRv5/cls/cls.onnx",rec:"/public/models/PP-OCRv5_mobile_rec_infer.onnx",dict:"/public/models/ppocrv5_dict.txt"},"PP-OCRv4":{det:"/public/models/PP-OCRv4/det/det.onnx",cls:"/public/models/PP-OCRv4/cls/cls.onnx",rec:"/public/models/PP-OCRv4/rec/rec.onnx",dict:"/public/models/PP-OCRv4/ppocr_keys_v1.txt"},"PP-OCRv4_mobile":{det:"/public/models/PP-OCRv4/det/det.onnx",cls:"/public/models/PP-OCRv4/cls/cls.onnx",rec:"/public/models/en_PP-OCRv4_mobile_rec_infer.onnx",dict:"/public/models/en_dict.txt"},"ch_ppocr_server_v2.0":{det:"/public/models/ch_ppocr_server_v2.0/det/det.onnx",cls:"/public/models/ch_ppocr_server_v2.0/cls/cls.onnx",rec:null,dict:"/public/models/ch_ppocr_server_v2.0/ppocr_keys_v1.txt"}},this.detParams={det_limit_side_len:e.detLimitSideLen||960,det_limit_type:e.detLimitType||"min",det_db_thresh:e.detDbThresh||.3,det_db_box_thresh:e.detDbBoxThresh||.6,det_db_unclip_ratio:e.detDbUnclipRatio||1.7,det_db_score_mode:e.detDbScoreMode||"fast"},this.clsParams={cls_image_shape:[3,48,192],cls_thresh:e.clsThresh||.9,label_list:["0","180"]},this.recParams={rec_image_shape:[3,48,320],rec_algorithm:"SVTR_LCNet"},this.detPreprocessor=new bt(this.detParams),this.clsPreprocessor=new Pt(this.clsParams),this.recPreprocessor=new Ot(this.recParams),this.detPostprocessor=new Mt({thresh:this.detParams.det_db_thresh,box_thresh:this.detParams.det_db_box_thresh,unclip_ratio:this.detParams.det_db_unclip_ratio,score_mode:this.detParams.det_db_score_mode}),this.clsPostprocessor=new Et(this.clsParams),this.detSession=null,this.clsSession=null,this.recSession=null,this.characterDict=null,this.ctcDecoder=null,this.initialized=!1}async initialize(e=null){if(!this.initialized)try{const t=this.modelPaths[this.modelName];if(!t)throw new Error(`Unknown model: ${this.modelName}`);if(e==null||e("Loading character dictionary..."),await this.loadCharacterDict(t.dict),e==null||e("Loading detection model..."),this.detSession=await J.create(t.det,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),this.useAngleCls&&(e==null||e("Loading angle classification model..."),this.clsSession=await J.create(t.cls,{executionProviders:["wasm"],graphOptimizationLevel:"all"})),t.rec)e==null||e("Loading recognition model..."),this.recSession=await J.create(t.rec,{executionProviders:["wasm"],graphOptimizationLevel:"all"});else if(this.modelName==="ch_ppocr_server_v2.0"){const n="/public/models/PP-OCRv4/rec/rec.onnx";e==null||e("Loading recognition model (fallback)..."),this.recSession=await J.create(n,{executionProviders:["wasm"],graphOptimizationLevel:"all"})}this.initialized=!0,e==null||e("Initialization complete!")}catch(t){throw console.error("Failed to initialize PP-OCRv5 ONNX engine:",t),t}}async loadCharacterDict(e){try{const n=await(await fetch(e)).text();this.characterDict=n.split(`
`).filter(i=>i.length>0),this.ctcDecoder=new Rt(this.characterDict)}catch(t){throw console.error("Failed to load character dictionary:",t),t}}async process(e,t=null){if(this.initialized||await this.initialize(t),this.useCache){const c=await this.checkCache(e);if(c)return t==null||t("Using cached result"),c}const n=await this.inputToCanvas(e);t==null||t("Detecting text regions...");const i=await this.detectText(n);if(!i||i.boxes.length===0)return{text:"",boxes:[],lines:[]};const o=Ct(i.boxes),s=[];for(let c=0;c<o.length;c++){t==null||t(`Processing region ${c+1}/${o.length}...`);const h=o[c],d=It.extractRegion(n,h);let u=0;if(this.useAngleCls&&this.clsSession&&(await this.classifyAngle(d)).shouldRotate){const g=this.rotateCanvas(d,180);d.width=g.width,d.height=g.height,d.getContext("2d").drawImage(g,0,0),u=180}const m=await this.recognizeText(d);s.push({box:h,text:m.text,confidence:m.confidence,angle:u})}const r={text:s.map(c=>c.text).join(`
`),boxes:o,lines:s,modelName:this.modelName};return this.useCache&&await this.cacheResult(e,r),r}async detectText(e){const t=await this.detPreprocessor.preprocess(e),i={x:new ee("float32",t.tensor,[1,3,t.resizedShape[0],t.resizedShape[1]])},o=await this.detSession.run(i),s=o.sigmoid_0||o.save_infer_model_scale_0_tmp_1||Object.values(o)[0],a=s.data,[,,r,c]=s.dims,h=[];for(let u=0;u<r;u++){h[u]=[];for(let m=0;m<c;m++)h[u][m]=a[u*c+m]}return this.detPostprocessor.process([h],[t.originalShape.concat(t.ratio)])}async classifyAngle(e){const t=await this.clsPreprocessor.preprocess(e),i={x:new ee("float32",t,[1,...this.clsParams.cls_image_shape])},o=await this.clsSession.run(i),s=o.save_infer_model_scale_0_tmp_1||Object.values(o)[0],a=Array.from(s.data);return this.clsPostprocessor.process([a])[0]}async recognizeText(e){if(!this.recSession)return{text:"",confidence:0};const t=e.width/e.height,n=await this.recPreprocessor.preprocess(e,t),o={x:new ee("float32",n.tensor,n.shape)},s=await this.recSession.run(o),a=s.save_infer_model_scale_0_tmp_1||Object.values(s)[0],[,r,c]=a.dims,h=a.data,d=[];for(let m=0;m<r;m++){const f=[];for(let g=0;g<c;g++)f.push(h[m*c+g]);d.push(f)}return this.ctcDecoder.decode([d],"greedy")[0]}async inputToCanvas(e){if(e instanceof HTMLCanvasElement)return e;const t=document.createElement("canvas"),n=t.getContext("2d");if(e instanceof File||e instanceof Blob){const i=new Image,o=URL.createObjectURL(e);return new Promise((s,a)=>{i.onload=()=>{t.width=i.width,t.height=i.height,n.drawImage(i,0,0),URL.revokeObjectURL(o),s(t)},i.onerror=a,i.src=o})}else if(typeof e=="string"){const i=new Image;return i.crossOrigin="anonymous",new Promise((o,s)=>{i.onload=()=>{t.width=i.width,t.height=i.height,n.drawImage(i,0,0),o(t)},i.onerror=s,i.src=e})}throw new Error("Unsupported input type")}rotateCanvas(e,t){const n=t*Math.PI/180,i=document.createElement("canvas"),o=i.getContext("2d");return t===180?(i.width=e.width,i.height=e.height,o.translate(e.width,e.height),o.rotate(n),o.drawImage(e,0,0)):t===90||t===-270?(i.width=e.height,i.height=e.width,o.translate(e.height,0),o.rotate(n),o.drawImage(e,0,0)):(t===-90||t===270)&&(i.width=e.height,i.height=e.width,o.translate(0,e.width),o.rotate(n),o.drawImage(e,0,0)),i}async checkCache(e){if(!this.useCache)return null;const t=await this.generateCacheKey(e);return Me.get(t,"ppocr-v5-onnx",this.modelName)}async cacheResult(e,t){if(!this.useCache)return;const n=await this.generateCacheKey(e);Me.set(n,"ppocr-v5-onnx",this.modelName,t)}async generateCacheKey(e){return e instanceof File?await this.fileToBase64(e):typeof e=="string"?e:e instanceof HTMLCanvasElement?e.toDataURL():JSON.stringify(e)}async fileToBase64(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=o=>t(o.target.result),i.onerror=n,i.readAsDataURL(e)})}getCacheStats(){return Me.getStats()}clearCache(){Me.clear()}}new zt;var $t={exports:{}};(function(l){var e=function(t){var n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(w,p,y){w[p]=y.value},s,a=typeof Symbol=="function"?Symbol:{},r=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function d(w,p,y){return Object.defineProperty(w,p,{value:y,enumerable:!0,configurable:!0,writable:!0}),w[p]}try{d({},"")}catch{d=function(p,y,M){return p[y]=M}}function u(w,p,y,M){var _=p&&p.prototype instanceof I?p:I,b=Object.create(_.prototype),S=new be(M||[]);return o(b,"_invoke",{value:te(w,y,S)}),b}t.wrap=u;function m(w,p,y){try{return{type:"normal",arg:w.call(p,y)}}catch(M){return{type:"throw",arg:M}}}var f="suspendedStart",g="suspendedYield",v="executing",P="completed",x={};function I(){}function E(){}function O(){}var F={};d(F,r,function(){return this});var z=Object.getPrototypeOf,A=z&&z(z(Pe([])));A&&A!==n&&i.call(A,r)&&(F=A);var U=O.prototype=I.prototype=Object.create(F);E.prototype=O,o(U,"constructor",{value:O,configurable:!0}),o(O,"constructor",{value:E,configurable:!0}),E.displayName=d(O,h,"GeneratorFunction");function _e(w){["next","throw","return"].forEach(function(p){d(w,p,function(y){return this._invoke(p,y)})})}t.isGeneratorFunction=function(w){var p=typeof w=="function"&&w.constructor;return p?p===E||(p.displayName||p.name)==="GeneratorFunction":!1},t.mark=function(w){return Object.setPrototypeOf?Object.setPrototypeOf(w,O):(w.__proto__=O,d(w,h,"GeneratorFunction")),w.prototype=Object.create(U),w},t.awrap=function(w){return{__await:w}};function Y(w,p){function y(b,S,L,T){var $=m(w[b],w,S);if($.type==="throw")T($.arg);else{var de=$.arg,ie=de.value;return ie&&typeof ie=="object"&&i.call(ie,"__await")?p.resolve(ie.__await).then(function(se){y("next",se,L,T)},function(se){y("throw",se,L,T)}):p.resolve(ie).then(function(se){de.value=se,L(de)},function(se){return y("throw",se,L,T)})}}var M;function _(b,S){function L(){return new p(function(T,$){y(b,S,T,$)})}return M=M?M.then(L,L):L()}o(this,"_invoke",{value:_})}_e(Y.prototype),d(Y.prototype,c,function(){return this}),t.AsyncIterator=Y,t.async=function(w,p,y,M,_){_===void 0&&(_=Promise);var b=new Y(u(w,p,y,M),_);return t.isGeneratorFunction(p)?b:b.next().then(function(S){return S.done?S.value:b.next()})};function te(w,p,y){var M=f;return function(b,S){if(M===v)throw new Error("Generator is already running");if(M===P){if(b==="throw")throw S;return Ie()}for(y.method=b,y.arg=S;;){var L=y.delegate;if(L){var T=ne(L,y);if(T){if(T===x)continue;return T}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(M===f)throw M=P,y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);M=v;var $=m(w,p,y);if($.type==="normal"){if(M=y.done?P:g,$.arg===x)continue;return{value:$.arg,done:y.done}}else $.type==="throw"&&(M=P,y.method="throw",y.arg=$.arg)}}}function ne(w,p){var y=p.method,M=w.iterator[y];if(M===s)return p.delegate=null,y==="throw"&&w.iterator.return&&(p.method="return",p.arg=s,ne(w,p),p.method==="throw")||y!=="return"&&(p.method="throw",p.arg=new TypeError("The iterator does not provide a '"+y+"' method")),x;var _=m(M,w.iterator,p.arg);if(_.type==="throw")return p.method="throw",p.arg=_.arg,p.delegate=null,x;var b=_.arg;if(!b)return p.method="throw",p.arg=new TypeError("iterator result is not an object"),p.delegate=null,x;if(b.done)p[w.resultName]=b.value,p.next=w.nextLoc,p.method!=="return"&&(p.method="next",p.arg=s);else return b;return p.delegate=null,x}_e(U),d(U,h,"Generator"),d(U,r,function(){return this}),d(U,"toString",function(){return"[object Generator]"});function ve(w){var p={tryLoc:w[0]};1 in w&&(p.catchLoc=w[1]),2 in w&&(p.finallyLoc=w[2],p.afterLoc=w[3]),this.tryEntries.push(p)}function oe(w){var p=w.completion||{};p.type="normal",delete p.arg,w.completion=p}function be(w){this.tryEntries=[{tryLoc:"root"}],w.forEach(ve,this),this.reset(!0)}t.keys=function(w){var p=Object(w),y=[];for(var M in p)y.push(M);return y.reverse(),function _(){for(;y.length;){var b=y.pop();if(b in p)return _.value=b,_.done=!1,_}return _.done=!0,_}};function Pe(w){if(w){var p=w[r];if(p)return p.call(w);if(typeof w.next=="function")return w;if(!isNaN(w.length)){var y=-1,M=function _(){for(;++y<w.length;)if(i.call(w,y))return _.value=w[y],_.done=!1,_;return _.value=s,_.done=!0,_};return M.next=M}}return{next:Ie}}t.values=Pe;function Ie(){return{value:s,done:!0}}return be.prototype={constructor:be,reset:function(w){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(oe),!w)for(var p in this)p.charAt(0)==="t"&&i.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=s)},stop:function(){this.done=!0;var w=this.tryEntries[0],p=w.completion;if(p.type==="throw")throw p.arg;return this.rval},dispatchException:function(w){if(this.done)throw w;var p=this;function y(T,$){return b.type="throw",b.arg=w,p.next=T,$&&(p.method="next",p.arg=s),!!$}for(var M=this.tryEntries.length-1;M>=0;--M){var _=this.tryEntries[M],b=_.completion;if(_.tryLoc==="root")return y("end");if(_.tryLoc<=this.prev){var S=i.call(_,"catchLoc"),L=i.call(_,"finallyLoc");if(S&&L){if(this.prev<_.catchLoc)return y(_.catchLoc,!0);if(this.prev<_.finallyLoc)return y(_.finallyLoc)}else if(S){if(this.prev<_.catchLoc)return y(_.catchLoc,!0)}else if(L){if(this.prev<_.finallyLoc)return y(_.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(w,p){for(var y=this.tryEntries.length-1;y>=0;--y){var M=this.tryEntries[y];if(M.tryLoc<=this.prev&&i.call(M,"finallyLoc")&&this.prev<M.finallyLoc){var _=M;break}}_&&(w==="break"||w==="continue")&&_.tryLoc<=p&&p<=_.finallyLoc&&(_=null);var b=_?_.completion:{};return b.type=w,b.arg=p,_?(this.method="next",this.next=_.finallyLoc,x):this.complete(b)},complete:function(w,p){if(w.type==="throw")throw w.arg;return w.type==="break"||w.type==="continue"?this.next=w.arg:w.type==="return"?(this.rval=this.arg=w.arg,this.method="return",this.next="end"):w.type==="normal"&&p&&(this.next=p),x},finish:function(w){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.finallyLoc===w)return this.complete(y.completion,y.afterLoc),oe(y),x}},catch:function(w){for(var p=this.tryEntries.length-1;p>=0;--p){var y=this.tryEntries[p];if(y.tryLoc===w){var M=y.completion;if(M.type==="throw"){var _=M.arg;oe(y)}return _}}throw new Error("illegal catch attempt")},delegateYield:function(w,p,y){return this.delegate={iterator:Pe(w),resultName:p,nextLoc:y},this.method==="next"&&(this.arg=s),x}},t}(l.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})($t);var We=(l,e)=>`${l}-${e}-${Math.random().toString(16).slice(3,8)}`;const Nt=We;let Ke=0;var rt=({id:l,action:e,payload:t={}})=>{let n=l;return typeof n>"u"&&(n=Nt("Job",Ke),Ke+=1),{id:n,action:e,payload:t}},ye={};let Ye=!1;ye.logging=Ye;ye.setLogging=l=>{Ye=l};ye.log=(...l)=>Ye?console.log.apply(void 0,l):null;const Ft=rt,{log:Ee}=ye,Dt=We;let Ze=0;var Bt=()=>{const l=Dt("Scheduler",Ze),e={},t={};let n=[];Ze+=1;const i=()=>n.length,o=()=>Object.keys(e).length,s=()=>{if(n.length!==0){const d=Object.keys(e);for(let u=0;u<d.length;u+=1)if(typeof t[d[u]]>"u"){n[0](e[d[u]]);break}}},a=(d,u)=>new Promise((m,f)=>{const g=Ft({action:d,payload:u});n.push(async v=>{n.shift(),t[v.id]=g;try{m(await v[d].apply(void 0,[...u,g.id]))}catch(P){f(P)}finally{delete t[v.id],s()}}),Ee(`[${l}]: Add ${g.id} to JobQueue`),Ee(`[${l}]: JobQueue length=${n.length}`),s()});return{addWorker:d=>(e[d.id]=d,Ee(`[${l}]: Add ${d.id}`),Ee(`[${l}]: Number of workers=${o()}`),s(),d.id),addJob:async(d,...u)=>{if(o()===0)throw Error(`[${l}]: You need to have at least one worker before adding jobs`);return a(d,u)},terminate:async()=>{Object.keys(e).forEach(async d=>{await e[d].terminate()}),n=[]},getQueueLen:i,getNumWorkers:o}};function At(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var jt=At;const Gt=jt;var Ut=l=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":Gt()?e.type="electron":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof pt=="function"&&(e.type="node"),typeof l>"u"?e:e[l]};const Ht=Ut("type")==="browser",Wt=Ht?l=>new URL(l,window.location.href).href:l=>l;var Yt=l=>{const e={...l};return["corePath","workerPath","langPath"].forEach(t=>{l[t]&&(e[t]=Wt(e[t]))}),e},kt=l=>{const e=[],t=[],n=[],i=[],o=[];return l.blocks&&l.blocks.forEach(s=>{s.paragraphs.forEach(a=>{a.lines.forEach(r=>{r.words.forEach(c=>{c.symbols.forEach(h=>{o.push({...h,page:l,block:s,paragraph:a,line:r,word:c})}),i.push({...c,page:l,block:s,paragraph:a,line:r})}),n.push({...r,page:l,block:s,paragraph:a})}),t.push({...a,page:l,block:s})}),e.push({...s,page:l})}),{...l,blocks:e,paragraphs:t,lines:n,words:i,symbols:o}},at={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const qt="5.1.1",Xt={version:qt};var Kt={workerBlobURL:!0,logger:()=>{}};const Zt=Xt.version,Vt=Kt;var Jt={...Vt,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Zt}/dist/worker.min.js`},Qt=({workerPath:l,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const n=new Blob([`importScripts("${l}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(n))}else t=new Worker(l);return t},en=l=>{l.terminate()},tn=(l,e)=>{l.onmessage=({data:t})=>{e(t)}},nn=async(l,e)=>{l.postMessage(e)};const Ne=l=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=({target:{error:{code:i}}})=>{t(Error(`File could not be read! Code=${i}`))},n.readAsArrayBuffer(l)}),je=async l=>{let e=l;if(typeof l>"u")return"undefined";if(typeof l=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(l)?e=atob(l.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(l)).arrayBuffer();else if(typeof HTMLElement<"u"&&l instanceof HTMLElement)l.tagName==="IMG"&&(e=await je(l.src)),l.tagName==="VIDEO"&&(e=await je(l.poster)),l.tagName==="CANVAS"&&await new Promise(t=>{l.toBlob(async n=>{e=await Ne(n),t()})});else if(typeof OffscreenCanvas<"u"&&l instanceof OffscreenCanvas){const t=await l.convertToBlob();e=await Ne(t)}else(l instanceof File||l instanceof Blob)&&(e=await Ne(l));return new Uint8Array(e)};var on=je;const sn=Jt,rn=Qt,an=en,cn=tn,dn=nn,ln=on;var hn={defaultOptions:sn,spawnWorker:rn,terminateWorker:an,onMessage:cn,send:dn,loadImage:ln};const un=Yt,mn=kt,X=rt,{log:Ve}=ye,fn=We,ue=at,{defaultOptions:gn,spawnWorker:pn,terminateWorker:_n,onMessage:wn,loadImage:Je,send:xn}=hn;let Qe=0;var ct=async(l="eng",e=ue.LSTM_ONLY,t={},n={})=>{const i=fn("Worker",Qe),{logger:o,errorHandler:s,...a}=un({...gn,...t}),r={},c={},h=typeof l=="string"?l.split("+"):l;let d=e,u=n;const m=[ue.DEFAULT,ue.LSTM_ONLY].includes(e)&&!a.legacyCore;let f,g;const v=new Promise((_,b)=>{g=_,f=b}),P=_=>{f(_.message)};let x=pn(a);x.onerror=P,Qe+=1;const I=(_,b)=>{r[_]=b},E=(_,b)=>{c[_]=b},O=({id:_,action:b,payload:S})=>new Promise((L,T)=>{Ve(`[${i}]: Start ${_}, action=${b}`);const $=`${b}-${_}`;I($,L),E($,T),xn(x,{workerId:i,jobId:_,action:b,payload:S})}),F=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),z=_=>O(X({id:_,action:"load",payload:{options:{lstmOnly:m,corePath:a.corePath,logging:a.logging}}})),A=(_,b,S)=>O(X({id:S,action:"FS",payload:{method:"writeFile",args:[_,b]}})),U=(_,b)=>O(X({id:b,action:"FS",payload:{method:"readFile",args:[_,{encoding:"utf8"}]}})),_e=(_,b)=>O(X({id:b,action:"FS",payload:{method:"unlink",args:[_]}})),Y=(_,b,S)=>O(X({id:S,action:"FS",payload:{method:_,args:b}})),te=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),ne=(_,b)=>O(X({id:b,action:"loadLanguage",payload:{langs:_,options:{langPath:a.langPath,dataPath:a.dataPath,cachePath:a.cachePath,cacheMethod:a.cacheMethod,gzip:a.gzip,lstmOnly:[ue.DEFAULT,ue.LSTM_ONLY].includes(d)&&!a.legacyLang}}})),ve=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),oe=(_,b,S,L)=>O(X({id:L,action:"initialize",payload:{langs:_,oem:b,config:S}})),be=(_="eng",b,S,L)=>{if(m&&[ue.TESSERACT_ONLY,ue.TESSERACT_LSTM_COMBINED].includes(b))throw Error("Legacy model requested but code missing.");const T=b||d;d=T;const $=S||u;u=$;const ie=(typeof _=="string"?_.split("+"):_).filter(se=>!h.includes(se));return h.push(...ie),ie.length>0?ne(ie,L).then(()=>oe(_,T,$,L)):oe(_,T,$,L)},Pe=(_={},b)=>O(X({id:b,action:"setParameters",payload:{params:_}})),Ie=async(_,b={},S={blocks:!0,text:!0,hocr:!0,tsv:!0},L)=>O(X({id:L,action:"recognize",payload:{image:await Je(_),options:b,output:S}})),w=(_="Tesseract OCR Result",b=!1,S)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),O(X({id:S,action:"getPDF",payload:{title:_,textonly:b}}))),p=async(_,b)=>{if(m)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return O(X({id:b,action:"detect",payload:{image:await Je(_)}}))},y=async()=>(x!==null&&(_n(x),x=null),Promise.resolve());wn(x,({workerId:_,jobId:b,status:S,action:L,data:T})=>{const $=`${L}-${b}`;if(S==="resolve"){Ve(`[${_}]: Complete ${b}`);let de=T;L==="recognize"?de=mn(T):L==="getPDF"&&(de=Array.from({...T,length:Object.keys(T).length})),r[$]({jobId:b,data:de})}else if(S==="reject")if(c[$](T),L==="load"&&f(T),s)s(T);else throw Error(T);else S==="progress"&&o({...T,userJobId:b})});const M={id:i,worker:x,setResolve:I,setReject:E,load:F,writeText:A,readText:U,removeFile:_e,FS:Y,loadLanguage:te,initialize:ve,reinitialize:be,setParameters:Pe,recognize:Ie,getPDF:w,detect:p,terminate:y};return z().then(()=>ne(l)).then(()=>oe(l,e,n)).then(()=>g(M)).catch(()=>{}),v};const dt=ct,yn=async(l,e,t)=>{const n=await dt(e,1,t);return n.recognize(l).finally(async()=>{await n.terminate()})},vn=async(l,e)=>{const t=await dt("osd",0,e);return t.detect(l).finally(async()=>{await t.terminate()})};var bn={recognize:yn,detect:vn},Pn={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},On={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const In=Bt,Mn=ct,En=bn,Rn=Pn,Cn=at,Sn=On,{setLogging:Ln}=ye;var Tn={languages:Rn,OEM:Cn,PSM:Sn,createScheduler:In,createWorker:Mn,setLogging:Ln,...En};const Fe=it(Tn);he.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";class zn{constructor(){this.initialized=!1,this.worker=null}async initialize(e){if(!this.initialized)try{e==null||e({status:"loading",message:"Loading Tesseract OCR engine...",progress:10}),this.worker=await Fe.createWorker("eng",1,{logger:t=>{t.status==="loading tesseract core"?e==null||e({status:"loading",message:"Loading OCR core...",progress:30}):t.status==="loading language traineddata"?e==null||e({status:"loading",message:"Loading English language model...",progress:60}):t.status==="initialized tesseract"&&(e==null||e({status:"loading",message:"Initializing OCR engine...",progress:90}))},errorHandler:t=>{console.error("Tesseract error:",t)}}),await this.worker.setParameters({tessedit_ocr_engine_mode:Fe.OEM.LSTM_ONLY,preserve_interword_spaces:"1",tessedit_pageseg_mode:Fe.PSM.AUTO}),this.initialized=!0,e==null||e({status:"ready",message:"Tesseract OCR engine loaded successfully!",progress:100})}catch(t){throw console.error("Failed to initialize Tesseract:",t),t}}async process(e){if(!this.initialized)throw new Error("OCR engine not initialized");if(e.type==="application/pdf")return await this.processPDF(e);const t=await this.worker.recognize(e);return this.formatResults(t)}formatResults(e){const t=[];for(const i of e.data.words)i.confidence>30&&t.push({box:[[i.bbox.x0,i.bbox.y0],[i.bbox.x1,i.bbox.y0],[i.bbox.x1,i.bbox.y1],[i.bbox.x0,i.bbox.y1]],text:i.text,confidence:i.confidence/100});return this.groupWordsIntoLines(t)}groupWordsIntoLines(e){if(e.length===0)return[];e.sort((i,o)=>i.box[0][1]-o.box[0][1]);const t=[];let n={words:[e[0]],minY:e[0].box[0][1],maxY:e[0].box[2][1]};for(let i=1;i<e.length;i++){const o=e[i],s=o.box[0][1];s<=n.maxY&&s>=n.minY-5?(n.words.push(o),n.minY=Math.min(n.minY,s),n.maxY=Math.max(n.maxY,o.box[2][1])):(t.push(this.mergeLine(n)),n={words:[o],minY:s,maxY:o.box[2][1]})}return n.words.length>0&&t.push(this.mergeLine(n)),t}mergeLine(e){e.words.sort((r,c)=>r.box[0][0]-c.box[0][0]);const t=Math.min(...e.words.map(r=>r.box[0][0])),n=Math.max(...e.words.map(r=>r.box[1][0])),i=Math.min(...e.words.map(r=>r.box[0][1])),o=Math.max(...e.words.map(r=>r.box[2][1])),s=e.words.map(r=>r.text).join(" "),a=e.words.reduce((r,c)=>r+c.confidence,0)/e.words.length;return{box:[[t,i],[n,i],[n,o],[t,o]],text:s,confidence:a}}async processPDF(e){const t=await e.arrayBuffer(),n=await he.getDocument({data:t}).promise,i=n.numPages,o=[];for(let s=1;s<=i;s++){const a=await n.getPage(s),r=a.getViewport({scale:2}),c=document.createElement("canvas"),h=c.getContext("2d");c.width=r.width,c.height=r.height,await a.render({canvasContext:h,viewport:r}).promise;const d=await new Promise(f=>c.toBlob(f,"image/png")),u=await this.worker.recognize(d),m=this.formatResults(u);o.push({page:s,results:m})}return o}async cleanup(){this.worker&&(await this.worker.terminate(),this.worker=null,this.initialized=!1)}}const we=new zn,V={detection:{det_limit_side_len:1920,det_db_thresh:.15,det_db_box_thresh:.2,det_db_unclip_ratio:2,det_db_min_size:5,det_db_max_candidates:3e3,grid_size:8,min_area_thresh:10},recognition:{rec_batch_num:16,drop_score:.3}};function $n(l){l.CONFIG.det_limit_side_len=V.detection.det_limit_side_len,l.CONFIG.det_db_thresh=V.detection.det_db_thresh,l.CONFIG.det_db_box_thresh=V.detection.det_db_box_thresh,l.CONFIG.det_db_unclip_ratio=V.detection.det_db_unclip_ratio,l.CONFIG.det_db_min_size=V.detection.det_db_min_size,l.CONFIG.det_db_max_candidates=V.detection.det_db_max_candidates,l.CONFIG.grid_size=V.detection.grid_size,l.CONFIG.min_area_thresh=V.detection.min_area_thresh,l.CONFIG.rec_batch_num=V.recognition.rec_batch_num,l.CONFIG.drop_score=V.recognition.drop_score,console.log("PaddleOCR configuration updated for infographic processing")}const et={detection:{det_limit_side_len:2560,det_db_thresh:.1,det_db_box_thresh:.15,det_db_unclip_ratio:1.6,det_db_min_size:3,det_db_max_candidates:5e3,grid_size:4,min_area_thresh:5},recognition:{rec_batch_num:32,drop_score:.1}},Nn={detection:{det_limit_side_len:1920,det_db_thresh:.08,det_db_box_thresh:.12,det_db_unclip_ratio:1.4,det_db_min_size:2,det_db_max_candidates:4e3,grid_size:8,min_area_thresh:3},recognition:{rec_batch_num:24,drop_score:.15}};function lt(l,e="general"){const t=e==="idcard"?et:e==="receipt"?Nn:et;l.CONFIG.det_limit_side_len=t.detection.det_limit_side_len,l.CONFIG.det_db_thresh=t.detection.det_db_thresh,l.CONFIG.det_db_box_thresh=t.detection.det_db_box_thresh,l.CONFIG.det_db_unclip_ratio=t.detection.det_db_unclip_ratio,l.CONFIG.det_db_min_size=t.detection.det_db_min_size,l.CONFIG.det_db_max_candidates=t.detection.det_db_max_candidates,l.CONFIG.grid_size=t.detection.grid_size,l.CONFIG.min_area_thresh=t.detection.min_area_thresh,l.CONFIG.rec_batch_num=t.recognition.rec_batch_num,l.CONFIG.drop_score=t.recognition.drop_score,console.log(`PaddleOCR configuration updated for ${e} processing`)}const Fn={detection:{det_limit_side_len:2048,det_db_thresh:.12,det_db_box_thresh:.18,det_db_unclip_ratio:1.5,det_db_min_size:3,det_db_max_candidates:3500,grid_size:16,min_area_thresh:10},recognition:{rec_batch_num:32,drop_score:.2}};function Dn(l){const e=Fn;l.CONFIG.det_limit_side_len=e.detection.det_limit_side_len,l.CONFIG.det_db_thresh=e.detection.det_db_thresh,l.CONFIG.det_db_box_thresh=e.detection.det_db_box_thresh,l.CONFIG.det_db_unclip_ratio=e.detection.det_db_unclip_ratio,l.CONFIG.det_db_min_size=e.detection.det_db_min_size,l.CONFIG.det_db_max_candidates=e.detection.det_db_max_candidates,l.CONFIG.grid_size=e.detection.grid_size,l.CONFIG.min_area_thresh=e.detection.min_area_thresh,l.CONFIG.rec_batch_num=e.recognition.rec_batch_num,l.CONFIG.drop_score=e.recognition.drop_score,console.log("PaddleOCR configuration updated for PDF processing")}he.GlobalWorkerOptions.workerSrc="/client-ocr-app/pdf.worker.min.js";let pe=null,C="tesseract",B="improved",ke="PP-OCRv5",N=we,H=!1,W=!1,re=!1,me=!1,D=[],Re=0;Object.defineProperty(window,"currentEngine",{get:()=>C,set:l=>{console.warn("Attempted to set currentEngine directly. Use handleEngineChange instead.")}});const Oe=document.getElementById("fileInput"),fe=document.getElementById("uploadArea"),ht=document.getElementById("previewSection"),K=document.getElementById("previewImage"),Bn=document.getElementById("processBtn"),Ce=document.getElementById("resultsSection"),Ge=document.getElementById("loadingIndicator"),ce=document.getElementById("ocrResults"),An=document.getElementById("copyBtn"),Ue=document.getElementById("downloadBtn"),jn=document.getElementById("resetBtn"),tt=document.getElementById("fileList"),De=document.getElementById("fileListItems"),nt=document.getElementById("clearFilesBtn"),ot=document.getElementById("progressArea"),Gn=document.getElementById("progressBar"),Un=document.getElementById("progressText"),Hn=document.getElementById("elapsedTime"),j=document.getElementById("modelVersion"),le=document.getElementById("globalTip");function Se(l,e="#7b8cff"){le.textContent=l,le.style.background=e,le.style.display="block",le.style.opacity="1",clearTimeout(le._timer),le._timer=setTimeout(()=>{le.style.opacity="0",setTimeout(()=>{le.style.display="none"},400)},1500)}async function Wn(){var l,e;console.log("Initializing OCR engines..."),R("Loading OCR engines...","info");try{const t=[];if(t.push(we.initialize(i=>{C==="tesseract"&&R(i.message,i.status==="ready"?"success":"info")})),j&&j.value){const i=j.value;i==="PP-OCRv5"||i==="PP-OCRv4"||i==="ch_ppocr_server_v2.0"?(ge.setModel(i),t.push(ge.initialize(o=>{C==="paddle"&&(R(o.message,o.status==="ready"?"success":"info"),typeof xe=="function"&&xe(o.progress||0,o.message))}))):t.push(Q.initialize(o=>{C==="paddle"&&B==="improved"&&R(o.message,o.status==="ready"?"success":"info")}),Z.initialize(o=>{C==="paddle"&&B==="standard"&&R(o.message,o.status==="ready"?"success":"info")}))}else t.push(Q.initialize(i=>{C==="paddle"&&B==="improved"&&R(i.message,i.status==="ready"?"success":"info")}),Z.initialize(i=>{C==="paddle"&&B==="standard"&&R(i.message,i.status==="ready"?"success":"info")}));await Promise.all(t),console.log("OCR engines loaded successfully!"),R("Ready to process images","success"),Yn();const n=document.querySelector('input[name="ocrEngine"]:checked');if(n){if(C=n.value,C==="paddle"){if(j){const i=j.value;i==="PP-OCRv5"||i==="PP-OCRv4"||i==="ch_ppocr_server_v2.0"?(N=ge,ke=i):N=B==="improved"?Q:Z}else N=B==="improved"?Q:Z;document.getElementById("paddleOptions").style.display="block"}else N=we,document.getElementById("paddleOptions").style.display="none";console.log("Initial engine set to:",C),console.log("Initial OCR engine object:",N)}}catch(t){if(console.error("Failed to initialize OCR engines:",t),(l=t.message)!=null&&l.includes("onnx")||(e=t.message)!=null&&e.includes("ONNX")?k("Failed to load PaddleOCR models. This may be due to browser compatibility issues. Please try using Tesseract.js instead."):k("Failed to load OCR engines. Please check your internet connection and refresh the page."),we.initialized){R("Tesseract.js is ready. PaddleOCR failed to load.","warning"),C="tesseract",N=we;const n=document.getElementById("engineTesseract");n&&(n.checked=!0)}}}function Yn(){fe.addEventListener("click",()=>Oe.click()),Oe.addEventListener("change",Vn),fe.addEventListener("dragover",Jn),fe.addEventListener("dragleave",Qn),fe.addEventListener("drop",eo),Bn.addEventListener("click",to),An.addEventListener("click",so),Ue.addEventListener("click",ro),jn.addEventListener("click",mt),document.querySelectorAll('input[name="ocrEngine"]').forEach(n=>{console.log("Adding event listener to radio:",n.value,n),n.addEventListener("change",kn)});const l=document.querySelector('input[name="ocrEngine"]:checked');console.log("Initial checked engine:",l==null?void 0:l.value),document.querySelectorAll('input[name="preprocessing"]').forEach(n=>{n.addEventListener("change",Xn)}),j&&j.addEventListener("change",qn),document.getElementById("detectionModel").addEventListener("change",Be),document.getElementById("recognitionModel").addEventListener("change",Be),document.getElementById("dictionary").addEventListener("change",Be);const e=document.getElementById("configPreset");e&&e.addEventListener("change",Kn),nt&&nt.addEventListener("click",Zn),document.getElementById("infographicMode").addEventListener("change",ho),document.getElementById("documentMode").addEventListener("change",uo),document.getElementById("receiptMode").addEventListener("change",mo);const t=document.getElementById("pdfMode");t&&t.addEventListener("change",fo)}async function kn(l){const e=l.target.value;if(console.log("Engine change event - new value:",e),console.log("Engine change event - old currentEngine:",C),C=e,C==="paddle"){if(j){const n=j.value;n==="PP-OCRv5"||n==="PP-OCRv4"||n==="ch_ppocr_server_v2.0"?(N=ge,ke=n,console.log("Set currentOCREngine to PP-OCRv5 Enhanced:",n)):(N=B==="improved"?Q:Z,console.log("Set currentOCREngine to PaddleOCR:",B))}else N=B==="improved"?Q:Z,console.log("Set currentOCREngine to PaddleOCR:",B);console.log("Verify currentOCREngine:",N)}else N=we,console.log("Set currentOCREngine to Tesseract");const t=document.getElementById("paddleOptions");t.style.display=C==="paddle"?"block":"none",R(`Switched to ${C==="paddle"?"PaddleOCR":"Tesseract.js"}`,"info"),console.log("Final currentEngine:",C),console.log("Final currentOCREngine:",N)}async function qn(l){const e=l.target.value;if(ke=e,C==="paddle"){if(e==="PP-OCRv5"||e==="PP-OCRv4"||e==="ch_ppocr_server_v2.0"){if(N=ge,!ge.initialized){R(`Loading ${e} models...`,"info");try{await ge.initialize(e,t=>{R(t.message,t.status==="ready"?"success":"info"),xe(t.progress||0,t.message)}),R(`${e} ready!`,"success")}catch(t){console.error(`Failed to initialize ${e}:`,t),k(`Failed to load ${e} models`)}}}else N=B==="improved"?Q:Z;R(`Switched to ${e} model`,"info")}}async function Xn(l){if(B=l.target.value,C==="paddle"&&(!j||!["PP-OCRv5","PP-OCRv4","ch_ppocr_server_v2.0"].includes(j.value))){if(N=B==="improved"?Q:Z,B==="standard"){const e=document.getElementById("detectionModel").value,t=document.getElementById("recognitionModel").value,n=document.getElementById("dictionary").value;Z.setModelConfig({detection:e,recognition:t,dictionary:n}),R("Loading standard preprocessing models...","info");try{await Z.initialize(i=>{R(i.message,i.status==="ready"?"success":"info")}),R("Standard preprocessing ready!","success")}catch(i){console.error("Failed to initialize standard preprocessing:",i),k("Failed to load standard preprocessing models"),B="improved",N=Q,document.getElementById("preprocessImproved").checked=!0}}R(`Switched to ${B==="improved"?"Improved (PPU)":"Standard"} preprocessing`,"info")}}function Kn(l){const e=l.target.value;switch(console.log("Configuration preset changed to:",e),document.getElementById("infographicMode").checked=!1,document.getElementById("documentMode").checked=!1,document.getElementById("receiptMode").checked=!1,document.getElementById("pdfMode").checked=!1,H=!1,W=!1,re=!1,me=!1,e){case"INFOGRAPHIC_OPTIMIZED":H=!0,document.getElementById("infographicMode").checked=!0;break;case"DOCUMENT_OPTIMIZED":case"ID_CARD_OPTIMIZED":W=!0,document.getElementById("documentMode").checked=!0;break;case"RECEIPT_OPTIMIZED":re=!0,document.getElementById("receiptMode").checked=!0;break;case"PDF_OPTIMIZED":me=!0,document.getElementById("pdfMode").checked=!0;break}R(`Configuration preset changed to: ${e.replace(/_/g," ").toLowerCase()}`,"info")}async function Be(){if(C!=="paddle")return;const l=document.getElementById("detectionModel").value,e=document.getElementById("recognitionModel").value,t=document.getElementById("dictionary").value;B==="improved"?Q.setModelConfig({detection:l,recognition:e,dictionary:t}):Z.setModelConfig({detection:l,recognition:e,dictionary:t}),R("Loading new models...","info");try{await N.initialize(n=>{R(n.message,n.status==="ready"?"success":"info")}),R("Models updated successfully!","success")}catch(n){console.error("Failed to load new models:",n),k("Failed to load new models. Please try again.")}}function Zn(){Oe.value="",D=[],qe(),mt()}function qe(){if(De.innerHTML="",D.length===0){De.innerHTML='<li style="color:#888;">No files selected</li>',tt.style.display="none";return}tt.style.display="block",D.forEach((l,e)=>{const t=document.createElement("li");t.textContent=l.name,De.appendChild(t)})}function xe(l,e){if(ot&&(ot.style.display="flex",Gn.style.width=l+"%",Un.textContent=e||`Processing... ${l}%`,Re>0)){const t=((Date.now()-Re)/1e3).toFixed(1);Hn.textContent=`Elapsed: ${t}s`}}function Vn(l){D=Array.from(l.target.files).filter(t=>t.type.startsWith("image/")||t.type==="application/pdf"),D.length>0?(qe(),D.length===1?Le(D[0]):(Le(D[0]),R(`${D.length} files selected. Click "Extract Text" to process all.`,"info"))):k("Please select valid image or PDF files")}function Jn(l){l.preventDefault(),fe.classList.add("dragover")}function Qn(l){l.preventDefault(),fe.classList.remove("dragover")}function eo(l){if(l.preventDefault(),fe.classList.remove("dragover"),D=Array.from(l.dataTransfer.files).filter(t=>t.type.startsWith("image/")||t.type==="application/pdf"),D.length>0){const t=new DataTransfer;D.forEach(n=>t.items.add(n)),Oe.files=t.files,qe(),D.length===1?Le(D[0]):(Le(D[0]),R(`${D.length} files dropped. Click "Extract Text" to process all.`,"info"))}else k("Please drop valid image or PDF files")}async function Le(l){if(pe){const e=K.src;e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),pe=null}if(ce.innerHTML="",Ce.style.display="none",pe=l,ht.style.display="block",Ce.style.display="none",l.type==="application/pdf"){K.style.display="none";const e=K.parentElement;e.innerHTML="";const t=document.createElement("div");t.className="pdf-preview",t.innerHTML=`
            <div class="pdf-header">
                <h3>${l.name}</h3>
                <p class="pdf-info">Loading PDF preview...</p>
            </div>
            <div class="pdf-pages" id="pdfPages"></div>
        `,e.appendChild(t);try{const n=await l.arrayBuffer(),i=await he.getDocument({data:n}).promise,o=i.numPages,s=t.querySelector(".pdf-info");s.textContent=`${o} page${o>1?"s":""}`;const a=document.getElementById("pdfPages"),r=Math.min(o,3);for(let c=1;c<=r;c++){const h=await i.getPage(c),d=h.getViewport({scale:.5}),u=document.createElement("div");u.className="pdf-page-preview";const m=document.createElement("canvas"),f=m.getContext("2d");m.height=d.height,m.width=d.width;const g={canvasContext:f,viewport:d};await h.render(g).promise,u.innerHTML=`<p>Page ${c}</p>`,u.appendChild(m),a.appendChild(u)}o>3&&(a.innerHTML+=`<p class="more-pages">... and ${o-3} more pages</p>`)}catch(n){console.error("Error rendering PDF preview:",n),t.querySelector(".pdf-info").textContent="Error loading PDF preview"}}else{const e=document.querySelector(".pdf-placeholder");e&&e.remove(),K.style.display="block";const t=URL.createObjectURL(l);K.src=t,K.onload=()=>{R('Image loaded. Click "Extract Text" to process.',"success")},K.onerror=()=>{URL.revokeObjectURL(t),k("Failed to load image")}}}async function to(){if(!pe&&D.length===0){k("Please upload an image first");return}Ce.style.display="block",ce.innerHTML="",Re=Date.now();const l=D.length>0?D:[pe],e=[];let t=C==="paddle"?"PaddleOCR":"Tesseract.js";C==="paddle"&&(j&&["PP-OCRv5","PP-OCRv4","ch_ppocr_server_v2.0"].includes(j.value)?t=`PaddleOCR ${j.value}`:t+=` (${B==="improved"?"Improved PPU":"Standard"})`),xe(0,`Processing ${l.length} file(s) with ${t}...`);try{console.log(`Processing ${l.length} files with ${t}...`),console.log("Current engine variable:",C),console.log("Current OCR engine object:",N);for(let i=0;i<l.length;i++){const o=l[i],s=(i/l.length*100).toFixed(0);if(xe(s,`Processing ${o.name}...`),C==="paddle"){const h=document.getElementById("configPreset");h&&h.value&&(console.log("Applying optimal configuration:",h.value),yt(N,h.value))}const a=performance.now(),r=await N.process(o),c=performance.now()-a;console.log(`${o.name} processed in ${c.toFixed(2)}ms`),e.push({filename:o.name,results:r,processingTime:c})}xe(100,"Processing complete!"),console.log("OCR Results:",results),Ge.style.display="none",no(e,t);const n=((Date.now()-Re)/1e3).toFixed(2);R(`Processed ${e.length} file(s) in ${n}s`,"success"),Se(`Extraction complete! ${e.length} file(s) processed.`)}catch(n){if(console.error("OCR processing error:",n),console.error("Error code:",n.code),Ge.style.display="none",C==="paddle"&&(n.code===30757872||n.message.includes("30757872"))){if(k("PaddleOCR failed: ONNX Runtime error. The PP-OCRv5 model appears to be incompatible with your browser."),R("Consider using Tesseract.js for better compatibility","warning"),confirm("PaddleOCR failed due to browser compatibility. Would you like to switch to Tesseract.js?")){const o=document.getElementById("engineTesseract");o&&(o.checked=!0,o.dispatchEvent(new Event("change")))}}else k("Failed to process image: "+n.message)}}function no(l,e="PaddleOCR"){if(Ge.style.display="none",ce.innerHTML="",l.length===1){oo(l[0].results,l[0].processingTime,e,l[0].filename);return}l.forEach(t=>{const n=document.createElement("div");n.className="result-block";let i="";if(t.filename.match(/\.(jpg|jpeg|png|webp)$/i)){const a=D.find(r=>r.name===t.filename);a&&(i=`<img class="ocr-image-preview" src="${URL.createObjectURL(a)}" alt="${t.filename}">`)}const o=t.results.map(a=>a.text||a).join(`
`),s=`<button class="copy-btn" data-text="${ae(o)}" title="Copy text">
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                <rect x="5" y="5" width="10" height="12" rx="2" fill="#7b8cff"/>
                <rect x="3" y="3" width="10" height="12" rx="2" stroke="#7b8cff" stroke-width="1.5" fill="none"/>
            </svg>
        </button>`;n.innerHTML=`
            ${i}
            <div class="ocr-text-content">
                <div class="result-header">
                    <b class="result-filename">${t.filename}</b>
                    ${s}
                </div>
                <pre>${ae(o)}</pre>
            </div>
        `,ce.appendChild(n)}),ce.querySelectorAll(".copy-btn").forEach(t=>{t.addEventListener("click",function(){const n=this.getAttribute("data-text");navigator.clipboard.writeText(n).then(()=>{Se("Copied to clipboard!")}).catch(()=>{Se("Failed to copy","#f87171")})})}),Ue.textContent="💾 Download All (ZIP)",Ue.onclick=()=>ut(l)}function oo(l,e,t="PaddleOCR",n=null){var s;const i=Array.isArray(l)&&((s=l[0])==null?void 0:s.page)!==void 0,o=C==="paddle"&&l.length>0&&l[0]&&l[0].box;if(console.log("Display check - currentEngine:",C,"isPaddleWithBoxes:",o,"results:",l),i){let a="",r=0,c="";l.forEach(h=>{const d=h.results.map(u=>u.text).join(`
`);a+=`
--- Page ${h.page} ---
${d}
`,r+=h.results.length,c+=`
                <div class="page-results">
                    <h4>Page ${h.page}</h4>
                    <ul class="detection-list">
                        ${h.results.map((u,m)=>`
                            <li data-index="${m}">
                                <span class="detection-index">${m+1}.</span>
                                <span class="detection-text">${ae(u.text)}</span>
                                <span class="detection-confidence">${(u.confidence*100).toFixed(1)}%</span>
                            </li>
                        `).join("")}
                    </ul>
                </div>
            `}),ce.innerHTML=`
            <div class="ocr-stats">
                <p><strong>Processing Time:</strong> ${(e/1e3).toFixed(2)}s</p>
                <p><strong>Pages Processed:</strong> ${l.length}</p>
                <p><strong>Total Text Regions:</strong> ${r}</p>
                <p><strong>Engine:</strong> ${t}</p>
            </div>
            <div class="text-result">
                <h3>Extracted Text:</h3>
                <div class="text-content" id="extractedText">${ae(a||"No text detected")}</div>
            </div>
            <div class="detection-results">
                <h3>Detection Details by Page:</h3>
                ${c}
            </div>
        `}else if(o)io(l,e,t);else{const a=l.map(r=>r.text).join(`
`);ce.innerHTML=`
            <div class="ocr-stats">
                <p><strong>Processing Time:</strong> ${(e/1e3).toFixed(2)}s</p>
                <p><strong>Text Regions Found:</strong> ${l.length}</p>
                <p><strong>Engine:</strong> ${t}</p>
            </div>
            <div class="text-result">
                <h3>Extracted Text:</h3>
                <div class="text-content" id="extractedText">${ae(a||"No text detected")}</div>
            </div>
            <div class="detection-results">
                <h3>Detection Details:</h3>
                <ul class="detection-list">
                    ${l.map((r,c)=>`
                        <li>
                            <span class="detection-index">${c+1}.</span>
                            <span class="detection-text">${ae(r.text)}</span>
                            <span class="detection-confidence">${(r.confidence*100).toFixed(1)}%</span>
                        </li>
                    `).join("")}
                </ul>
            </div>
        `}}function io(l,e,t){const n=l.map(o=>o.text).join(`
`),i=lo(l);ce.innerHTML=`
        <div class="ocr-stats">
            <p><strong>Processing Time:</strong> ${(e/1e3).toFixed(2)}s</p>
            <p><strong>Text Regions Found:</strong> ${l.length}</p>
            <p><strong>Engine:</strong> ${t}</p>
            <p><strong>Average Confidence:</strong> ${co(l)}%</p>
        </div>
        
        <div class="paddle-results-container">
            <div class="result-tabs">
                <button class="result-tab active" onclick="showResultTab('visual')">Visual Results</button>
                <button class="result-tab" onclick="showResultTab('text')">Text Only</button>
                <button class="result-tab" onclick="showResultTab('grouped')">Grouped by Line</button>
            </div>
            
            <div id="visualResults" class="tab-content active">
                <div class="result-image-container">
                    <img id="resultImage" src="${K.src}" alt="OCR Result">
                    <div class="bounding-box-overlay" id="boundingBoxOverlay"></div>
                </div>
                <div class="detection-results">
                    <h3>Detected Text Regions:</h3>
                    <ul class="detection-list" id="visualDetectionList">
                        ${l.map((o,s)=>{const a=ft(o.confidence);return`
                                <li data-index="${s}" onmouseover="highlightBox(${s})" onmouseout="unhighlightBox(${s})" onclick="selectBox(${s})">
                                    <span class="detection-index">${s+1}.</span>
                                    <span class="detection-text">${ae(o.text)}</span>
                                    <span class="detection-confidence ${a}">${(o.confidence*100).toFixed(1)}%</span>
                                </li>
                            `}).join("")}
                    </ul>
                </div>
            </div>
            
            <div id="textResults" class="tab-content grouped-results">
                <div class="text-result">
                    <h3>Extracted Text:</h3>
                    <div class="text-content" id="extractedText">${ae(n||"No text detected")}</div>
                </div>
            </div>
            
            <div id="groupedResults" class="tab-content grouped-results">
                <h3>Text Grouped by Line:</h3>
                ${i.map((o,s)=>`
                    <div class="text-region-group">
                        <div class="region-header">
                            <span class="region-title">Line ${s+1}</span>
                            <div class="region-confidence">
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${o.avgConfidence}%"></div>
                                </div>
                                <span class="confidence-text">${o.avgConfidence.toFixed(1)}%</span>
                            </div>
                        </div>
                        <p>${ae(o.text)}</p>
                    </div>
                `).join("")}
            </div>
        </div>
    `,setTimeout(()=>gt(l),100)}async function so(){const l=document.getElementById("extractedText");if(l)try{await navigator.clipboard.writeText(l.textContent),ao("Text copied to clipboard!")}catch{k("Failed to copy text")}}function ro(){const l=document.getElementById("extractedText");if(l){const e=l.textContent,t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`ocr-result-${Date.now()}.txt`,i.click(),URL.revokeObjectURL(n)}}async function ut(l){if(typeof JSZip>"u"){const o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",o.onload=()=>{ut(l)},document.head.appendChild(o);return}const e=new JSZip;l.forEach(o=>{const s=o.results.map(r=>r.text||r).join(`
`),a=o.filename.replace(/\.[^.]+$/,".txt");e.file(a,s)});const t=await e.generateAsync({type:"blob"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`ocr-results-${Date.now()}.zip`,i.click(),URL.revokeObjectURL(n),Se("Downloaded all results as ZIP")}function mt(){if(pe){const e=K.src;e&&e.startsWith("blob:")&&URL.revokeObjectURL(e),pe=null}Oe.value="",ht.style.display="none",Ce.style.display="none",ce.innerHTML="",K.src="";const l=K.parentElement;l.innerHTML='<img id="previewImage" alt="Preview">',window.previewImage=document.getElementById("previewImage"),R("Ready to process a new image","info")}function ae(l){const e=document.createElement("div");return e.textContent=l,e.innerHTML}function k(l){R(l,"error");const e=document.createElement("div");e.className="toast error",e.textContent=l,document.body.appendChild(e),setTimeout(()=>{e.remove()},5e3)}function ao(l){const e=document.createElement("div");e.className="toast success",e.textContent=l,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}function R(l,e="info"){console.log(`[${e.toUpperCase()}] ${l}`);const t=document.getElementById("status");t&&(t.textContent=l,t.className=`status ${e}`)}function co(l){return l.length===0?0:(l.reduce((t,n)=>t+n.confidence,0)/l.length*100).toFixed(1)}function ft(l){const e=l*100;return e>=80?"high-confidence":e>=60?"medium-confidence":"low-confidence"}function lo(l){if(l.length===0)return[];const e=[...l].sort((i,o)=>{const s=Math.min(...i.box.map(r=>r[1])),a=Math.min(...o.box.map(r=>r[1]));return s-a}),t=[];let n=[e[0]];for(let i=1;i<e.length;i++){const o=Math.min(...e[i-1].box.map(a=>a[1])),s=Math.min(...e[i].box.map(a=>a[1]));Math.abs(s-o)<20?n.push(e[i]):(t.push(n),n=[e[i]])}return n.length>0&&t.push(n),t.map(i=>{i.sort((a,r)=>{const c=Math.min(...a.box.map(d=>d[0])),h=Math.min(...r.box.map(d=>d[0]));return c-h});const o=i.map(a=>a.text).join(" "),s=i.reduce((a,r)=>a+r.confidence,0)/i.length*100;return{text:o,avgConfidence:s,items:i}})}function gt(l){const e=document.getElementById("boundingBoxOverlay"),t=document.getElementById("resultImage");if(!e||!t)return;if(e.innerHTML="",!t.complete){t.onload=()=>gt(l);return}const n=t.getBoundingClientRect(),i=t.naturalWidth/n.width,o=t.naturalHeight/n.height;l.forEach((s,a)=>{const r=s.box,c=Math.min(...r.map(g=>g[0]))/i,h=Math.min(...r.map(g=>g[1]))/o,d=Math.max(...r.map(g=>g[0]))/i,u=Math.max(...r.map(g=>g[1]))/o,m=document.createElement("div");m.className=`text-box ${ft(s.confidence)}`,m.dataset.index=a,m.style.left=`${c}px`,m.style.top=`${h}px`,m.style.width=`${d-c}px`,m.style.height=`${u-h}px`;const f=document.createElement("div");f.className="text-box-label",f.textContent=`${a+1}: ${(s.confidence*100).toFixed(0)}%`,m.appendChild(f),m.onclick=()=>selectBox(a),e.appendChild(m)})}window.showResultTab=function(l){document.querySelectorAll(".result-tab").forEach(e=>{e.classList.remove("active")}),event.target.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active")}),l==="visual"?document.getElementById("visualResults").classList.add("active"):l==="text"?document.getElementById("textResults").classList.add("active"):l==="grouped"&&document.getElementById("groupedResults").classList.add("active")};window.highlightBox=function(l){const e=document.querySelector(`.text-box[data-index="${l}"]`),t=document.querySelector(`#visualDetectionList li[data-index="${l}"]`);e&&e.classList.add("hover"),t&&t.classList.add("highlighted")};window.unhighlightBox=function(l){const e=document.querySelector(`.text-box[data-index="${l}"]`),t=document.querySelector(`#visualDetectionList li[data-index="${l}"]`);e&&e.classList.remove("hover"),t&&t.classList.remove("highlighted")};window.selectBox=function(l){document.querySelectorAll(".text-box.selected").forEach(t=>{t.classList.remove("selected")});const e=document.querySelector(`.text-box[data-index="${l}"]`);if(e){e.classList.add("selected");const t=document.querySelector(`#visualDetectionList li[data-index="${l}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlighted"),setTimeout(()=>t.classList.remove("highlighted"),2e3))}};function ho(l){H=l.target.checked,console.log("Infographic mode:",H?"enabled":"disabled"),H&&W&&(W=!1,document.getElementById("documentMode").checked=!1),H&&C==="paddle"?($n(N),R("Infographic mode enabled - optimized for complex layouts","info")):!H&&C==="paddle"&&R("Infographic mode disabled","info")}function uo(l){W=l.target.checked,console.log("Document mode:",W?"enabled":"disabled"),W&&H&&(H=!1,document.getElementById("infographicMode").checked=!1),W&&C==="paddle"?(lt(N,"general"),R("Document mode enabled - optimized for official documents and ID cards","info")):!W&&C==="paddle"&&R("Document mode disabled","info")}function mo(l){re=l.target.checked,console.log("Receipt mode:",re?"enabled":"disabled"),re&&(H&&(H=!1,document.getElementById("infographicMode").checked=!1),W&&(W=!1,document.getElementById("documentMode").checked=!1)),re&&C==="paddle"?(lt(N,"receipt"),R("Receipt mode enabled - optimized for thermal receipts and price extraction","info")):!re&&C==="paddle"&&R("Receipt mode disabled","info")}function fo(l){me=l.target.checked,console.log("PDF mode:",me?"enabled":"disabled"),me&&(H&&(H=!1,document.getElementById("infographicMode").checked=!1),W&&(W=!1,document.getElementById("documentMode").checked=!1),re&&(re=!1,document.getElementById("receiptMode").checked=!1)),me&&C==="paddle"?(Dn(N),R("PDF mode enabled - optimized for PDF documents with structure extraction","info")):!me&&C==="paddle"&&R("PDF mode disabled","info")}document.addEventListener("DOMContentLoaded",Wn);
//# sourceMappingURL=index-DulwUonZ.js.map
